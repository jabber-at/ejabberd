Description: remove make targets for deps
 Without this patch, dependencies would be downloaded and compiled
 using rebar at build time.
Author: Philipp Huebner <debalance@debian.org>

--- a/Makefile.in
+++ b/Makefile.in
@@ -74,26 +74,11 @@
   INIT_USER=$(INSTALLUSER)
 endif
 
-all: deps src
+all: src
 
-deps: deps/.got
-
-deps/.got:
-	rm -rf deps/.got
-	rm -rf deps/.built
-	$(REBAR) get-deps && :> deps/.got
-
-deps/.built: deps/.got
-	$(REBAR) compile && :> deps/.built
-
-src: deps/.built
+src:
 	$(REBAR) skip_deps=true compile
 
-update:
-	rm -rf deps/.got
-	rm -rf deps/.built
-	$(REBAR) update-deps && :> deps/.got
-
 xref: all
 	$(REBAR) skip_deps=true xref
 
@@ -109,8 +94,6 @@
 	$(ERL) -noinput +B -pa ebin -pa deps/*/ebin -eval \
 	'case xml_gen:compile("tools/xmpp_codec.spec") of ok -> halt(0); _ -> halt(1) end.'
 
-DLLs := $(wildcard deps/*/priv/*.so) $(wildcard deps/*/priv/lib/*.so)
-
 install: all
 	#
 	# Configuration files
@@ -135,11 +118,6 @@
 	# Administration script
 	[ -d $(SBINDIR) ] || $(INSTALL) -d -m 755 $(SBINDIR)
 	$(INSTALL) -m 550 $(G_USER) ejabberdctl.example $(SBINDIR)/ejabberdctl
-	# Elixir binaries
-	[ -d $(BINDIR) ] || $(INSTALL) -d -m 755 $(BINDIR)
-	[ -f deps/elixir/bin/iex ] && $(INSTALL) -m 550 $(G_USER) deps/elixir/bin/iex $(BINDIR)/iex || true
-	[ -f deps/elixir/bin/elixir ] && $(INSTALL) -m 550 $(G_USER) deps/elixir/bin/elixir $(BINDIR)/elixir || true
-	[ -f deps/elixir/bin/mix ] && $(INSTALL) -m 550 $(G_USER) deps/elixir/bin/mix $(BINDIR)/mix || true
 	#
 	# Init script
 	$(SED) -e "s*@ctlscriptpath@*$(SBINDIR)*" \
@@ -151,30 +129,20 @@
 	$(INSTALL) -d $(BEAMDIR)
 	$(INSTALL) -m 644 ebin/*.app $(BEAMDIR)
 	$(INSTALL) -m 644 ebin/*.beam $(BEAMDIR)
-	$(INSTALL) -m 644 deps/*/ebin/*.app $(BEAMDIR)
-	$(INSTALL) -m 644 deps/*/ebin/*.beam $(BEAMDIR)
-	# Install Elixir and Elixir dependancies
-	-$(INSTALL) -m 644 deps/*/lib/*/ebin/*.app $(BEAMDIR)
-	-$(INSTALL) -m 644 deps/*/lib/*/ebin/*.beam $(BEAMDIR)
 	rm -f $(BEAMDIR)/configure.beam
 	#
 	# ejabberd header files
 	$(INSTALL) -d $(INCLUDEDIR)
 	$(INSTALL) -m 644 include/*.hrl $(INCLUDEDIR)
-	$(INSTALL) -m 644 deps/*/include/*.hrl $(INCLUDEDIR)
 	#
 	# Binary C programs
 	$(INSTALL) -d $(PBINDIR)
 	$(INSTALL) -m 750 $(O_USER) tools/captcha.sh $(PBINDIR)
 	$(INSTALL) -m 750 $(O_USER) tools/joincluster $(PBINDIR)
 	$(INSTALL) -m 750 $(O_USER) tools/leavecluster $(PBINDIR)
-	[ -f deps/p1_pam/priv/bin/epam ] \
-		&& $(INSTALL) -m 750 $(O_USER) deps/p1_pam/priv/bin/epam $(PBINDIR) \
-		|| true
 	#
 	# Binary system libraries
 	$(INSTALL) -d $(SODIR)
-	$(INSTALL) -m 644 $(DLLs) $(SODIR)
 	[ -f $(SODIR)/jiffy.so ] && (cd $(PRIVDIR); ln -s lib/jiffy.so; true) || true
 	[ -f $(SODIR)/sqlite3_drv.so ] && (cd $(PRIVDIR); ln -s lib/sqlite3_drv.so; true) || true
 	#
@@ -240,8 +208,6 @@
 	rm -rf $(LOGDIR)
 
 clean:
-	rm -rf deps/.got
-	rm -rf deps/.built
 	rm -rf test/*.beam
 	$(REBAR) clean
 
@@ -252,7 +218,6 @@
 	rm -f config.status
 	rm -f config.log
 	rm -rf autom4te.cache
-	rm -rf deps
 	rm -rf ebin
 	rm -f Makefile
 	rm -f vars.config
