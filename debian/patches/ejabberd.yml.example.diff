Description: adjust ejabberd.yml.example to sane defaults
 ejabberd's default configuration needs to be altered to be
 a useful on Debian systems
Author: Philipp Huebner <debalance@debian.org>

Index: ejabberd/ejabberd.yml.example
===================================================================
--- ejabberd.orig/ejabberd.yml.example
+++ ejabberd/ejabberd.yml.example
@@ -39,23 +39,10 @@
 loglevel: 4
 
 ##
-## rotation: Describe how to rotate logs. Either size and/or date can trigger
-## log rotation. Setting count to N keeps N rotated logs. Setting count to 0
-## does not disable rotation, it instead rotates the file and keeps no previous
-## versions around. Setting size to X rotate log when it reaches X bytes.
-## To disable rotation set the size to 0 and the date to ""
-## Date syntax is taken from the syntax newsyslog uses in newsyslog.conf.
-## Some examples:
-##  $D0     rotate every night at midnight
-##  $D23    rotate every day at 23:00 hr
-##  $W0D23  rotate every week on Sunday at 23:00 hr
-##  $W5D16  rotate every week on Friday at 16:00 hr
-##  $M1D0   rotate on the first day of every month at midnight
-##  $M5D6   rotate on every 5th day of the month at 6:00 hr
-##
-log_rotate_size: 10485760
+## rotation: Disable ejabberd's internal log rotation, as the Debian package
+## uses logrotate(8).
+log_rotate_size: 0
 log_rotate_date: ""
-log_rotate_count: 1
 
 ##
 ## overload protection: If you want to limit the number of messages per second
@@ -88,7 +75,7 @@ log_rate_limit: 100
 ##
 ## hosts: Domains served by ejabberd.
 ## You can define one or several, for example:
-## hosts: 
+## hosts:
 ##   - "example.net"
 ##   - "example.com"
 ##   - "example.org"
@@ -107,53 +94,39 @@ hosts:
 ###'  LISTENING PORTS
 
 ## Define common macros used by listeners
-## define_macro:
-##   'CERTFILE': "/path/to/xmpp.pem"
-##   'CIPHERS': "ECDH:DH:!3DES:!aNULL:!eNULL:!MEDIUM@STRENGTH"
-##   'TLSOPTS':
-##     - "no_sslv3"
-##     - "no_tlsv1"
-##     - "cipher_server_preference"
-##     - "no_compression"
-##   'DHFILE': "/path/to/dhparams.pem" # generated with: openssl dhparam -out dhparams.pem 2048
+define_macro:
+  'CERTFILE': "/etc/ejabberd/ejabberd.pem"
+  'CIPHERS': "ECDH:DH:!3DES:!aNULL:!eNULL:!MEDIUM@STRENGTH"
+  'TLSOPTS':
+    - "no_sslv3"
+    - "no_tlsv1"
+    - "cipher_server_preference"
+    - "no_compression"
+  'DHFILE': "/path/to/dhparams.pem" # generated with: openssl dhparam -out dhparams.pem 4096
 
 ##
 ## listen: The ports ejabberd will listen on, which service each is handled
 ## by and what options to start it with.
 ##
-listen: 
-  - 
+listen:
+  -
     port: 5222
     ip: "::"
     module: ejabberd_c2s
-    ##
-    ## If TLS is compiled in and you installed a SSL
-    ## certificate, specify the full path to the
-    ## file and uncomment these lines:
-    ##
-    ## starttls: true
-    ## certfile: 'CERTFILE'
-    ## protocol_options: 'TLSOPTS'
+    starttls_required: true
+    certfile: 'CERTFILE'
+    protocol_options: 'TLSOPTS'
+    dhfile: 'DHFILE'
+    ciphers: 'CIPHERS'
-    ##
-    ## To enforce TLS encryption for client connections,
-    ## use this instead of the "starttls" option:
-    ##
-    ## starttls_required: true
-    ##
-    ## Stream compression
-    ##
-    ## zlib: true
-    ##
     max_stanza_size: 65536
     shaper: c2s_shaper
     access: c2s
-  - 
+    resend_on_timeout: if_offline
+  -
     port: 5269
     ip: "::"
     module: ejabberd_s2s_in
-  - 
+  -
     port: 5280
     ip: "::"
     module: ejabberd_http
@@ -164,18 +137,21 @@ listen:
     ##  "/pub/archive": mod_http_fileserver
     web_admin: true
     ## register: true
-    captcha: true
+    ## captcha: true
+    tls: true
+    certfile: 'CERTFILE'
+    protocol_options: 'TLSOPTS'
+    dhfile: 'DHFILE'
+    ciphers: 'CIPHERS'
   ##
   ## ejabberd_service: Interact with external components (transports, ...)
   ##
-  ## - 
+  ## -
   ##   port: 8888
   ##   ip: "::"
   ##   module: ejabberd_service
   ##   access: all
   ##   shaper_rule: fast
   ##   ip: "127.0.0.1"
-  ##   privilege_access: 
+  ##   privilege_access:
   ##      roster: "both"
   ##      message: "outgoing"
   ##      presence: "roster"
@@ -193,7 +169,7 @@ listen:
   ##
   ## ejabberd_stun: Handles STUN Binding requests
   ##
-  ## - 
+  ## -
   ##   port: 3478
   ##   transport: udp
   ##   module: ejabberd_stun
@@ -201,7 +177,7 @@ listen:
   ##
   ## To handle XML-RPC requests that provide admin credentials:
   ##
-  ## - 
+  ## -
   ##   port: 4560
   ##   ip: "::"
   ##   module: ejabberd_xmlrpc
@@ -210,7 +186,7 @@ listen:
   ##
   ## To enable secure http upload
   ##
-  ## - 
+  ## -
   ##   port: 5444
   ##   ip: "::"
   ##   module: ejabberd_http
@@ -224,7 +200,7 @@ listen:
 
 ## Disabling digest-md5 SASL authentication. digest-md5 requires plain-text
 ## password storage (see auth_password_format option).
-## disable_sasl_mechanisms: "digest-md5"
+disable_sasl_mechanisms: "digest-md5"
 
 ###.  ==================
 ###'  S2S GLOBAL OPTIONS
@@ -239,11 +232,11 @@
 ##
 ## s2s_certfile: Specify a certificate file.
 ##
-## s2s_certfile: 'CERTFILE'
+s2s_certfile: 'CERTFILE'
 
 ## Custom OpenSSL options
 ##
-## s2s_protocol_options: 'TLSOPTS'
+s2s_protocol_options: 'TLSOPTS'
 
 ##
 ## domain_certfile: Specify a different certificate for each served hostname.
@@ -286,7 +262,7 @@ auth_method: internal
 ##
 ## Store the plain passwords or hashed for SCRAM:
 ## auth_password_format: plain
-## auth_password_format: scram
+auth_password_format: scram
 ##
 ## Define the FQDN if ejabberd doesn't detect it:
 ## fqdn: "server3.example.com"
@@ -465,7 +441,7 @@ acl:
 
   ## Local users: don't modify this.
   ##
-  local: 
+  local:
     user_regexp: ""
 
   ##
@@ -539,24 +515,24 @@ access_rules:
   announce:
     - allow: admin
   ## Only admins can use the configuration interface:
-  configure: 
+  configure:
     - allow: admin
   ## Only accounts of the local ejabberd server can create rooms:
-  muc_create: 
+  muc_create:
     - allow: local
   ## Only accounts on the local ejabberd server can create Pubsub nodes:
-  pubsub_createnode: 
+  pubsub_createnode:
     - allow: local
   ## In-band registration allows registration of any possible username.
   ## To disable in-band registration, replace 'allow' with 'deny'.
-  register: 
+  register:
     - allow
   ## Only allow to register from localhost
-  trusted_network: 
+  trusted_network:
     - allow: loopback
   ## Do not establish S2S connections with bad servers
   ## If you enable this you also have to uncomment "s2s_access: s2s"
-  ## s2s: 
+  ## s2s:
   ##   - deny:
   ##     - ip: "XXX.XXX.XXX.XXX/32"
   ##   - deny:
@@ -590,9 +566,9 @@ api_permissions:
   "admin access":
     who:
       - access:
-          - allow:
-            - acl: loopback
-            - acl: admin
+        - allow:
+          - acl: loopback
+          - acl: admin
       - oauth:
         - scope: "ejabberd:admin"
         - access:
@@ -613,7 +589,7 @@ api_permissions:
 ## By default the frequency of account registrations from the same IP
 ## is limited to 1 account every 10 minutes. To disable, specify: infinity
 ## registration_timeout: 600
-  
+
 ##
 ## Define specific Access Rules in a virtual host.
 ##
@@ -647,7 +623,7 @@ language: "en"
 ##
 ## Full path to a script that generates the image.
 ##
-## captcha_cmd: "/lib/ejabberd/priv/bin/captcha.sh"
+## captcha_cmd: "/usr/share/ejabberd/captcha.sh"
 
 ##
 ## Host for the URL and port where ejabberd listens for CAPTCHA requests.
@@ -665,7 +641,7 @@ language: "en"
 ##
 ## Modules enabled in all ejabberd virtual hosts.
 ##
-modules: 
+modules:
   mod_adhoc: {}
   mod_admin_extra: {}
   mod_announce: # recommends mod_adhoc
@@ -694,7 +670,7 @@ modules:
   ## You might want to setup a SQL backend for MAM because the mnesia database is
   ## limited to 2GB which might be exceeded on large servers
   ## mod_mam: {} # for xep0313, mnesia is limited to 2GB, better use an SQL backend
-  mod_muc: 
+  mod_muc:
     ## host: "conference.@HOST@"
     access:
       - allow
@@ -705,7 +681,7 @@ modules:
   mod_muc_admin: {}
   ## mod_muc_log: {}
   ## mod_multicast: {}
-  mod_offline: 
+  mod_offline:
     access_max_user_messages: max_user_offline_messages
   mod_ping: {}
   ## mod_pres_counter:
@@ -714,14 +690,14 @@ modules:
   mod_privacy: {}
   mod_private: {}
   ## mod_proxy65: {}
-  mod_pubsub: 
+  mod_pubsub:
     access_createnode: pubsub_createnode
     ## reduces resource comsumption, but XEP incompliant
     ignore_pep_from_offline: true
     ## XEP compliant, but increases resource comsumption
     ## ignore_pep_from_offline: false
     last_item_cache: false
-    plugins: 
+    plugins:
       - "flat"
       - "hometree"
       - "pep" # pep requires mod_caps
@@ -760,7 +736,8 @@ modules:
     ##
     ##   access_from: deny
     ##   access: register
-  mod_roster: {}
+  mod_roster:
+    versioning: true
   mod_shared_roster: {}
   mod_stats: {}
   mod_time: {}
