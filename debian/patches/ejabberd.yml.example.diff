Description: adjust ejabberd.yml.example to sane defaults
 ejabberd's default configuration needs to be altered to be
 a useful on Debian systems
Author: Philipp Huebner <debalance@debian.org>

Index: ejabberd/ejabberd.yml.example
===================================================================
--- ejabberd.orig/ejabberd.yml.example
+++ ejabberd/ejabberd.yml.example
@@ -39,23 +39,10 @@
 loglevel: 4
 
 ##
-## rotation: Describe how to rotate logs. Either size and/or date can trigger
-## log rotation. Setting count to N keeps N rotated logs. Setting count to 0
-## does not disable rotation, it instead rotates the file and keeps no previous
-## versions around. Setting size to X rotate log when it reaches X bytes.
-## To disable rotation set the size to 0 and the date to ""
-## Date syntax is taken from the syntax newsyslog uses in newsyslog.conf.
-## Some examples:
-##  $D0     rotate every night at midnight
-##  $D23    rotate every day at 23:00 hr
-##  $W0D23  rotate every week on Sunday at 23:00 hr
-##  $W5D16  rotate every week on Friday at 16:00 hr
-##  $M1D0   rotate on the first day of every month at midnight
-##  $M5D6   rotate on every 5th day of the month at 6:00 hr
-##
-log_rotate_size: 10485760
+## rotation: Disable ejabberd's internal log rotation, as the Debian package
+## uses logrotate(8).
+log_rotate_size: 0
 log_rotate_date: ""
-log_rotate_count: 1
 
 ##
 ## overload protection: If you want to limit the number of messages per second
@@ -88,7 +75,7 @@ log_rate_limit: 100
 ##
 ## hosts: Domains served by ejabberd.
 ## You can define one or several, for example:
-## hosts: 
+## hosts:
 ##   - "example.net"
 ##   - "example.com"
 ##   - "example.org"
@@ -107,15 +94,15 @@
 ###'  LISTENING PORTS
 
 ## Define common macros used by listeners
-## define_macro:
-##   'CERTFILE': "/path/to/xmpp.pem"
-##   'CIPHERS': "ECDH:DH:!3DES:!aNULL:!eNULL:!MEDIUM@STRENGTH"
-##   'TLSOPTS':
-##     - "no_sslv3"
-##     - "no_tlsv1"
-##     - "cipher_server_preference"
-##     - "no_compression"
-##   'DHFILE': "/path/to/dhparams.pem" # generated with: openssl dhparam -out dhparams.pem 2048
+define_macro:
+  'CERTFILE': "/etc/ejabberd/ejabberd.pem"
+  'CIPHERS': "ECDH:DH:!3DES:!aNULL:!eNULL:!MEDIUM@STRENGTH"
+  'TLSOPTS':
+    - "no_sslv3"
+    - "no_tlsv1"
+    - "cipher_server_preference"
+    - "no_compression"
+  'DHFILE': "/path/to/dhparams.pem" # generated with: openssl dhparam -out dhparams.pem 4096
 
 ##
 ## listen: The ports ejabberd will listen on, which service each is handled
@@ -131,11 +118,11 @@
     ## certificate, specify the full path to the
     ## file and uncomment these lines:
     ##
-    ## starttls: true
-    ## certfile: 'CERTFILE'
-    ## protocol_options: 'TLSOPTS'
-    ## dhfile: 'DHFILE'
-    ## ciphers: 'CIPHERS'
+    certfile: 'CERTFILE'
+    starttls: true
+    protocol_options: 'TLSOPTS'
+    dhfile: 'DHFILE'
+    ciphers: 'CIPHERS'
     ##
     ## To enforce TLS encryption for client connections,
     ## use this instead of the "starttls" option:
@@ -149,6 +136,7 @@
     max_stanza_size: 65536
     shaper: c2s_shaper
     access: c2s
+    resend_on_timeout: if_offline
   - 
     port: 5269
     ip: "::"
@@ -165,6 +153,11 @@
     web_admin: true
     ## register: true
     captcha: true
+    tls: true
+    certfile: 'CERTFILE'
+    protocol_options: 'TLSOPTS'
+    dhfile: 'DHFILE'
+    ciphers: 'CIPHERS'
   ##
   ## ejabberd_service: Interact with external components (transports, ...)
   ##
@@ -224,7 +217,7 @@
 
 ## Disabling digest-md5 SASL authentication. digest-md5 requires plain-text
 ## password storage (see auth_password_format option).
-## disable_sasl_mechanisms: "digest-md5"
+disable_sasl_mechanisms: "digest-md5"
 
 ###.  ==================
 ###'  S2S GLOBAL OPTIONS
@@ -239,11 +232,11 @@
 ##
 ## s2s_certfile: Specify a certificate file.
 ##
-## s2s_certfile: 'CERTFILE'
+s2s_certfile: 'CERTFILE'
 
 ## Custom OpenSSL options
 ##
-## s2s_protocol_options: 'TLSOPTS'
+s2s_protocol_options: 'TLSOPTS'
 
 ##
 ## domain_certfile: Specify a different certificate for each served hostname.
@@ -286,7 +279,7 @@
 ##
 ## Store the plain passwords or hashed for SCRAM:
 ## auth_password_format: plain
-## auth_password_format: scram
+auth_password_format: scram
 ##
 ## Define the FQDN if ejabberd doesn't detect it:
 ## fqdn: "server3.example.com"
@@ -647,7 +640,7 @@
 ##
 ## Full path to a script that generates the image.
 ##
-## captcha_cmd: "/lib/ejabberd/priv/bin/captcha.sh"
+## captcha_cmd: "/usr/share/ejabberd/captcha.sh"
 
 ##
 ## Host for the URL and port where ejabberd listens for CAPTCHA requests.
@@ -704,6 +697,7 @@
     access_persistent: muc_create
   mod_muc_admin: {}
   ## mod_muc_log: {}
+  mod_muc_admin: {}
   ## mod_multicast: {}
   mod_offline: 
     access_max_user_messages: max_user_offline_messages
