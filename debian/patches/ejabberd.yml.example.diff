Description: adjust ejabberd.yml.example to sane defaults
 ejabberd's default configuration needs to be altered to be
 useful on Debian systems
Author: Philipp Huebner <debalance@debian.org>

Index: ejabberd/ejabberd.yml.example
===================================================================
--- ejabberd.orig/ejabberd.yml.example
+++ ejabberd/ejabberd.yml.example
@@ -29,15 +29,32 @@
 hosts:
   - "localhost"
 
+## rotation: Disable ejabberd's internal log rotation, as the Debian package
+## uses logrotate(8).
 loglevel: 4
-log_rotate_size: 10485760
-log_rotate_date: ""
-log_rotate_count: 1
-log_rate_limit: 100
+log_rotate_count: 0
 
 certfiles:
   - "/etc/letsencrypt/live/*/*.pem"
 
+## TLS configuration
+define_macro:
+  'TLS_CIPHERS': "HIGH:!aNULL:!eNULL:!3DES:@STRENGTH"
+  'TLS_OPTIONS':
+    - "no_sslv3"
+    - "no_tlsv1"
+    - "no_tlsv1_1"
+    - "cipher_server_preference"
+    - "no_compression"
+  ## 'DH_FILE': "/path/to/dhparams.pem" # generated with: openssl dhparam -out dhparams.pem 2048
+
+c2s_ciphers: 'TLS_CIPHERS'
+s2s_ciphers: 'TLS_CIPHERS'
+c2s_protocol_options: 'TLS_OPTIONS'
+s2s_protocol_options: 'TLS_OPTIONS'
+## c2s_dhfile: 'DH_FILE'
+## s2s_dhfile: 'DH_FILE'
+
 listen:
   -
     port: 5222
@@ -47,6 +64,7 @@
     shaper: c2s_shaper
     access: c2s
     starttls_required: true
+    protocol_options: 'TLS_OPTIONS'
   -
     port: 5269
     ip: "::"
@@ -64,8 +82,21 @@
     web_admin: true
     captcha: true
     tls: true
+    protocol_options: 'TLS_OPTIONS'
+
+## Disabling digest-md5 SASL authentication. digest-md5 requires plain-text
+## password storage (see auth_password_format option).
+disable_sasl_mechanisms: 
+  - "digest-md5"
+  - "X-OAUTH2"
+
+s2s_use_starttls: required
+
+## Store the plain passwords or hashed for SCRAM:
+auth_password_format: scram
 
-s2s_use_starttls: optional
+## Full path to a script that generates the image.
+## captcha_cmd: "/usr/share/ejabberd/captcha.sh"
 
 acl:
   local:
@@ -104,9 +135,9 @@
   "admin access":
     who:
       - access:
-          - allow:
-            - acl: loopback
-            - acl: admin
+        - allow:
+          - acl: loopback
+          - acl: admin
       - oauth:
         - scope: "ejabberd:admin"
         - access:
@@ -144,18 +175,23 @@
   mod_announce:
     access: announce
   mod_avatar: {}
+  mod_block_strangers: {}
   mod_blocking: {}
   mod_bosh: {}
   mod_caps: {}
   mod_carboncopy: {}
   mod_client_state: {}
   mod_configure: {}
+  ## mod_delegation: {}   # for xep0356
   mod_disco: {}
   mod_fail2ban: {}
   mod_http_api: {}
   mod_http_upload:
     put_url: "https://@HOST@:5443/upload"
   mod_last: {}
+  mod_pres_counter:
+    count: 5
+    interval: 60
   mod_mam:
     ## Mnesia is limited to 2GB, better to use an SQL backend
     ## For small servers SQLite is a good fit and is very easy
@@ -187,7 +223,7 @@
       ## Comment out the following lines to enable OMEMO support
       ## See https://github.com/processone/ejabberd/issues/2425
       "eu.siacs.conversations.axolotl.*":
-        access_model: whitelist
+        access_model: open
       ## Avoid buggy clients to make their bookmarks public
       "storage:bookmarks":
         access_model: whitelist
@@ -204,6 +240,7 @@
     versioning: true
   mod_s2s_dialback: {}
   mod_shared_roster: {}
+  mod_sic: {}
   mod_stream_mgmt:
     resend_on_timeout: if_offline
   mod_vcard: {}
