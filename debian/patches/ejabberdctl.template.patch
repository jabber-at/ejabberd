Description: adjust ejabberdctl
 The default ejabberdctl needs some changes to work correctly and to
 avoid unnecessary problematic changes compared to older versions.
Author: Philipp Huebner <debalance@debian.org>

--- a/ejabberdctl.template
+++ b/ejabberdctl.template
@@ -7,13 +7,13 @@
 ERL_PROCESSES=250000
 ERL_MAX_ETS_TABLES=1400
 FIREWALL_WINDOW=""
-ERLANG_NODE=ejabberd@localhost
+ERLANG_NODE=ejabberd
 
 # define default environment variables
 ERL="{{erl}}"
 IEX="{{bindir}}/iex"
 EPMD="{{epmd}}"
-INSTALLUSER="{{installuser}}"
+INSTALLUSER=ejabberd
 
 # check the proper system user is used
 case `id -un` in
@@ -108,7 +108,9 @@ export ERL_LIBS
 exec_cmd()
 {
     case $EXEC_CMD in
-        as_install_user) su -c '"$0" "$@"' "$INSTALLUSER" -- "$@" ;;
+        as_install_user)
+            cd ${SPOOL_DIR}
+            su -c '"$0" "$@"' "$INSTALLUSER" -- "$@" ;;
         as_current_user) "$@" ;;
     esac
 }
