<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="generator" content="hevea 2.09">
<style type="text/css">
.li-itemize{margin:1ex 0ex;}
.li-enumerate{margin:1ex 0ex;}
.dd-description{margin:0ex 0ex 1ex 4ex;}
.dt-description{margin:0ex;}
.toc{list-style:none;}
.footnotetext{margin:0ex; padding:0ex;}
div.footnotetext P{margin:0px; text-indent:1em;}
.thefootnotes{text-align:left;margin:0ex;}
.dt-thefootnotes{margin:0em;}
.dd-thefootnotes{margin:0em 0em 0em 2em;}
.footnoterule{margin:1em auto 1em 0px;width:50%;}
.caption{padding-left:2ex; padding-right:2ex; margin-left:auto; margin-right:auto}
.title{margin:2ex auto;text-align:center}
.titlemain{margin:1ex 2ex 2ex 1ex;}
.titlerest{margin:0ex 2ex;}
.center{text-align:center;margin-left:auto;margin-right:auto;}
.flushleft{text-align:left;margin-left:0ex;margin-right:auto;}
.flushright{text-align:right;margin-left:auto;margin-right:0ex;}
div table{margin-left:inherit;margin-right:inherit;margin-bottom:2px;margin-top:2px}
td table{margin:auto;}
table{border-collapse:collapse;}
td{padding:0;}
.cellpadding0 tr td{padding:0;}
.cellpadding1 tr td{padding:1px;}
pre{text-align:left;margin-left:0ex;margin-right:auto;}
blockquote{margin-left:4ex;margin-right:4ex;text-align:left;}
td p{margin:0px;}
.boxed{border:1px solid black}
.textboxed{border:1px solid black}
.vbar{border:none;width:2px;background-color:black;}
.hbar{border:none;height:2px;width:100%;background-color:black;}
.hfill{border:none;height:1px;width:200%;background-color:black;}
.vdisplay{border-collapse:separate;border-spacing:2px;width:auto; empty-cells:show; border:2px solid red;}
.vdcell{white-space:nowrap;padding:0px; border:2px solid green;}
.display{border-collapse:separate;border-spacing:2px;width:auto; border:none;}
.dcell{white-space:nowrap;padding:0px; border:none;}
.dcenter{margin:0ex auto;}
.vdcenter{border:solid #FF8000 2px; margin:0ex auto;}
.minipage{text-align:left; margin-left:0em; margin-right:auto;}
.marginpar{border:solid thin black; width:20%; text-align:left;}
.marginparleft{float:left; margin-left:0ex; margin-right:1ex;}
.marginparright{float:right; margin-left:1ex; margin-right:0ex;}
.theorem{text-align:left;margin:1ex auto 1ex 0ex;}
.part{margin:2ex auto;text-align:center}
.SPAN{width:20%; float:right; text-align:left; margin-left:auto;}
H1.titlemain HR{display:none;}
TABLE.title{border-top:1px solid grey;border-bottom:1px solid grey; background: #efefef}
H1.chapter A, H2.section A, H3.subsection A, H4.subsubsection A, H5.paragraph A{color:#000000; text-decoration:none;}
H1.chapter, H2.section, H3.subsection, H4.subsubsection, H5.paragraph{border-top: 1px solid grey; background: #efefef; padding: 0.5ex}
pre.verbatim{margin:1ex 2ex;border:1px dashed lightgrey;background-color:#f9f9f9;padding:0.5ex;}
.dt-description{margin:0ex 2ex;}
table[border="1"]{border-collapse:collapse;margin-bottom:1em;}
table[border="1"] td{border:1px solid #aaa;padding:2px}
BLOCKQUOTE.table DIV.center DIV.center HR{display:none;}
BLOCKQUOTE.figure DIV.center DIV.center HR{display:none;}
</style>
<title>
 
 

 ejabberd community
 
 Installation and Operation Guide

 
 




</title>
</head>
<body >
<!--HEVEA command line is: /usr/bin/hevea -fix -pedantic guide.tex -->
<!--CUT STYLE book--><!--CUT DEF chapter 1 --><p><a id="titlepage"></a>

</p><table class="title"><tr><td style="padding:1ex"><h1 class="titlemain">
<hr style="height:2"><br>
<br>

<table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:right;white-space:nowrap" > <span style="font-size:xx-large"><span style="font-weight:bold">ejabberd community</span></span> </td></tr>
<tr><td style="text-align:right;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:right;white-space:nowrap" > <span style="font-size:xx-large">Installation and Operation Guide</span>
</td></tr>
</table><br>
<br>

<hr style="height:2">

</h1></td></tr>
</table><p><a id="toc"></a>
</p><!--TOC chapter id="sec1" Contents-->
<h1 id="sec1" class="chapter">Contents</h1><!--SEC END --><ul class="toc"><li class="li-toc">
<a href="#sec2">Chapter&#XA0;1&#XA0;&#XA0;Introduction</a>
<ul class="toc"><li class="li-toc">
<a href="#sec3">1.1&#XA0;&#XA0;Key Features</a>
</li><li class="li-toc"><a href="#sec4">1.2&#XA0;&#XA0;Additional Features</a>
</li></ul>
</li><li class="li-toc"><a href="#sec5">Chapter&#XA0;2&#XA0;&#XA0;Installing <span style="font-family:monospace">ejabberd</span></a>
<ul class="toc"><li class="li-toc">
<a href="#sec6">2.1&#XA0;&#XA0;Installing <span style="font-family:monospace">ejabberd</span> with Binary Installer</a>
</li><li class="li-toc"><a href="#sec7">2.2&#XA0;&#XA0;Installing <span style="font-family:monospace">ejabberd</span> with Operating System Specific Packages</a>
</li><li class="li-toc"><a href="#sec8">2.3&#XA0;&#XA0;Installing <span style="font-family:monospace">ejabberd</span> with CEAN</a>
</li><li class="li-toc"><a href="#sec9">2.4&#XA0;&#XA0;Installing <span style="font-family:monospace">ejabberd</span> from Source Code</a>
<ul class="toc"><li class="li-toc">
<a href="#sec10">2.4.1&#XA0;&#XA0;Requirements</a>
</li><li class="li-toc"><a href="#sec11">2.4.2&#XA0;&#XA0;Download Source Code</a>
</li><li class="li-toc"><a href="#sec12">2.4.3&#XA0;&#XA0;Compile</a>
</li><li class="li-toc"><a href="#sec13">2.4.4&#XA0;&#XA0;Install</a>
</li><li class="li-toc"><a href="#sec14">2.4.5&#XA0;&#XA0;Start</a>
</li><li class="li-toc"><a href="#sec15">2.4.6&#XA0;&#XA0;Specific Notes for BSD</a>
</li><li class="li-toc"><a href="#sec16">2.4.7&#XA0;&#XA0;Specific Notes for Sun Solaris</a>
</li><li class="li-toc"><a href="#sec17">2.4.8&#XA0;&#XA0;Specific Notes for Microsoft Windows</a>
</li></ul>
</li><li class="li-toc"><a href="#sec20">2.5&#XA0;&#XA0;Create an XMPP Account for Administration</a>
</li><li class="li-toc"><a href="#sec21">2.6&#XA0;&#XA0;Upgrading <span style="font-family:monospace">ejabberd</span></a>
</li></ul>
</li><li class="li-toc"><a href="#sec22">Chapter&#XA0;3&#XA0;&#XA0;Configuring <span style="font-family:monospace">ejabberd</span></a>
<ul class="toc"><li class="li-toc">
<a href="#sec23">3.1&#XA0;&#XA0;Basic Configuration</a>
<ul class="toc"><li class="li-toc">
<a href="#sec24">3.1.1&#XA0;&#XA0;Legacy Configuration File</a>
</li><li class="li-toc"><a href="#sec25">3.1.2&#XA0;&#XA0;Host Names</a>
</li><li class="li-toc"><a href="#sec26">3.1.3&#XA0;&#XA0;Virtual Hosting</a>
</li><li class="li-toc"><a href="#sec27">3.1.4&#XA0;&#XA0;Listening Ports</a>
</li><li class="li-toc"><a href="#sec32">3.1.5&#XA0;&#XA0;Authentication</a>
</li><li class="li-toc"><a href="#sec37">3.1.6&#XA0;&#XA0;Access Rules</a>
</li><li class="li-toc"><a href="#sec42">3.1.7&#XA0;&#XA0;Shapers</a>
</li><li class="li-toc"><a href="#sec43">3.1.8&#XA0;&#XA0;Default Language</a>
</li><li class="li-toc"><a href="#sec44">3.1.9&#XA0;&#XA0;CAPTCHA</a>
</li><li class="li-toc"><a href="#sec45">3.1.10&#XA0;&#XA0;STUN and TURN</a>
</li><li class="li-toc"><a href="#sec46">3.1.11&#XA0;&#XA0;SIP</a>
</li><li class="li-toc"><a href="#sec47">3.1.12&#XA0;&#XA0;Include Additional Configuration Files</a>
</li><li class="li-toc"><a href="#sec48">3.1.13&#XA0;&#XA0;Option Macros in Configuration File</a>
</li></ul>
</li><li class="li-toc"><a href="#sec49">3.2&#XA0;&#XA0;Database and LDAP Configuration</a>
<ul class="toc"><li class="li-toc">
<a href="#sec50">3.2.1&#XA0;&#XA0;ODBC</a>
</li><li class="li-toc"><a href="#sec52">3.2.2&#XA0;&#XA0;LDAP</a>
</li></ul>
</li><li class="li-toc"><a href="#sec58">3.3&#XA0;&#XA0;Modules Configuration</a>
<ul class="toc"><li class="li-toc">
<a href="#sec59">3.3.1&#XA0;&#XA0;Modules Overview</a>
</li><li class="li-toc"><a href="#sec60">3.3.2&#XA0;&#XA0;Common Options</a>
</li><li class="li-toc"><a href="#sec63">3.3.3&#XA0;&#XA0;<span style="font-family:monospace">mod_announce</span></a>
</li><li class="li-toc"><a href="#sec64">3.3.4&#XA0;&#XA0;<span style="font-family:monospace">mod_disco</span></a>
</li><li class="li-toc"><a href="#sec65">3.3.5&#XA0;&#XA0;<span style="font-family:monospace">mod_echo</span></a>
</li><li class="li-toc"><a href="#sec66">3.3.6&#XA0;&#XA0;<span style="font-family:monospace">mod_http_bind</span></a>
</li><li class="li-toc"><a href="#sec67">3.3.7&#XA0;&#XA0;<span style="font-family:monospace">mod_http_fileserver</span></a>
</li><li class="li-toc"><a href="#sec68">3.3.8&#XA0;&#XA0;<span style="font-family:monospace">mod_irc</span></a>
</li><li class="li-toc"><a href="#sec69">3.3.9&#XA0;&#XA0;<span style="font-family:monospace">mod_last</span></a>
</li><li class="li-toc"><a href="#sec70">3.3.10&#XA0;&#XA0;<span style="font-family:monospace">mod_muc</span></a>
</li><li class="li-toc"><a href="#sec71">3.3.11&#XA0;&#XA0;<span style="font-family:monospace">mod_muc_log</span></a>
</li><li class="li-toc"><a href="#sec72">3.3.12&#XA0;&#XA0;<span style="font-family:monospace">mod_offline</span></a>
</li><li class="li-toc"><a href="#sec73">3.3.13&#XA0;&#XA0;<span style="font-family:monospace">mod_ping</span></a>
</li><li class="li-toc"><a href="#sec74">3.3.14&#XA0;&#XA0;<span style="font-family:monospace">mod_pres_counter</span></a>
</li><li class="li-toc"><a href="#sec75">3.3.15&#XA0;&#XA0;<span style="font-family:monospace">mod_privacy</span></a>
</li><li class="li-toc"><a href="#sec76">3.3.16&#XA0;&#XA0;<span style="font-family:monospace">mod_private</span></a>
</li><li class="li-toc"><a href="#sec77">3.3.17&#XA0;&#XA0;<span style="font-family:monospace">mod_proxy65</span></a>
</li><li class="li-toc"><a href="#sec78">3.3.18&#XA0;&#XA0;<span style="font-family:monospace">mod_pubsub</span></a>
</li><li class="li-toc"><a href="#sec79">3.3.19&#XA0;&#XA0;<span style="font-family:monospace">mod_register</span></a>
</li><li class="li-toc"><a href="#sec80">3.3.20&#XA0;&#XA0;<span style="font-family:monospace">mod_register_web</span></a>
</li><li class="li-toc"><a href="#sec81">3.3.21&#XA0;&#XA0;<span style="font-family:monospace">mod_roster</span></a>
</li><li class="li-toc"><a href="#sec82">3.3.22&#XA0;&#XA0;<span style="font-family:monospace">mod_service_log</span></a>
</li><li class="li-toc"><a href="#sec83">3.3.23&#XA0;&#XA0;<span style="font-family:monospace">mod_shared_roster</span></a>
</li><li class="li-toc"><a href="#sec84">3.3.24&#XA0;&#XA0;<span style="font-family:monospace">mod_shared_roster_ldap</span></a>
</li><li class="li-toc"><a href="#sec94">3.3.25&#XA0;&#XA0;<span style="font-family:monospace">mod_sic</span></a>
</li><li class="li-toc"><a href="#sec95">3.3.26&#XA0;&#XA0;<span style="font-family:monospace">mod_sip</span></a>
</li><li class="li-toc"><a href="#sec96">3.3.27&#XA0;&#XA0;<span style="font-family:monospace">mod_stats</span></a>
</li><li class="li-toc"><a href="#sec97">3.3.28&#XA0;&#XA0;<span style="font-family:monospace">mod_time</span></a>
</li><li class="li-toc"><a href="#sec98">3.3.29&#XA0;&#XA0;<span style="font-family:monospace">mod_vcard</span></a>
</li><li class="li-toc"><a href="#sec99">3.3.30&#XA0;&#XA0;<span style="font-family:monospace">mod_vcard_ldap</span></a>
</li><li class="li-toc"><a href="#sec100">3.3.31&#XA0;&#XA0;<span style="font-family:monospace">mod_vcard_xupdate</span></a>
</li><li class="li-toc"><a href="#sec101">3.3.32&#XA0;&#XA0;<span style="font-family:monospace">mod_version</span></a>
</li></ul>
</li></ul>
</li><li class="li-toc"><a href="#sec102">Chapter&#XA0;4&#XA0;&#XA0;Managing an <span style="font-family:monospace">ejabberd</span> Server</a>
<ul class="toc"><li class="li-toc">
<a href="#sec103">4.1&#XA0;&#XA0;<span style="font-family:monospace">ejabberdctl</span></a>
<ul class="toc"><li class="li-toc">
<a href="#sec104">4.1.1&#XA0;&#XA0;ejabberdctl Commands</a>
</li><li class="li-toc"><a href="#sec105">4.1.2&#XA0;&#XA0;Erlang Runtime System</a>
</li></ul>
</li><li class="li-toc"><a href="#sec106">4.2&#XA0;&#XA0;<span style="font-family:monospace">ejabberd</span> Commands</a>
<ul class="toc"><li class="li-toc">
<a href="#sec107">4.2.1&#XA0;&#XA0;List of ejabberd Commands</a>
</li><li class="li-toc"><a href="#sec108">4.2.2&#XA0;&#XA0;Restrict Execution with AccessCommands</a>
</li></ul>
</li><li class="li-toc"><a href="#sec109">4.3&#XA0;&#XA0;Web Admin</a>
</li><li class="li-toc"><a href="#sec110">4.4&#XA0;&#XA0;Ad-hoc Commands</a>
</li><li class="li-toc"><a href="#sec111">4.5&#XA0;&#XA0;Change Computer Hostname</a>
</li></ul>
</li><li class="li-toc"><a href="#sec112">Chapter&#XA0;5&#XA0;&#XA0;Securing <span style="font-family:monospace">ejabberd</span></a>
<ul class="toc"><li class="li-toc">
<a href="#sec113">5.1&#XA0;&#XA0;Firewall Settings</a>
</li><li class="li-toc"><a href="#sec114">5.2&#XA0;&#XA0;epmd</a>
</li><li class="li-toc"><a href="#sec115">5.3&#XA0;&#XA0;Erlang Cookie</a>
</li><li class="li-toc"><a href="#sec116">5.4&#XA0;&#XA0;Erlang Node Name</a>
</li><li class="li-toc"><a href="#sec117">5.5&#XA0;&#XA0;Securing Sensitive Files</a>
</li></ul>
</li><li class="li-toc"><a href="#sec118">Chapter&#XA0;6&#XA0;&#XA0;Clustering</a>
<ul class="toc"><li class="li-toc">
<a href="#sec119">6.1&#XA0;&#XA0;How it Works</a>
<ul class="toc"><li class="li-toc">
<a href="#sec120">6.1.1&#XA0;&#XA0;Router</a>
</li><li class="li-toc"><a href="#sec121">6.1.2&#XA0;&#XA0;Local Router</a>
</li><li class="li-toc"><a href="#sec122">6.1.3&#XA0;&#XA0;Session Manager</a>
</li><li class="li-toc"><a href="#sec123">6.1.4&#XA0;&#XA0;s2s Manager</a>
</li></ul>
</li><li class="li-toc"><a href="#sec124">6.2&#XA0;&#XA0;Clustering Setup</a>
</li><li class="li-toc"><a href="#sec125">6.3&#XA0;&#XA0;Service Load-Balancing</a>
<ul class="toc"><li class="li-toc">
<a href="#sec126">6.3.1&#XA0;&#XA0;Domain Load-Balancing Algorithm</a>
</li><li class="li-toc"><a href="#sec127">6.3.2&#XA0;&#XA0;Load-Balancing Buckets</a>
</li></ul>
</li></ul>
</li><li class="li-toc"><a href="#sec128">Chapter&#XA0;7&#XA0;&#XA0;Debugging</a>
<ul class="toc"><li class="li-toc">
<a href="#sec129">7.1&#XA0;&#XA0;Log Files</a>
</li><li class="li-toc"><a href="#sec130">7.2&#XA0;&#XA0;Debug Console</a>
</li><li class="li-toc"><a href="#sec131">7.3&#XA0;&#XA0;Watchdog Alerts</a>
</li></ul>
</li><li class="li-toc"><a href="#sec132">Appendix&#XA0;A&#XA0;&#XA0;Internationalization and Localization</a>
</li><li class="li-toc"><a href="#sec133">Appendix&#XA0;B&#XA0;&#XA0;Release Notes</a>
</li><li class="li-toc"><a href="#sec134">Appendix&#XA0;C&#XA0;&#XA0;Acknowledgements</a>
</li><li class="li-toc"><a href="#sec135">Appendix&#XA0;D&#XA0;&#XA0;Copyright Information</a>
</li></ul>
<!--TOC chapter id="sec2" Introduction-->
<h1 id="sec2" class="chapter">Chapter&#XA0;1&#XA0;&#XA0;Introduction</h1><!--SEC END --><p>
<a id="intro"></a></p><p><span style="font-family:monospace">ejabberd</span> is a free and open source instant messaging server written in <a href="http://www.erlang.org/">Erlang/OTP</a>.</p><p><span style="font-family:monospace">ejabberd</span> is cross-platform, distributed, fault-tolerant, and based on open standards to achieve real-time communication.</p><p><span style="font-family:monospace">ejabberd</span> is designed to be a rock-solid and feature rich XMPP server.</p><p><span style="font-family:monospace">ejabberd</span> is suitable for small deployments, whether they need to be scalable or not, as well as extremely big deployments.</p>
<!--TOC section id="sec3" Key Features-->
<h2 id="sec3" class="section">1.1&#XA0;&#XA0;Key Features</h2><!--SEC END --><p>
<a id="keyfeatures"></a>
</p><p><span style="font-family:monospace">ejabberd</span> is:
</p><ul class="itemize"><li class="li-itemize">
Cross-platform: <span style="font-family:monospace">ejabberd</span> runs under Microsoft Windows and Unix derived systems such as Linux, FreeBSD and NetBSD.</li><li class="li-itemize">Distributed: You can run <span style="font-family:monospace">ejabberd</span> on a cluster of machines and all of them will serve the same Jabber domain(s). When you need more capacity you can simply add a new cheap node to your cluster. Accordingly, you do not need to buy an expensive high-end machine to support tens of thousands concurrent users.</li><li class="li-itemize">Fault-tolerant: You can deploy an <span style="font-family:monospace">ejabberd</span> cluster so that all the information required for a properly working service will be replicated permanently on all nodes. This means that if one of the nodes crashes, the others will continue working without disruption. In addition, nodes also can be added or replaced &#X2018;on the fly&#X2019;.</li><li class="li-itemize">Administrator Friendly: <span style="font-family:monospace">ejabberd</span> is built on top of the Open Source Erlang. As a result you do not need to install an external database, an external web server, amongst others because everything is already included, and ready to run out of the box. Other administrator benefits include:
<ul class="itemize"><li class="li-itemize">
Comprehensive documentation.
</li><li class="li-itemize">Straightforward installers for Linux, Mac OS X, and Windows. </li><li class="li-itemize">Web Administration.
</li><li class="li-itemize">Shared Roster Groups.
</li><li class="li-itemize">Command line administration tool. </li><li class="li-itemize">Can integrate with existing authentication mechanisms.
</li><li class="li-itemize">Capability to send announce messages.
</li></ul></li><li class="li-itemize">Internationalized: <span style="font-family:monospace">ejabberd</span> leads in internationalization. Hence it is very well suited in a globalized world. Related features are:
<ul class="itemize"><li class="li-itemize">
Translated to 25 languages. </li><li class="li-itemize">Support for <a href="http://www.ietf.org/rfc/rfc3490.txt">IDNA</a>.
</li></ul></li><li class="li-itemize">Open Standards: <span style="font-family:monospace">ejabberd</span> is the first Open Source Jabber server claiming to fully comply to the XMPP standard.
<ul class="itemize"><li class="li-itemize">
Fully XMPP compliant.
</li><li class="li-itemize">XML-based protocol.
</li><li class="li-itemize"><a href="http://www.ejabberd.im/protocols">Many protocols supported</a>.
</li></ul></li></ul>
<!--TOC section id="sec4" Additional Features-->
<h2 id="sec4" class="section">1.2&#XA0;&#XA0;Additional Features</h2><!--SEC END --><p>
<a id="addfeatures"></a>
</p><p>Moreover, <span style="font-family:monospace">ejabberd</span> comes with a wide range of other state-of-the-art features:
</p><ul class="itemize"><li class="li-itemize">
Modular
<ul class="itemize"><li class="li-itemize">
Load only the modules you want.
</li><li class="li-itemize">Extend <span style="font-family:monospace">ejabberd</span> with your own custom modules.
</li></ul>
</li><li class="li-itemize">Security
<ul class="itemize"><li class="li-itemize">
SASL and STARTTLS for c2s and s2s connections.
</li><li class="li-itemize">STARTTLS and Dialback s2s connections.
</li><li class="li-itemize">Web Admin accessible via HTTPS secure access.
</li></ul>
</li><li class="li-itemize">Databases
<ul class="itemize"><li class="li-itemize">
Internal database for fast deployment (Mnesia).
</li><li class="li-itemize">Native MySQL support.
</li><li class="li-itemize">Native PostgreSQL support.
</li><li class="li-itemize">ODBC data storage support.
</li><li class="li-itemize">Microsoft SQL Server support. </li></ul>
</li><li class="li-itemize">Authentication
<ul class="itemize"><li class="li-itemize">
Internal Authentication.
</li><li class="li-itemize">PAM, LDAP and ODBC. </li><li class="li-itemize">External Authentication script.
</li></ul>
</li><li class="li-itemize">Others
<ul class="itemize"><li class="li-itemize">
Support for virtual hosting.
</li><li class="li-itemize">Compressing XML streams with Stream Compression (<a href="http://xmpp.org/extensions/xep-0138.html">XEP-0138</a>).
</li><li class="li-itemize">Statistics via Statistics Gathering (<a href="http://xmpp.org/extensions/xep-0039.html">XEP-0039</a>).
</li><li class="li-itemize">IPv6 support both for c2s and s2s connections.
</li><li class="li-itemize"><a href="http://xmpp.org/extensions/xep-0045.html">Multi-User Chat</a> module with support for clustering and HTML logging. </li><li class="li-itemize">Users Directory based on users vCards.
</li><li class="li-itemize"><a href="http://xmpp.org/extensions/xep-0060.html">Publish-Subscribe</a> component with support for <a href="http://xmpp.org/extensions/xep-0163.html">Personal Eventing via Pubsub</a>.
</li><li class="li-itemize">Support for web clients: <a href="http://xmpp.org/extensions/xep-0025.html">HTTP Polling</a> and <a href="http://xmpp.org/extensions/xep-0206.html">HTTP Binding (BOSH)</a> services.
</li><li class="li-itemize">IRC transport.
</li><li class="li-itemize">SIP support.
</li><li class="li-itemize">Component support: interface with networks such as AIM, ICQ and MSN installing special tranports.
</li></ul>
</li></ul><p> <a id="installing"></a> </p>
<!--TOC chapter id="sec5" Installing <span style="font-family:monospace">ejabberd</span>-->
<h1 id="sec5" class="chapter">Chapter&#XA0;2&#XA0;&#XA0;<a href="#installing">Installing <span style="font-family:monospace">ejabberd</span></a></h1><!--SEC END --><p> <a id="installing"></a> </p><p> <a id="install.binary"></a> </p>
<!--TOC section id="sec6" Installing <span style="font-family:monospace">ejabberd</span> with Binary Installer-->
<h2 id="sec6" class="section">2.1&#XA0;&#XA0;<a href="#install.binary">Installing <span style="font-family:monospace">ejabberd</span> with Binary Installer</a></h2><!--SEC END --><p> <a id="install.binary"></a> </p><p>Probably the easiest way to install an <span style="font-family:monospace">ejabberd</span> instant messaging server
is using the binary installer published by ProcessOne.
The binary installers of released <span style="font-family:monospace">ejabberd</span> versions
are available in the ProcessOne <span style="font-family:monospace">ejabberd</span> downloads page:
<a href="http://www.process-one.net/en/ejabberd/downloads"><span style="font-family:monospace">http://www.process-one.net/en/ejabberd/downloads</span></a></p><p>The installer will deploy and configure a full featured <span style="font-family:monospace">ejabberd</span>
server and does not require any extra dependencies.</p><p>In *nix systems, remember to set executable the binary installer before starting it. For example:
</p><pre class="verbatim">chmod +x ejabberd-2.0.0_1-linux-x86-installer.bin
./ejabberd-2.0.0_1-linux-x86-installer.bin
</pre><p><span style="font-family:monospace">ejabberd</span> can be started manually at any time,
or automatically by the operating system at system boot time.</p><p>To start and stop <span style="font-family:monospace">ejabberd</span> manually,
use the desktop shortcuts created by the installer.
If the machine doesn&#X2019;t have a graphical system, use the scripts &#X2019;start&#X2019;
and &#X2019;stop&#X2019; in the &#X2019;bin&#X2019; directory where <span style="font-family:monospace">ejabberd</span> is installed.</p><p>The Windows installer also adds ejabberd as a system service,
and a shortcut to a debug console for experienced administrators.
If you want ejabberd to be started automatically at boot time,
go to the Windows service settings and set ejabberd to be automatically started.
Note that the Windows service is a feature still in development,
and for example it doesn&#X2019;t read the file ejabberdctl.cfg.</p><p>On a *nix system, if you want ejabberd to be started as daemon at boot time,
copy <span style="font-family:monospace">ejabberd.init</span> from the &#X2019;bin&#X2019; directory to something like <span style="font-family:monospace">/etc/init.d/ejabberd</span>
(depending on your distribution).
Create a system user called <span style="font-family:monospace">ejabberd</span>,
give it write access to the directories <span style="font-family:monospace">database/</span> and <span style="font-family:monospace">logs/</span>, and set that as home;
the script will start the server with that user.
Then you can call <span style="font-family:monospace">/etc/inid.d/ejabberd start</span> as root to start the server.</p><p>When ejabberd is started, the processes that are started in the system
are <span style="font-family:monospace">beam</span> or <span style="font-family:monospace">beam.smp</span>, and also <span style="font-family:monospace">epmd</span>.
In Microsoft Windows, the processes are <span style="font-family:monospace">erl.exe</span> and <span style="font-family:monospace">epmd.exe</span>.
For more information regarding <span style="font-family:monospace">epmd</span> consult the section <a href="#epmd">5.2</a>.</p><p>If <span style="font-family:monospace">ejabberd</span> doesn&#X2019;t start correctly in Windows,
try to start it using the shortcut in desktop or start menu.
If the window shows error 14001, the solution is to install:
"Microsoft Visual C++ 2005 SP1 Redistributable Package".
You can download it from
<a href="http://www.microsoft.com/">www.microsoft.com</a>.
Then uninstall <span style="font-family:monospace">ejabberd</span> and install it again.</p><p>If <span style="font-family:monospace">ejabberd</span> doesn&#X2019;t start correctly and a crash dump is generated,
there was a severe problem.
You can try starting <span style="font-family:monospace">ejabberd</span> with
the script <span style="font-family:monospace">bin/live.bat</span> in Windows,
or with the command <span style="font-family:monospace">bin/ejabberdctl live</span> in other Operating Systems.
This way you see the error message provided by Erlang
and can identify what is exactly the problem.</p><p>The <span style="font-family:monospace">ejabberdctl</span> administration script is included in the <span style="font-family:monospace">bin</span> directory.
Please refer to the section&#XA0;<a href="#ejabberdctl">4.1</a> for details about <span style="font-family:monospace">ejabberdctl</span>,
and configurable options to fine tune the Erlang runtime system.</p><p> <a id="install.os"></a> </p>
<!--TOC section id="sec7" Installing <span style="font-family:monospace">ejabberd</span> with Operating System Specific Packages-->
<h2 id="sec7" class="section">2.2&#XA0;&#XA0;<a href="#install.os">Installing <span style="font-family:monospace">ejabberd</span> with Operating System Specific Packages</a></h2><!--SEC END --><p> <a id="install.os"></a> </p><p>Some Operating Systems provide a specific <span style="font-family:monospace">ejabberd</span> package adapted to
the system architecture and libraries.
It usually also checks dependencies
and performs basic configuration tasks like creating the initial
administrator account. Some examples are Debian and Gentoo. Consult the
resources provided by your Operating System for more information.</p><p>Usually those packages create a script like <span style="font-family:monospace">/etc/init.d/ejabberd</span>
to start and stop <span style="font-family:monospace">ejabberd</span> as a service at boot time.</p><p> <a id="install.cean"></a> </p>
<!--TOC section id="sec8" Installing <span style="font-family:monospace">ejabberd</span> with CEAN-->
<h2 id="sec8" class="section">2.3&#XA0;&#XA0;<a href="#install.cean">Installing <span style="font-family:monospace">ejabberd</span> with CEAN</a></h2><!--SEC END --><p> <a id="install.cean"></a> </p><p><a href="http://cean.process-one.net/">CEAN</a>
(Comprehensive Erlang Archive Network) is a repository that hosts binary
packages from many Erlang programs, including <span style="font-family:monospace">ejabberd</span> and all its dependencies.
The binaries are available for many different system architectures, so this is an
alternative to the binary installer and Operating System&#X2019;s <span style="font-family:monospace">ejabberd</span> packages.</p><p>You will have to create your own <span style="font-family:monospace">ejabberd</span> start
script depending of how you handle your CEAN installation.
The default <span style="font-family:monospace">ejabberdctl</span> script is located
into <span style="font-family:monospace">ejabberd</span>&#X2019;s priv directory and can be used as an example.</p><p> <a id="installation"></a> </p>
<!--TOC section id="sec9" Installing <span style="font-family:monospace">ejabberd</span> from Source Code-->
<h2 id="sec9" class="section">2.4&#XA0;&#XA0;<a href="#installation">Installing <span style="font-family:monospace">ejabberd</span> from Source Code</a></h2><!--SEC END --><p> <a id="installation"></a> 
</p><p>The canonical form for distribution of <span style="font-family:monospace">ejabberd</span> stable releases is the source code package.
Compiling <span style="font-family:monospace">ejabberd</span> from source code is quite easy in *nix systems,
as long as your system have all the dependencies.</p><p> <a id="installreq"></a> </p>
<!--TOC subsection id="sec10" Requirements-->
<h3 id="sec10" class="subsection">2.4.1&#XA0;&#XA0;<a href="#installreq">Requirements</a></h3><!--SEC END --><p> <a id="installreq"></a> 
</p><p>To compile <span style="font-family:monospace">ejabberd</span> on a &#X2018;Unix-like&#X2019; operating system, you need:
</p><ul class="itemize"><li class="li-itemize">
GNU Make
</li><li class="li-itemize">GCC
</li><li class="li-itemize">Libexpat 1.95 or higher
</li><li class="li-itemize">Erlang/OTP R15B or higher.
</li><li class="li-itemize">Libyaml 1.4 or higher
</li><li class="li-itemize">OpenSSL 0.9.8 or higher, for STARTTLS, SASL and SSL encryption.
</li><li class="li-itemize">Zlib 1.2.3 or higher, for Stream Compression support (<a href="http://xmpp.org/extensions/xep-0138.html">XEP-0138</a>). Optional.
</li><li class="li-itemize">PAM library. Optional. For Pluggable Authentication Modules (PAM). See section <a href="#pam">3.1.5</a>.
</li><li class="li-itemize">GNU Iconv 1.8 or higher, for the IRC Transport (mod_irc). Optional. Not needed on systems with GNU Libc. See section <a href="#modirc">3.3.8</a>.
</li><li class="li-itemize">ImageMagick&#X2019;s Convert program. Optional. For CAPTCHA challenges. See section <a href="#captcha">3.1.9</a>.
</li><li class="li-itemize">exmpp 0.9.6 or higher. Optional. For import/export user data with <a href="http://xmpp.org/extensions/xep-0227.html">XEP-0227</a> XML files.
</li></ul><p> <a id="download"></a> </p>
<!--TOC subsection id="sec11" Download Source Code-->
<h3 id="sec11" class="subsection">2.4.2&#XA0;&#XA0;<a href="#download">Download Source Code</a></h3><!--SEC END --><p> <a id="download"></a> 
</p><p>Released versions of <span style="font-family:monospace">ejabberd</span> are available in the ProcessOne <span style="font-family:monospace">ejabberd</span> downloads page:
<a href="http://www.process-one.net/en/ejabberd/downloads"><span style="font-family:monospace">http://www.process-one.net/en/ejabberd/downloads</span></a></p><p>
Alternatively, the latest development source code can be retrieved from the Git repository using the commands:
</p><pre class="verbatim">git clone git://github.com/processone/ejabberd.git ejabberd
cd ejabberd
git checkout -b 2.1.x origin/2.1.x
</pre><p> <a id="compile"></a> </p>
<!--TOC subsection id="sec12" Compile-->
<h3 id="sec12" class="subsection">2.4.3&#XA0;&#XA0;<a href="#compile">Compile</a></h3><!--SEC END --><p> <a id="compile"></a> 
</p><p>To compile <span style="font-family:monospace">ejabberd</span> execute the commands:
</p><pre class="verbatim">./configure
make
</pre><p>The build configuration script allows several options.
To get the full list run the command:
</p><pre class="verbatim">./configure --help
</pre><p>Some options that you may be interested in modifying:
</p><dl class="description"><dt class="dt-description">
	<span style="font-weight:bold"><span style="font-family:monospace">--prefix=/</span></span></dt><dd class="dd-description">
	Specify the path prefix where the files will be copied when running
	the <span style="font-family:monospace">make install</span> command.<p>	</p></dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">--enable-user[=USER]</span></span></dt><dd class="dd-description">
	Allow this normal system user to execute the ejabberdctl script
	(see section&#XA0;<a href="#ejabberdctl">4.1</a>),
	read the configuration files,
	read and write in the spool directory,
	read and write in the log directory.
	The account user and group must exist in the machine
	before running <span style="font-family:monospace">make install</span>.
	This account doesn&#X2019;t need an explicit HOME directory, because
	<span style="font-family:monospace">/var/lib/ejabberd/</span> will be used by default.<p>	</p></dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">--enable-pam</span></span></dt><dd class="dd-description">
	Enable the PAM authentication method (see section <a href="#pam">3.1.5</a>).<p>	</p></dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">--enable-mssql</span></span></dt><dd class="dd-description">
	Required if you want to use an external database.
	See section&#XA0;<a href="#database">3.2</a> for more information.</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">--enable-tools</span></span></dt><dd class="dd-description">
Enable the use of development tools.</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">--enable-mysql</span></span></dt><dd class="dd-description">
Enable MySQL support (see section <a href="#odbc">3.2.1</a>).</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">--enable-pgsql</span></span></dt><dd class="dd-description">
Enable PostgreSQL support (see section <a href="#odbc">3.2.1</a>).</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">--enable-zlib</span></span></dt><dd class="dd-description">
Enable Stream Compression (XEP-0138) using zlib.</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">--enable-stun</span></span></dt><dd class="dd-description">
Enable STUN/TURN support (see section <a href="#stun">3.1.10</a>).</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">--enable-iconv</span></span></dt><dd class="dd-description">
Enable iconv support. This is needed for <span style="font-family:monospace">mod_irc</span> (see seciont <a href="#modirc">3.3.8</a>).</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">--enable-debug</span></span></dt><dd class="dd-description">
Compile with <span style="font-family:monospace">+debug_info</span> enabled.<p>	</p></dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">--enable-full-xml</span></span></dt><dd class="dd-description">
	Enable the use of XML based optimisations.
	It will for example use CDATA to escape characters in the XMPP stream.
	Use this option only if you are sure your XMPP clients include a fully compliant XML parser.<p>	</p></dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">--disable-transient-supervisors</span></span></dt><dd class="dd-description">
	Disable the use of Erlang/OTP supervision for transient processes.<p>	</p></dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">--enable-nif</span></span></dt><dd class="dd-description">
Replaces some critical Erlang functions with equivalents written in C to improve performance.
</dd></dl><p> <a id="install"></a> </p>
<!--TOC subsection id="sec13" Install-->
<h3 id="sec13" class="subsection">2.4.4&#XA0;&#XA0;<a href="#install">Install</a></h3><!--SEC END --><p> <a id="install"></a> 
</p><p>To install <span style="font-family:monospace">ejabberd</span> in the destination directories, run the command:
</p><pre class="verbatim">make install
</pre><p>Note that you probably need administrative privileges in the system
to install <span style="font-family:monospace">ejabberd</span>.</p><p>The files and directories created are, by default:
</p><dl class="description"><dt class="dt-description">
	<span style="font-weight:bold"><span style="font-family:monospace">/etc/ejabberd/</span></span></dt><dd class="dd-description"> Configuration directory:
		<dl class="description"><dt class="dt-description">
			<span style="font-weight:bold"><span style="font-family:monospace">ejabberd.yml</span></span></dt><dd class="dd-description"> ejabberd configuration file
			</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ejabberdctl.cfg</span></span></dt><dd class="dd-description"> Configuration file of the administration script
			</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">inetrc</span></span></dt><dd class="dd-description"> Network DNS configuration file
		</dd></dl>
	</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">/lib/ejabberd/</span></span></dt><dd class="dd-description">
		<dl class="description"><dt class="dt-description">
			<span style="font-weight:bold"><span style="font-family:monospace">ebin/</span></span></dt><dd class="dd-description"> Erlang binary files (*.beam)
			</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">include/</span></span></dt><dd class="dd-description"> Erlang header files (*.hrl)
			</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">priv/</span></span></dt><dd class="dd-description"> Additional files required at runtime
				<dl class="description"><dt class="dt-description">
					<span style="font-weight:bold"><span style="font-family:monospace">bin/</span></span></dt><dd class="dd-description"> Executable programs
					</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">lib/</span></span></dt><dd class="dd-description"> Binary system libraries (*.so)
					</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">msgs/</span></span></dt><dd class="dd-description"> Translation files (*.msgs)
				</dd></dl>
		</dd></dl>
	</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">/sbin/ejabberdctl</span></span></dt><dd class="dd-description"> Administration script (see section&#XA0;<a href="#ejabberdctl">4.1</a>)
	</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">/share/doc/ejabberd/</span></span></dt><dd class="dd-description"> Documentation of ejabberd
	</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">/var/lib/ejabberd/</span></span></dt><dd class="dd-description"> Spool directory:
		<dl class="description"><dt class="dt-description">
			<span style="font-weight:bold"><span style="font-family:monospace">.erlang.cookie</span></span></dt><dd class="dd-description"> Erlang cookie file (see section <a href="#cookie">5.3</a>)
			</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">acl.DCD, ...</span></span></dt><dd class="dd-description"> Mnesia database spool files (*.DCD, *.DCL, *.DAT)
		</dd></dl>
	</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">/var/log/ejabberd/</span></span></dt><dd class="dd-description"> Log directory (see section&#XA0;<a href="#logfiles">7.1</a>):
		<dl class="description"><dt class="dt-description">
			<span style="font-weight:bold"><span style="font-family:monospace">ejabberd.log</span></span></dt><dd class="dd-description"> ejabberd service log
			</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">erlang.log</span></span></dt><dd class="dd-description"> Erlang/OTP system log
		</dd></dl>
</dd></dl><p> <a id="start"></a> </p>
<!--TOC subsection id="sec14" Start-->
<h3 id="sec14" class="subsection">2.4.5&#XA0;&#XA0;<a href="#start">Start</a></h3><!--SEC END --><p> <a id="start"></a> 
</p><p>You can use the <span style="font-family:monospace">ejabberdctl</span> command line administration script to start and stop <span style="font-family:monospace">ejabberd</span>.
If you provided the configure option <span style="font-family:monospace">--enable-user=USER</span> (see <a href="#compile">2.4.3</a>),
you can execute <span style="font-family:monospace">ejabberdctl</span> with either that system account or root.</p><p>Usage example:
</p><pre class="verbatim">ejabberdctl start

ejabberdctl status
The node ejabberd@localhost is started with status: started
ejabberd is running in that node

ejabberdctl stop
</pre><p>If <span style="font-family:monospace">ejabberd</span> doesn&#X2019;t start correctly and a crash dump is generated,
there was a severe problem.
You can try starting <span style="font-family:monospace">ejabberd</span> with
the command <span style="font-family:monospace">ejabberdctl live</span>
to see the error message provided by Erlang
and can identify what is exactly the problem.</p><p>Please refer to the section&#XA0;<a href="#ejabberdctl">4.1</a> for details about <span style="font-family:monospace">ejabberdctl</span>,
and configurable options to fine tune the Erlang runtime system.</p><p>If you want ejabberd to be started as daemon at boot time,
copy <span style="font-family:monospace">ejabberd.init</span> to something like <span style="font-family:monospace">/etc/init.d/ejabberd</span>
(depending on your distribution).
Create a system user called <span style="font-family:monospace">ejabberd</span>;
it will be used by the script to start the server.
Then you can call <span style="font-family:monospace">/etc/inid.d/ejabberd start</span> as root to start the server.</p><p> <a id="bsd"></a> </p>
<!--TOC subsection id="sec15" Specific Notes for BSD-->
<h3 id="sec15" class="subsection">2.4.6&#XA0;&#XA0;<a href="#bsd">Specific Notes for BSD</a></h3><!--SEC END --><p> <a id="bsd"></a> 
</p><p>The command to compile <span style="font-family:monospace">ejabberd</span> in BSD systems is:
</p><pre class="verbatim">gmake
</pre><p> <a id="solaris"></a> </p>
<!--TOC subsection id="sec16" Specific Notes for Sun Solaris-->
<h3 id="sec16" class="subsection">2.4.7&#XA0;&#XA0;<a href="#solaris">Specific Notes for Sun Solaris</a></h3><!--SEC END --><p> <a id="solaris"></a> 
</p><p>You need to have <span style="font-family:monospace">GNU install</span>,
but it isn&#X2019;t included in Solaris.
It can be easily installed if your Solaris system
is set up for <a href="http://www.blastwave.org/">blastwave.org</a>
package repository.
Make sure <span style="font-family:monospace">/opt/csw/bin</span> is in your <span style="font-family:monospace">PATH</span> and run:
</p><pre class="verbatim">pkg-get -i fileutils
</pre><p>If that program is called <span style="font-family:monospace">ginstall</span>,
modify the <span style="font-family:monospace">ejabberd</span> <span style="font-family:monospace">Makefile</span> script to suit your system,
for example:
</p><pre class="verbatim">cat Makefile | sed s/install/ginstall/ &gt; Makefile.gi
</pre><p>And finally install <span style="font-family:monospace">ejabberd</span> with:
</p><pre class="verbatim">gmake -f Makefile.gi ginstall
</pre><p> <a id="windows"></a> </p>
<!--TOC subsection id="sec17" Specific Notes for Microsoft Windows-->
<h3 id="sec17" class="subsection">2.4.8&#XA0;&#XA0;<a href="#windows">Specific Notes for Microsoft Windows</a></h3><!--SEC END --><p> <a id="windows"></a> 
</p><p> <a id="windowsreq"></a> </p>
<!--TOC subsubsection id="sec18" Requirements-->
<h4 id="sec18" class="subsubsection"><a href="#windowsreq">Requirements</a></h4><!--SEC END --><p> <a id="windowsreq"></a> </p><p>To compile <span style="font-family:monospace">ejabberd</span> on a Microsoft Windows system, you need:
</p><ul class="itemize"><li class="li-itemize">
MS Visual C++ 6.0 Compiler
</li><li class="li-itemize"><a href="http://www.erlang.org/download.html">Erlang/OTP R11B-5</a>
</li><li class="li-itemize"><a href="http://sourceforge.net/project/showfiles.php?group_id=10127&package_id=11277">Expat 2.0.0 or higher</a>
</li><li class="li-itemize"><a href="http://www.gnu.org/software/libiconv/">GNU Iconv 1.9.2</a>
(optional)
</li><li class="li-itemize"><a href="http://www.slproweb.com/products/Win32OpenSSL.html">Shining Light OpenSSL 0.9.8d or higher</a>
(to enable SSL connections)
</li><li class="li-itemize"><a href="http://www.zlib.net/">Zlib 1.2.3 or higher</a>
</li></ul><p> <a id="windowscom"></a> </p>
<!--TOC subsubsection id="sec19" Compilation-->
<h4 id="sec19" class="subsubsection"><a href="#windowscom">Compilation</a></h4><!--SEC END --><p> <a id="windowscom"></a> </p><p>We assume that we will try to put as much library as possible into <code>C:\sdk\</code> to make it easier to track what is install for <span style="font-family:monospace">ejabberd</span>.</p><ol class="enumerate" type=1><li class="li-enumerate">
Install Erlang emulator (for example, into <code>C:\sdk\erl5.5.5</code>).
</li><li class="li-enumerate">Install Expat library into <code>C:\sdk\Expat-2.0.0</code>
directory.<p>Copy file <code>C:\sdk\Expat-2.0.0\Libs\libexpat.dll</code>
to your Windows system directory (for example, <code>C:\WINNT</code> or
<code>C:\WINNT\System32</code>)
</p></li><li class="li-enumerate">Build and install the Iconv library into the directory
<code>C:\sdk\GnuWin32</code>.<p>Copy file <code>C:\sdk\GnuWin32\bin\lib*.dll</code> to your
Windows system directory (more installation instructions can be found in the
file README.woe32 in the iconv distribution).</p><p>Note: instead of copying libexpat.dll and iconv.dll to the Windows
directory, you can add the directories
<code>C:\sdk\Expat-2.0.0\Libs</code> and
<code>C:\sdk\GnuWin32\bin</code> to the <code>PATH</code> environment
variable.
</p></li><li class="li-enumerate">Install OpenSSL in <code>C:\sdk\OpenSSL</code> and add <code>C:\sdk\OpenSSL\lib\VC</code> to your path or copy the binaries to your system directory.
</li><li class="li-enumerate">Install ZLib in <code>C:\sdk\gnuWin32</code>. Copy
<code>C:\sdk\GnuWin32\bin\zlib1.dll</code> to your system directory. If you change your path it should already be set after libiconv install.
</li><li class="li-enumerate">Make sure the you can access Erlang binaries from your path. For example: <code>set PATH=%PATH%;"C:\sdk\erl5.6.5\bin"</code>
</li><li class="li-enumerate">Depending on how you end up actually installing the library you might need to check and tweak the paths in the file configure.erl.
</li><li class="li-enumerate">While in the directory <code>ejabberd\src</code> run:
<pre class="verbatim">configure.bat
nmake -f Makefile.win32
</pre></li><li class="li-enumerate">Edit the file <code>ejabberd\src\ejabberd.yml</code> and run
<pre class="verbatim">werl -s ejabberd -name ejabberd
</pre></li></ol><p> <a id="initialadmin"></a> </p>
<!--TOC section id="sec20" Create an XMPP Account for Administration-->
<h2 id="sec20" class="section">2.5&#XA0;&#XA0;<a href="#initialadmin">Create an XMPP Account for Administration</a></h2><!--SEC END --><p> <a id="initialadmin"></a> </p><p>You need an XMPP account and grant him administrative privileges
to enter the <span style="font-family:monospace">ejabberd</span> Web Admin:
</p><ol class="enumerate" type=1><li class="li-enumerate">
Register an XMPP account on your <span style="font-family:monospace">ejabberd</span> server, for example <span style="font-family:monospace">admin1@example.org</span>.
There are two ways to register an XMPP account:
<ol class="enumerate" type=a><li class="li-enumerate">
Using <span style="font-family:monospace">ejabberdctl</span> (see section&#XA0;<a href="#ejabberdctl">4.1</a>):
<pre class="verbatim">ejabberdctl register admin1 example.org FgT5bk3
</pre></li><li class="li-enumerate">Using an XMPP client and In-Band Registration (see section&#XA0;<a href="#modregister">3.3.19</a>).
</li></ol>
</li><li class="li-enumerate">Edit the <span style="font-family:monospace">ejabberd</span> configuration file to give administration rights to the XMPP account you created:
<pre class="verbatim">acl:
  admin:
    user:
      - "admin1": "example.org"
access:
  configure:
    admin: allow
</pre>You can grant administrative privileges to many XMPP accounts,
and also to accounts in other XMPP servers.
</li><li class="li-enumerate">Restart <span style="font-family:monospace">ejabberd</span> to load the new configuration.
</li><li class="li-enumerate">Open the Web Admin (<code>http://server:port/admin/</code>) in your
favourite browser. Make sure to enter the <em>full</em> JID as username (in this
example: <span style="font-family:monospace">admin1@example.org</span>. The reason that you also need to enter the
suffix, is because <span style="font-family:monospace">ejabberd</span>&#X2019;s virtual hosting support.
</li></ol><p> <a id="upgrade"></a> </p>
<!--TOC section id="sec21" Upgrading <span style="font-family:monospace">ejabberd</span>-->
<h2 id="sec21" class="section">2.6&#XA0;&#XA0;<a href="#upgrade">Upgrading <span style="font-family:monospace">ejabberd</span></a></h2><!--SEC END --><p> <a id="upgrade"></a> </p><p>To upgrade an ejabberd installation to a new version,
simply uninstall the old version, and then install the new one.
Of course, it is important that the configuration file
and Mnesia database spool directory are not removed.</p><p><span style="font-family:monospace">ejabberd</span> automatically updates the Mnesia table definitions at startup when needed.
If you also use an external database for storage of some modules,
check if the release notes of the new ejabberd version
indicates you need to also update those tables.</p><p> <a id="configure"></a> </p>
<!--TOC chapter id="sec22" Configuring <span style="font-family:monospace">ejabberd</span>-->
<h1 id="sec22" class="chapter">Chapter&#XA0;3&#XA0;&#XA0;<a href="#configure">Configuring <span style="font-family:monospace">ejabberd</span></a></h1><!--SEC END --><p> <a id="configure"></a> 
</p><p> <a id="basicconfig"></a> </p>
<!--TOC section id="sec23" Basic Configuration-->
<h2 id="sec23" class="section">3.1&#XA0;&#XA0;<a href="#basicconfig">Basic Configuration</a></h2><!--SEC END --><p> <a id="basicconfig"></a> </p><p>The configuration file will be loaded the first time you start <span style="font-family:monospace">ejabberd</span>.
The configuration file name MUST have &#X201C;.yml&#X201D; extension. This helps ejabberd
to differentiate between the new and legacy file formats (see section&#XA0;<a href="#oldconfig">3.1.1</a>).</p><p>Note that <span style="font-family:monospace">ejabberd</span> never edits the configuration file.</p><p>The configuration file is written in
<a href="http://en.wikipedia.org/wiki/YAML">YAML</a>.
However, different scalars are treated as different types:
</p><ul class="itemize"><li class="li-itemize">
unquoted or single-quoted strings. The type is called <code>atom()</code>
in this document.
Examples: <code>dog</code>, <code>'Jupiter'</code>, <code>'3.14159'</code>, <code>YELLOW</code>.
</li><li class="li-itemize">numeric literals. The type is called <code>integer()</code>, <code>float()</code> or,
if both are allowed, <code>number()</code>.
Examples: <code>3</code>, <code>-45.0</code>, <code>.0</code>
</li><li class="li-itemize">double-quoted or folded strings. The type is called <code>string()</code>.
Examples of a double-quoted string:
<code>"Lizzard"</code>, <code>"orange"</code>, <code>"3.14159"</code>.
Examples of a folded string:
<pre class="verbatim">&gt; Art thou not Romeo,
  and a Montague?
</pre><pre class="verbatim">| Neither, fair saint,
  if either thee dislike.
</pre>For associative arrays ("mappings") and lists you can use both outline
indentation and compact syntax (aka &#X201C;JSON style&#X201D;). For example, the following is equivalent:
<pre class="verbatim">{param1: ["val1", "val2"], param2: ["val3", "val4"]}
</pre>and
<pre class="verbatim">param1:
  - "val1"
  - "val2"
param2:
  - "val3"
  - "val4"
</pre>Note that both styles are used in this document.
</li></ul><p> <a id="oldconfig"></a> </p>
<!--TOC subsection id="sec24" Legacy Configuration File-->
<h3 id="sec24" class="subsection">3.1.1&#XA0;&#XA0;<a href="#oldconfig">Legacy Configuration File</a></h3><!--SEC END --><p> <a id="oldconfig"></a> 
In previous <span style="font-family:monospace">ejabberd</span> version the configuration file should be written
in Erlang terms. The format is still supported, but it is highly recommended
to convert it to the new YAML format using <span style="font-family:monospace">convert_to_yaml</span> command
from <span style="font-family:monospace">ejabberdctl</span> (see&#XA0;<a href="#ejabberdctl">4.1</a> and <a href="#list-eja-commands">4.2.1</a> for details).</p><p> <a id="hostnames"></a> </p>
<!--TOC subsection id="sec25" Host Names-->
<h3 id="sec25" class="subsection">3.1.2&#XA0;&#XA0;<a href="#hostnames">Host Names</a></h3><!--SEC END --><p> <a id="hostnames"></a> 
</p><p>The option <span style="font-family:monospace">hosts</span> defines a list containing one or more domains that
<span style="font-family:monospace">ejabberd</span> will serve.</p><p>The syntax is:
</p><dl class="description"><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">[HostName]</span></span></dt></dl><p>Examples:
</p><ul class="itemize"><li class="li-itemize">
Serving one domain:
<pre class="verbatim">hosts: ["example.org"]
</pre></li><li class="li-itemize">Serving three domains:
<pre class="verbatim">hosts:
  - "example.net"
  - "example.com"
  - "jabber.somesite.org"
</pre></li></ul><p> <a id="virtualhost"></a> </p>
<!--TOC subsection id="sec26" Virtual Hosting-->
<h3 id="sec26" class="subsection">3.1.3&#XA0;&#XA0;<a href="#virtualhost">Virtual Hosting</a></h3><!--SEC END --><p> <a id="virtualhost"></a> 
</p><p>Options can be defined separately for every virtual host using the
<span style="font-family:monospace">host_config</span> option.</p><p>The syntax is: 
</p><dl class="description"><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">{HostName: [Option, ...]}</span></span></dt></dl><p>Examples:
</p><ul class="itemize"><li class="li-itemize">
Domain <span style="font-family:monospace">example.net</span> is using the internal authentication method while
domain <span style="font-family:monospace">example.com</span> is using the LDAP server running on the
domain <span style="font-family:monospace">localhost</span> to perform authentication:
<pre class="verbatim">host_config:
  "example.net"
    auth_method: internal
  "example.com":
    auth_method: ldap
    ldap_servers:
      - "localhost"
    ldap_uids:
      - "uid"
    ldap_rootdn: "dc=localdomain"
    ldap_rootdn: "dc=example,dc=com"
    ldap_password: ""
</pre></li><li class="li-itemize">Domain <span style="font-family:monospace">example.net</span> is using ODBC to perform authentication
while domain <span style="font-family:monospace">example.com</span> is using the LDAP servers running on the domains
<span style="font-family:monospace">localhost</span> and <span style="font-family:monospace">otherhost</span>:
<pre class="verbatim">host_config:
  "example.net":
    auth_method: odbc
    odbc_type: odbc
    odbc_server: "DSN=ejabberd;UID=ejabberd;PWD=ejabberd"
  "example.com":
    auth_method: ldap
    ldap_servers:
      - "localhost"
      - "otherhost"
    ldap_uids:
      - "uid"
    ldap_rootdn: "dc=localdomain"
    ldap_rootdn: "dc=example,dc=com"
    ldap_password: ""
</pre></li></ul><p>To define specific ejabberd modules in a virtual host,
you can define the global <span style="font-family:monospace">modules</span> option with the common modules,
and later add specific modules to certain virtual hosts.
To accomplish that, instead of defining each option in <span style="font-family:monospace">host_config</span>
use <span style="font-family:monospace">append_host_config</span> with the same syntax.</p><p>In this example three virtual hosts have some similar modules, but there are also
other different modules for some specific virtual hosts:
</p><pre class="verbatim">## This ejabberd server has three vhosts:
hosts:
  - "one.example.org"
  - "two.example.org"
  - "three.example.org"

## Configuration of modules that are common to all vhosts
modules:
  mod_roster:    {}
  mod_configure: {}
  mod_disco:     {}
  mod_private:   {}
  mod_time:      {}
  mod_last:      {}
  mod_version:   {}

## Add some modules to vhost one:
append_host_config:
  "one.example.org":
    modules:
      mod_echo:
        host: "echo-service.one.example.org"
      mod_http_bind: {}
      mod_logxml: {}

## Add a module just to vhost two:
append_host_config:
  "two.example.org":
    modules:
      mod_echo:
        host: "mirror.two.example.org"
</pre><p> <a id="listened"></a> </p>
<!--TOC subsection id="sec27" Listening Ports-->
<h3 id="sec27" class="subsection">3.1.4&#XA0;&#XA0;<a href="#listened">Listening Ports</a></h3><!--SEC END --><p> <a id="listened"></a> 
</p><p>The option <span style="font-family:monospace">listen</span> defines for which ports, addresses and network protocols <span style="font-family:monospace">ejabberd</span>
will listen and what services will be run on them. Each element of the list is an
associative array with the following elements:
</p><ul class="itemize"><li class="li-itemize">
Port number. Optionally also the IP address and/or a transport protocol.
</li><li class="li-itemize">Listening module that serves this port.
</li><li class="li-itemize">Options for the TCP socket and for the listening module.
</li></ul><p>The option syntax is:
</p><dl class="description"><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">[Listener, ...]</span></span></dt></dl><p>
Example:
</p><pre class="verbatim">listen:
  -
    port: 5222
    module: ejabberd_c2s
    starttls: true
    certfile: "/path/to/certfile.pem"
  -
    port: 5269
    module: ejabberd_s2s_in
    transport: tcp
</pre><p> <a id="listened-port"></a> </p>
<!--TOC subsubsection id="sec28" Port Number, IP Address and Transport Protocol-->
<h4 id="sec28" class="subsubsection"><a href="#listened-port">Port Number, IP Address and Transport Protocol</a></h4><!--SEC END --><p> <a id="listened-port"></a> </p><p>The port number defines which port to listen for incoming connections.
It can be a Jabber/XMPP standard port 
(see section <a href="#firewall">5.1</a>) or any other valid port number.</p><p>The IP address can be represented as a string.
The socket will listen only in that network interface.
It is possible to specify a generic address,
so <span style="font-family:monospace">ejabberd</span> will listen in all addresses.
Depending in the type of the IP address, IPv4 or IPv6 will be used.
When not specified the IP address, it will listen on all IPv4 network addresses.</p><p>Some example values for IP address:
</p><ul class="itemize"><li class="li-itemize">
<code>"0.0.0.0"</code> to listen in all IPv4 network interfaces. This is the default value when no IP is specified.
</li><li class="li-itemize"><code>"::"</code> to listen in all IPv6 network interfaces
</li><li class="li-itemize"><code>"10.11.12.13"</code> is the IPv4 address <code>10.11.12.13</code>
</li><li class="li-itemize"><code>"::FFFF:127.0.0.1"</code> is the IPv6 address <code>::FFFF:127.0.0.1/128</code>
</li></ul><p>The transport protocol can be <span style="font-family:monospace">tcp</span> or <span style="font-family:monospace">udp</span>.
Default is <span style="font-family:monospace">tcp</span>.</p><p> <a id="listened-module"></a> </p>
<!--TOC subsubsection id="sec29" Listening Module-->
<h4 id="sec29" class="subsubsection"><a href="#listened-module">Listening Module</a></h4><!--SEC END --><p> <a id="listened-module"></a> </p><p>
The available modules, their purpose and the options allowed by each one are:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">ejabberd_c2s</span></span></dt><dd class="dd-description">
Handles c2s connections.<br>
 Options: <span style="font-family:monospace">access</span>, <span style="font-family:monospace">certfile</span>, <span style="font-family:monospace">ciphers</span>, <span style="font-family:monospace">protocol_options</span>
<span style="font-family:monospace">max_ack_queue</span>, <span style="font-family:monospace">max_fsm_queue</span>,
<span style="font-family:monospace">max_stanza_size</span>, <span style="font-family:monospace">resend_on_timeout</span>,
<span style="font-family:monospace">resume_timeout</span>, <span style="font-family:monospace">shaper</span>,
<span style="font-family:monospace">starttls</span>, <span style="font-family:monospace">starttls_required</span>,
<span style="font-family:monospace">stream_management</span>, <span style="font-family:monospace">tls</span>,
<span style="font-family:monospace">zlib</span>, <span style="font-family:monospace">tls_compression</span>
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ejabberd_s2s_in</span></span></dt><dd class="dd-description">
Handles incoming s2s connections.<br>
 Options: <span style="font-family:monospace">max_stanza_size</span>, <span style="font-family:monospace">shaper</span>, <span style="font-family:monospace">tls_compression</span>
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ejabberd_service</span></span></dt><dd class="dd-description">
Interacts with an <a href="http://www.ejabberd.im/tutorials-transports">external component</a>
(as defined in the Jabber Component Protocol (<a href="http://xmpp.org/extensions/xep-0114.html">XEP-0114</a>).<br>
 Options: <span style="font-family:monospace">access</span>, <span style="font-family:monospace">hosts</span>, <span style="font-family:monospace">max_fsm_queue</span>,
<span style="font-family:monospace">service_check_from</span>, <span style="font-family:monospace">shaper_rule</span>
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ejabberd_sip</span></span></dt><dd class="dd-description">
Handles SIP requests as defined in
<a href="http://tools.ietf.org/html/rfc3261">RFC 3261</a>.<br>
 Options: <span style="font-family:monospace">certfile</span>, <span style="font-family:monospace">tls</span>
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ejabberd_stun</span></span></dt><dd class="dd-description">
Handles STUN/TURN requests as defined in
<a href="http://tools.ietf.org/html/rfc5389">RFC 5389</a> and
<a href="http://tools.ietf.org/html/rfc5766">RFC 5766</a>.<br>
 Options: <span style="font-family:monospace">certfile</span>, <span style="font-family:monospace">tls</span>, <span style="font-family:monospace">use_turn</span>, <span style="font-family:monospace">turn_ip</span>,
<span style="font-family:monospace">turn_port_range</span>, <span style="font-family:monospace">turn_max_allocations</span>,
<span style="font-family:monospace">turn_max_permissions</span>, <span style="font-family:monospace">shaper</span>, <span style="font-family:monospace">server_name</span>,
<span style="font-family:monospace">auth_realm</span>, <span style="font-family:monospace">auth_type</span>
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ejabberd_http</span></span></dt><dd class="dd-description">
Handles incoming HTTP connections.<br>
 Options: <span style="font-family:monospace">captcha</span>, <span style="font-family:monospace">certfile</span>, <span style="font-family:monospace">default_host</span>, <span style="font-family:monospace">http_bind</span>, <span style="font-family:monospace">http_poll</span>,
<span style="font-family:monospace">request_handlers</span>, <span style="font-family:monospace">tls</span>, <span style="font-family:monospace">tls_compression</span>, <span style="font-family:monospace">trusted_proxies</span>, <span style="font-family:monospace">web_admin</span><br>
 </dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ejabberd_xmlrpc</span></span></dt><dd class="dd-description">
Handles XML-RPC requests to execute ejabberd commands (<a href="#eja-commands">4.2</a>).<br>
 Options: <span style="font-family:monospace">access_commands</span>, <span style="font-family:monospace">maxsessions</span>, <span style="font-family:monospace">timeout</span>.<br>
 You can find option explanations, example configuration in old and new format,
and example calls in several languages in the old
<a href="https://raw.github.com/processone/ejabberd-contrib/master/ejabberd_xmlrpc/README.txt">ejabberd_xmlrpc README.txt</a>
</dd></dl><p> <a id="listened-options"></a> </p>
<!--TOC subsubsection id="sec30" Options-->
<h4 id="sec30" class="subsubsection"><a href="#listened-options">Options</a></h4><!--SEC END --><p> <a id="listened-options"></a> </p><p>This is a detailed description of each option allowed by the listening modules:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">access: AccessName</span></span></dt><dd class="dd-description"> This option defines
access to the port. The default value is <span style="font-family:monospace">all</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">backlog: Value</span></span></dt><dd class="dd-description"> The backlog value
defines the maximum length that the queue of pending connections may
grow to. This should be increased if the server is going to handle
lots of new incoming connections as they may be dropped if there is
no space in the queue (and ejabberd was not able to accept them
immediately). Default value is 5.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">captcha: true|false</span></span></dt><dd class="dd-description"> 
Simple web page that allows a user to fill a CAPTCHA challenge (see section <a href="#captcha">3.1.9</a>).
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">certfile: Path</span></span></dt><dd class="dd-description"> Full path to a file containing the default SSL certificate.
To define a certificate file specific for a given domain, use the global option <span style="font-family:monospace">domain_certfile</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ciphers: Ciphers</span></span></dt><dd class="dd-description"> OpenSSL ciphers list in the same format accepted by
&#X2018;<code>openssl ciphers</code>&#X2019; command.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">protocol_options: ProtocolOpts</span></span></dt><dd class="dd-description"> 
List of general options relating to SSL/TLS. These map to <code>&lt;a href="https://www.openssl.org/docs/ssl/SSL_CTX_set_options.html"&gt;OpenSSL's set_options()&lt;/a&gt;</code>.
For a full list of options available in ejabberd, <code>&lt;a href="https://github.com/processone/tls/blob/master/c_src/options.h"&gt;see the source&lt;/a&gt;</code>.
The default entry is: <code>"no_sslv2"</code>
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">default_host: undefined|HostName}</span></span></dt><dd class="dd-description">
If the HTTP request received by ejabberd contains the HTTP header <span style="font-family:monospace">Host</span>
with an ambiguous virtual host that doesn&#X2019;t match any one defined in ejabberd (see <a href="#hostnames">3.1.2</a>),
then this configured HostName is set as the request Host.
The default value of this option is: <span style="font-family:monospace">undefined</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">hosts: {Hostname: [HostOption, ...]}</span></span></dt><dd class="dd-description">
The external Jabber component that connects to this <span style="font-family:monospace">ejabberd_service</span>
can serve one or more hostnames.
As <span style="font-family:monospace">HostOption</span> you can define options for the component;
currently the only allowed option is the password required to the component
when attempt to connect to ejabberd: <span style="font-family:monospace">password: Secret</span>.
Note that you cannot define in a single <span style="font-family:monospace">ejabberd_service</span> components of
different services: add an <span style="font-family:monospace">ejabberd_service</span> for each service,
as seen in an example below.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">http_bind: true|false</span></span></dt><dd class="dd-description"> 
This option enables HTTP Binding (<a href="http://xmpp.org/extensions/xep-0124.html">XEP-0124</a> and <a href="http://xmpp.org/extensions/xep-0206.html">XEP-0206</a>) support. HTTP Bind
enables access via HTTP requests to <span style="font-family:monospace">ejabberd</span> from behind firewalls which
do not allow outgoing sockets on port 5222.<p>Remember that you must also install and enable the module mod_http_bind.</p><p>If HTTP Bind is enabled, it will be available at
<code>http://server:port/http-bind/</code>. Be aware that support for HTTP Bind
is also needed in the XMPP client. Remark also that HTTP Bind can be
interesting to host a web-based XMPP client such as
<a href="http://jwchat.sourceforge.net/">JWChat</a>
(check the tutorials to install JWChat with ejabberd and an
<a href="http://www.ejabberd.im/jwchat-localserver">embedded local web server</a>
or <a href="http://www.ejabberd.im/jwchat-apache">Apache</a>).
</p></dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">http_poll: true|false</span></span></dt><dd class="dd-description"> 
This option enables HTTP Polling (<a href="http://xmpp.org/extensions/xep-0025.html">XEP-0025</a>) support. HTTP Polling
enables access via HTTP requests to <span style="font-family:monospace">ejabberd</span> from behind firewalls which
do not allow outgoing sockets on port 5222.<p>If HTTP Polling is enabled, it will be available at
<code>http://server:port/http-poll/</code>. Be aware that support for HTTP Polling
is also needed in the XMPP client. Remark also that HTTP Polling can be
interesting to host a web-based XMPP client such as
<a href="http://jwchat.sourceforge.net/">JWChat</a>.</p><p>The maximum period of time to keep a client session active without
an incoming POST request can be configured with the global option
<span style="font-family:monospace">http_poll_timeout</span>. The default value is five minutes.
The option can be defined in <span style="font-family:monospace">ejabberd.yml</span>, expressing the time
in seconds: <code>{http_poll_timeout, 300}.</code>
</p></dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">max_ack_queue: Size</span></span></dt><dd class="dd-description">
This option specifies the maximum number of unacknowledged stanzas
queued for possible retransmission if <span style="font-family:monospace">stream_management</span> is
enabled. When the limit is reached, the first stanza is dropped from
the queue before adding the next one. This option can be specified
for <span style="font-family:monospace">ejabberd_c2s</span> listeners. The allowed values are positive
integers and <span style="font-family:monospace">infinity</span>. Default value: <span style="font-family:monospace">500</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">max_fsm_queue: Size</span></span></dt><dd class="dd-description">
This option specifies the maximum number of elements in the queue of the FSM
(Finite State Machine).
Roughly speaking, each message in such queues represents one XML
stanza queued to be sent into its relevant outgoing stream. If queue size
reaches the limit (because, for example, the receiver of stanzas is too slow),
the FSM and the corresponding connection (if any) will be terminated
and error message will be logged.
The reasonable value for this option depends on your hardware configuration.
However, there is no much sense to set the size above 1000 elements.
This option can be specified for <span style="font-family:monospace">ejabberd_service</span> and
<span style="font-family:monospace">ejabberd_c2s</span> listeners,
or also globally for <span style="font-family:monospace">ejabberd_s2s_out</span>.
If the option is not specified for <span style="font-family:monospace">ejabberd_service</span> or
<span style="font-family:monospace">ejabberd_c2s</span> listeners,
the globally configured value is used.
The allowed values are integers and &#X2019;undefined&#X2019;.
Default value: &#X2019;undefined&#X2019;.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">max_stanza_size: Size</span></span></dt><dd class="dd-description">
This option specifies an
approximate maximum size in bytes of XML stanzas. Approximate,
because it is calculated with the precision of one block of read
data. For example <code>{max_stanza_size, 65536}</code>. The default
value is <span style="font-family:monospace">infinity</span>. Recommended values are 65536 for c2s
connections and 131072 for s2s connections. s2s max stanza size
must always much higher than c2s limit. Change this value with
extreme care as it can cause unwanted disconnect if set too low.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">request_handlers: {Path: Module}</span></span></dt><dd class="dd-description"> To define one or several handlers that will serve HTTP requests.
The Path is a string; so the URIs that start with that Path will be served by Module.
For example, if you want <span style="font-family:monospace">mod_foo</span> to serve the URIs that start with <span style="font-family:monospace">/a/b/</span>,
and you also want <span style="font-family:monospace">mod_http_bind</span> to serve the URIs <span style="font-family:monospace">/http-bind/</span>,
use this option:
<pre class="verbatim">request_handlers:
  /"a"/"b": mod_foo
  /"http-bind": mod_http_bind
</pre></dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">resend_on_timeout: true|false</span></span></dt><dd class="dd-description">
If <span style="font-family:monospace">stream_management</span> is enabled and this option is set to
<span style="font-family:monospace">true</span>, any stanzas that weren&#X2019;t acknowledged by the client
will be resent on session timeout. This behavior might often be
desired, but could have unexpected results under certain
circumstances. For example, a message that was sent to two resources
might get resent to one of them if the other one timed out.
Therefore, the default value for this option is <span style="font-family:monospace">false</span>, which
tells ejabberd to generate an error message instead. The option can
be specified for <span style="font-family:monospace">ejabberd_c2s</span> listeners.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">resume_timeout: Seconds</span></span></dt><dd class="dd-description">
This option configures the number of seconds until a session times
out if the connection is lost. During this period of time, a client
may resume the session if <span style="font-family:monospace">stream_management</span> is enabled. This
option can be specified for <span style="font-family:monospace">ejabberd_c2s</span> listeners. Setting
it to <span style="font-family:monospace">0</span> effectively disables session resumption. The default
value is <span style="font-family:monospace">300</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">service_check_from: true|false</span></span></dt><dd class="dd-description">

This option can be used with <span style="font-family:monospace">ejabberd_service</span> only.
<a href="http://xmpp.org/extensions/xep-0114.html">XEP-0114</a> requires that the domain must match the hostname of the component.
If this option is set to <span style="font-family:monospace">false</span>, <span style="font-family:monospace">ejabberd</span> will allow the component
to send stanzas with any arbitrary domain in the &#X2019;from&#X2019; attribute.
Only use this option if you are completely sure about it.
The default value is <span style="font-family:monospace">true</span>, to be compliant with <a href="http://xmpp.org/extensions/xep-0114.html">XEP-0114</a>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">shaper: none|ShaperName</span></span></dt><dd class="dd-description"> This option defines a
shaper for the port (see section&#XA0;<a href="#shapers">3.1.7</a>). The default value
is <span style="font-family:monospace">none</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">shaper_rule: none|ShaperRule</span></span></dt><dd class="dd-description"> This option defines a
shaper rule for the <span style="font-family:monospace">ejabberd_service</span> (see section&#XA0;<a href="#shapers">3.1.7</a>). The recommended value
is <span style="font-family:monospace">fast</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">starttls: true|false</span></span></dt><dd class="dd-description"> This option
specifies that STARTTLS encryption is available on connections to the port.
You should also set the <span style="font-family:monospace">certfile</span> option.
You can define a certificate file for a specific domain using the global option <span style="font-family:monospace">domain_certfile</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">starttls_required: true|false</span></span></dt><dd class="dd-description"> This option
specifies that STARTTLS encryption is required on connections to the port.
No unencrypted connections will be allowed.
You should also set the <span style="font-family:monospace">certfile</span> option.
You can define a certificate file for a specific domain using the global option <span style="font-family:monospace">domain_certfile</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">stream_management: true|false</span></span></dt><dd class="dd-description">
Setting this option to <span style="font-family:monospace">false</span> disables ejabberd&#X2019;s support for
. It can be specified for
<span style="font-family:monospace">ejabberd_c2s</span> listeners. The default value is <span style="font-family:monospace">true</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">timeout: Integer</span></span></dt><dd class="dd-description"> 
Timeout of the connections, expressed in milliseconds.
Default: 5000
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">tls: true|false</span></span></dt><dd class="dd-description"> This option specifies that traffic on
the port will be encrypted using SSL immediately after connecting.
This was the traditional encryption method in the early Jabber software,
commonly on port 5223 for client-to-server communications.
But this method is nowadays deprecated and not recommended.
The preferable encryption method is STARTTLS on port 5222, as defined 
<a href="http://xmpp.org/rfcs/rfc3920.html#tls">RFC 3920: XMPP Core</a>,
which can be enabled in <span style="font-family:monospace">ejabberd</span> with the option <span style="font-family:monospace">starttls</span>.
If this option is set, you should also set the <span style="font-family:monospace">certfile</span> option.
The option <span style="font-family:monospace">tls</span> can also be used in <span style="font-family:monospace">ejabberd_http</span> to support HTTPS.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">tls_compression: true|false</span></span></dt><dd class="dd-description">
Whether to enable or disable TLS compression. The default value is <span style="font-family:monospace">true</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">trusted_proxies: all | [IpString]</span></span></dt><dd class="dd-description"> 
Specify what proxies are trusted when an HTTP request contains the header <span style="font-family:monospace">X-Forwarded-For</span>
You can specify <span style="font-family:monospace">all</span> to allow all proxies, or specify a list of IPs in string format.
The default value is: <span style="font-family:monospace">["127.0.0.1"]</span>
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">web_admin: true|false</span></span></dt><dd class="dd-description"> This option
enables the Web Admin for <span style="font-family:monospace">ejabberd</span> administration which is available
at <code>http://server:port/admin/</code>. Login and password are the username and
password of one of the registered users who are granted access by the
&#X2018;configure&#X2019; access rule.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">zlib: true|false</span></span></dt><dd class="dd-description"> This
option specifies that Zlib stream compression (as defined in <a href="http://xmpp.org/extensions/xep-0138.html">XEP-0138</a>)
is available on connections to the port.
</dd></dl><p>There are some additional global options that can be specified in the ejabberd configuration file (outside <span style="font-family:monospace">listen</span>):
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">s2s_use_starttls: false|optional|required|required_trusted</span></span></dt><dd class="dd-description">
This option defines if 
s2s connections don&#X2019;t use STARTTLS encryption; if STARTTLS can be used optionally;
if STARTTLS is required to establish the connection;
or if STARTTLS is required and the remote certificate must be valid and trusted.
The default value is to not use STARTTLS: <span style="font-family:monospace">false</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">s2s_certfile: Path</span></span></dt><dd class="dd-description"> Full path to a
file containing a SSL certificate.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">domain_certfile: Path</span></span></dt><dd class="dd-description"> 
Full path to the file containing the SSL certificate for a specific domain.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">s2s_ciphers: Ciphers</span></span></dt><dd class="dd-description">  OpenSSL ciphers list
in the same format accepted by &#X2018;<code>openssl ciphers</code>&#X2019; command.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">s2s_protocol_options: ProtocolOpts</span></span></dt><dd class="dd-description"> 
List of general options relating to SSL/TLS. These map to <code>&lt;a href="https://www.openssl.org/docs/ssl/SSL_CTX_set_options.html"&gt;OpenSSL's set_options()&lt;/a&gt;</code>.
For a full list of options available in ejabberd, <code>&lt;a href="https://github.com/processone/tls/blob/protocol_options/c_src/options.h"&gt;see the source&lt;/a&gt;</code>.
The default entry is: <code>"no_sslv2"</code>
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">outgoing_s2s_families: [Family, ...]</span></span></dt><dd class="dd-description"> 
Specify which address families to try, in what order.
By default it first tries connecting with IPv4, if that fails it tries using IPv6.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">outgoing_s2s_timeout: Timeout</span></span></dt><dd class="dd-description"> 
The timeout in milliseconds for outgoing S2S connection attempts.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">s2s_dns_timeout: Timeout</span></span></dt><dd class="dd-description"> 
The timeout in seconds for DNS resolving. The default value is <span style="font-family:monospace">10</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">s2s_dns_retries: Number</span></span></dt><dd class="dd-description"> 
DNS resolving retries in seconds. The default value is <span style="font-family:monospace">2</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">s2s_policy: Access</span></span></dt><dd class="dd-description"> 
The policy for incoming and outgoing s2s connections to other XMPP servers.
The default value is <span style="font-family:monospace">all</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">s2s_max_retry_delay: Seconds</span></span></dt><dd class="dd-description"> 
The maximum allowed delay for retry to connect after a failed connection attempt.
Specified in seconds. The default value is 300 seconds (5 minutes).
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">s2s_tls_compression: true|false</span></span></dt><dd class="dd-description">
Whether to enable or disable TLS compression for s2s connections.
The default value is <span style="font-family:monospace">true</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">max_fsm_queue: Size</span></span></dt><dd class="dd-description">
This option specifies the maximum number of elements in the queue of the FSM
(Finite State Machine).
Roughly speaking, each message in such queues represents one XML
stanza queued to be sent into its relevant outgoing stream. If queue size
reaches the limit (because, for example, the receiver of stanzas is too slow),
the FSM and the corresponding connection (if any) will be terminated
and error message will be logged.
The reasonable value for this option depends on your hardware configuration.
However, there is no much sense to set the size above 1000 elements.
This option can be specified for <span style="font-family:monospace">ejabberd_service</span> and
<span style="font-family:monospace">ejabberd_c2s</span> listeners,
or also globally for <span style="font-family:monospace">ejabberd_s2s_out</span>.
If the option is not specified for <span style="font-family:monospace">ejabberd_service</span> or
<span style="font-family:monospace">ejabberd_c2s</span> listeners,
the globally configured value is used.
The allowed values are integers and &#X2019;undefined&#X2019;.
Default value: &#X2019;undefined&#X2019;.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">route_subdomains: local|s2s</span></span></dt><dd class="dd-description">
Defines if ejabberd must route stanzas directed to subdomains locally (compliant with 
<a href="http://xmpp.org/rfcs/rfc3920.html#rules.subdomain">RFC 3920: XMPP Core</a>),
or to foreign server using S2S (compliant with
<a href="http://tools.ietf.org/html/draft-saintandre-rfc3920bis-09#section-11.3">RFC 3920 bis</a>).
</dd></dl><p> <a id="listened-examples"></a> </p>
<!--TOC subsubsection id="sec31" Examples-->
<h4 id="sec31" class="subsubsection"><a href="#listened-examples">Examples</a></h4><!--SEC END --><p> <a id="listened-examples"></a> </p><p>For example, the following simple configuration defines:
</p><ul class="itemize"><li class="li-itemize">
There are three domains. The default certificate file is <span style="font-family:monospace">server.pem</span>.
However, the c2s and s2s connections to the domain <span style="font-family:monospace">example.com</span> use the file <span style="font-family:monospace">example_com.pem</span>.
</li><li class="li-itemize">Port 5222 listens for c2s connections with STARTTLS,
and also allows plain connections for old clients.
</li><li class="li-itemize">Port 5223 listens for c2s connections with the old SSL.
</li><li class="li-itemize">Port 5269 listens for s2s connections with STARTTLS. The socket is set for IPv6 instead of IPv4.
</li><li class="li-itemize">Port 3478 listens for STUN requests over UDP.
</li><li class="li-itemize">Port 5280 listens for HTTP requests, and serves the HTTP Poll service.
</li><li class="li-itemize">Port 5281 listens for HTTP requests, using HTTPS to serve HTTP-Bind (BOSH) and the Web Admin as explained in
section&#XA0;<a href="#webadmin">4.3</a>. The socket only listens connections to the IP address 127.0.0.1.
</li></ul><pre class="verbatim">hosts:
  - "example.com"
  - "example.org"
  - "example.net"

listen:
  - 
    port: 5222
    module: ejabberd_c2s
    access: c2s
    shaper: c2s_shaper
    starttls: true
    certfile: "/etc/ejabberd/server.pem"
    max_stanza_size: 65536
  - 
    port: 5223
    module: ejabberd_c2s
    access: c2s
    shaper: c2s_shaper
    tls: true
    certfile: "/etc/ejabberd/server.pem"
    max_stanza_size: 65536
  - 
    port: 5269
    ip: "::"
    module: ejabberd_s2s_in
    shaper: s2s_shaper
    max_stanza_size: 131072
  - 
    port: 3478
    transport: udp
    module: ejabberd_stun
  - 
    port: 5280
    module: ejabberd_http
    http_poll: true
  - 
    port: 5281
    ip: "127.0.0.1"
    module: ejabberd_http
    web_admin: true
    http_bind: true
    tls: true
    certfile: "/etc/ejabberd/server.pem"

s2s_use_starttls: optional
s2s_certfile: "/etc/ejabberd/server.pem"
host_config:
  "example.com":
    domain_certfile: "/etc/ejabberd/example_com.pem"
outgoing_s2s_families:
  - ipv4
  - ipv6
outgoing_s2s_timeout: 10000
</pre><p>In this example, the following configuration defines that:
</p><ul class="itemize"><li class="li-itemize">
c2s connections are listened for on port 5222 (all IPv4 addresses) and
on port 5223 (SSL, IP 192.168.0.1 and fdca:8ab6:a243:75ef::1) and denied
for the user called &#X2018;<span style="font-family:monospace">bad</span>&#X2019;.
</li><li class="li-itemize">s2s connections are listened for on port 5269 (all IPv4 addresses) 
with STARTTLS for secured traffic strictly required, and the certificates are verified. 
Incoming and outgoing connections of remote XMPP servers are denied,
only two servers can connect: "jabber.example.org" and "example.com".
</li><li class="li-itemize">Port 5280 is serving the Web Admin and the HTTP Polling service
in all the IPv4 addresses. Note
that it is also possible to serve them on different ports. The second
example in section&#XA0;<a href="#webadmin">4.3</a> shows how exactly this can be done.
</li><li class="li-itemize">All users except for the administrators have a traffic of limit 
1,000&#XA0;Bytes/second
</li><li class="li-itemize">The
<a href="http://www.ejabberd.im/pyaimt">AIM transport</a>
<span style="font-family:monospace">aim.example.org</span> is connected to port 5233 on localhost IP addresses
(127.0.0.1 and ::1) with password &#X2018;<span style="font-family:monospace">aimsecret</span>&#X2019;.
</li><li class="li-itemize">The ICQ transport JIT (<span style="font-family:monospace">icq.example.org</span> and
<span style="font-family:monospace">sms.example.org</span>) is connected to port 5234 with password
&#X2018;<span style="font-family:monospace">jitsecret</span>&#X2019;.
</li><li class="li-itemize">The
<a href="http://www.ejabberd.im/pymsnt">MSN transport</a>
<span style="font-family:monospace">msn.example.org</span> is connected to port 5235 with password
&#X2018;<span style="font-family:monospace">msnsecret</span>&#X2019;.
</li><li class="li-itemize">The
<a href="http://www.ejabberd.im/yahoo-transport-2">Yahoo! transport</a>
<span style="font-family:monospace">yahoo.example.org</span> is connected to port 5236 with password
&#X2018;<span style="font-family:monospace">yahoosecret</span>&#X2019;.
</li><li class="li-itemize">The <a href="http://www.ejabberd.im/jabber-gg-transport">Gadu-Gadu transport</a> <span style="font-family:monospace">gg.example.org</span> is
connected to port 5237 with password &#X2018;<span style="font-family:monospace">ggsecret</span>&#X2019;.
</li><li class="li-itemize">The
<a href="http://www.ejabberd.im/jmc">Jabber Mail Component</a>
<span style="font-family:monospace">jmc.example.org</span> is connected to port 5238 with password
&#X2018;<span style="font-family:monospace">jmcsecret</span>&#X2019;.
</li><li class="li-itemize">The service custom has enabled the special option to avoiding checking the <span style="font-family:monospace">from</span> attribute in the packets send by this component. The component can send packets in behalf of any users from the server, or even on behalf of any server.
</li></ul><pre class="verbatim">acl: 
  blocked: 
    user: "bad"
  trusted_servers: 
    server:
      - "example.com"
      - "jabber.example.org"
  xmlrpc_bot: 
    user: 
      - "xmlrpc-robot": "example.org"
shaper: 
  normal: 1000
access: 
  c2s: 
    blocked: deny
    all: allow
  c2s_shaper: 
    admin: none
    all: normal
  xmlrpc_access: 
    xmlrpc_bot: allow
  s2s_access:
    trusted_servers: allow
    all: deny
s2s_certfile: "/path/to/ssl.pem"
s2s_policy: s2s_access
s2s_use_starttls: required_trusted
listen: 
  - 
    port: 5222
    module: ejabberd_c2s
    shaper: c2s_shaper
    access: c2s
  - 
    ip: "192.168.0.1"
    port: 5223
    module: ejabberd_c2s
    certfile: "/path/to/ssl.pem"
    tls: true
    access: c2s
  - 
    ip: "FDCA:8AB6:A243:75EF::1"
    port: 5223
    module: ejabberd_c2s
    certfile: "/path/to/ssl.pem"
    tls: true
    access: c2s
  - 
    port: 5269
    module: ejabberd_s2s_in
  - 
    port: 5280
    module: ejabberd_http
    web_admin: true
    http_poll: true
  - 
    port: 4560
    module: ejabberd_xmlrpc
  - 
    ip: "127.0.0.1"
    port: 5233
    module: ejabberd_service
    hosts: 
      "aim.example.org": 
        password: "aimsecret"
  - 
    ip: "::1"
    port: 5233
    module: ejabberd_service
    hosts: 
      "aim.example.org": 
        password: "aimsecret"
  - 
    port: 5234
    module: ejabberd_service
    hosts: 
      "icq.example.org": 
        password: "jitsecret"
      "sms.example.org": 
        password: "jitsecret"
  - 
    port: 5235
    module: ejabberd_service
    hosts: 
      "msn.example.org": 
        password: "msnsecret"
  - 
    port: 5236
    module: ejabberd_service
    hosts: 
      "yahoo.example.org": 
        password: "yahoosecret"
  - 
    port: 5237
    module: ejabberd_service
    hosts: 
      "gg.example.org": 
        password: "ggsecret"
  - 
    port: 5238
    module: ejabberd_service
    hosts: 
      "jmc.example.org": 
        password: "jmcsecret"
  - 
    port: 5239
    module: ejabberd_service
    service_check_from: false
    hosts: 
      "custom.example.org": 
        password: "customsecret"
</pre><p>Note, that for services based in jabberd14 or WPJabber
you have to make the transports log and do XDB by themselves:
</p><pre class="verbatim">  &lt;!--
     You have to add elogger and rlogger entries here when using ejabberd.
     In this case the transport will do the logging.
  --&gt;

  &lt;log id='logger'&gt;
    &lt;host/&gt;
    &lt;logtype/&gt;
    &lt;format&gt;%d: [%t] (%h): %s&lt;/format&gt;
    &lt;file&gt;/var/log/jabber/service.log&lt;/file&gt;
  &lt;/log&gt;

  &lt;!--
     Some XMPP server implementations do not provide
     XDB services (for example, jabberd2 and ejabberd).
     xdb_file.so is loaded in to handle all XDB requests.
  --&gt;

  &lt;xdb id="xdb"&gt;
    &lt;host/&gt;
    &lt;load&gt;
      &lt;!-- this is a lib of wpjabber or jabberd14 --&gt;
      &lt;xdb_file&gt;/usr/lib/jabber/xdb_file.so&lt;/xdb_file&gt;
      &lt;/load&gt;
    &lt;xdb_file xmlns="jabber:config:xdb_file"&gt;
      &lt;spool&gt;&lt;jabberd:cmdline flag='s'&gt;/var/spool/jabber&lt;/jabberd:cmdline&gt;&lt;/spool&gt;
    &lt;/xdb_file&gt;
  &lt;/xdb&gt;
</pre><p> <a id="auth"></a> </p>
<!--TOC subsection id="sec32" Authentication-->
<h3 id="sec32" class="subsection">3.1.5&#XA0;&#XA0;<a href="#auth">Authentication</a></h3><!--SEC END --><p> <a id="auth"></a> 
</p><p>The option <span style="font-family:monospace">auth_method</span> defines the authentication methods that are used
for user authentication. The syntax is:
</p><dl class="description"><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">[Method, ...]</span></span></dt></dl><p>The following authentication methods are supported by <span style="font-family:monospace">ejabberd</span>:
</p><ul class="itemize"><li class="li-itemize">
internal (default) &#X2014; See section&#XA0;<a href="#internalauth">3.1.5</a>.
</li><li class="li-itemize">external &#X2014; See section&#XA0;<a href="#extauth">3.1.5</a>.
</li><li class="li-itemize">ldap &#X2014; See section&#XA0;<a href="#ldap">3.2.2</a>.
</li><li class="li-itemize">odbc &#X2014; See section&#XA0;<a href="#odbc">3.2.1</a>.
</li><li class="li-itemize">anonymous &#X2014; See section&#XA0;<a href="#saslanonymous">3.1.5</a>.
</li><li class="li-itemize">pam &#X2014; See section&#XA0;<a href="#pam">3.1.5</a>.
</li></ul><p>Account creation is only supported by internal, external and odbc methods.</p><p>The option <span style="font-family:monospace">resource_conflict</span> defines the action when a client attempts to
login to an account with a resource that is already connected.
The option syntax is:
</p><dl class="description"><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">resource_conflict: setresource|closenew|closeold</span></span></dt></dl><p>
The possible values match exactly the three possibilities described in
<a href="http://tools.ietf.org/html/rfc6120#section-7.7.2.2">XMPP Core: section 7.7.2.2</a>.
The default value is <span style="font-family:monospace">closeold</span>.
If the client uses old Jabber Non-SASL authentication (<a href="http://xmpp.org/extensions/xep-0078.html">XEP-0078</a>),
then this option is not respected, and the action performed is <span style="font-family:monospace">closeold</span>.</p><p>The option <span style="font-family:monospace">fqdn</span> allows you to define the Fully Qualified Domain Name
of the machine, in case it isn&#X2019;t detected automatically.
The FQDN is used to authenticate some clients that use the DIGEST-MD5 SASL mechanism.
The option syntax is:
</p><dl class="description"><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">fqdn: undefined|FqdnString|[FqdnString]</span></span></dt></dl><p> <a id="internalauth"></a> </p>
<!--TOC subsubsection id="sec33" Internal-->
<h4 id="sec33" class="subsubsection"><a href="#internalauth">Internal</a></h4><!--SEC END --><p> <a id="internalauth"></a> 
</p><p><span style="font-family:monospace">ejabberd</span> uses its internal Mnesia database as the default authentication method.
The value <span style="font-family:monospace">internal</span> will enable the internal authentication method.</p><p>The option <span style="font-family:monospace">auth_password_format: plain|scram</span>
defines in what format the users passwords are stored:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">plain</span></span></dt><dd class="dd-description">
The password is stored as plain text in the database.
This is risky because the passwords can be read if your database gets compromised.
This is the default value.
This format allows clients to authenticate using:
the old Jabber Non-SASL (<a href="http://xmpp.org/extensions/xep-0078.html">XEP-0078</a>), <span style="font-family:monospace">SASL PLAIN</span>,
<span style="font-family:monospace">SASL DIGEST-MD5</span>, and <span style="font-family:monospace">SASL SCRAM-SHA-1</span>.</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">scram</span></span></dt><dd class="dd-description">
The password is not stored, only some information that allows to verify the hash provided by the client.
It is impossible to obtain the original plain password from the stored information;
for this reason, when this value is configured it cannot be changed to <span style="font-family:monospace">plain</span> anymore.
This format allows clients to authenticate using: <span style="font-family:monospace">SASL PLAIN</span> and <span style="font-family:monospace">SASL SCRAM-SHA-1</span>.
</dd></dl><p>Examples:
</p><ul class="itemize"><li class="li-itemize">
To use internal authentication on <span style="font-family:monospace">example.org</span> and LDAP
authentication on <span style="font-family:monospace">example.net</span>:
<pre class="verbatim">host_config:
  "example.org":
    auth_method: [internal]
  "example.net":
    auth_method: [ldap]
</pre></li><li class="li-itemize">To use internal authentication with hashed passwords on all virtual hosts:
<pre class="verbatim">auth_method: internal
auth_password_format: scram
</pre></li></ul><p> <a id="extauth"></a> </p>
<!--TOC subsubsection id="sec34" External Script-->
<h4 id="sec34" class="subsubsection"><a href="#extauth">External Script</a></h4><!--SEC END --><p> <a id="extauth"></a> 
</p><p>In this authentication method, when <span style="font-family:monospace">ejabberd</span> starts,
it start a script, and calls it to perform authentication tasks.</p><p>The server administrator can write the external authentication script
in any language.
The details on the interface between ejabberd and the script are described
in the <span style="font-family:monospace">ejabberd Developers Guide</span>.
There are also <a href="http://www.ejabberd.im/extauth">several example authentication scripts</a>.</p><p>These are the specific options:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">extauth_program: PathToScript</span></span></dt><dd class="dd-description"> 
Indicate in this option the full path to the external authentication script.
The script must be executable by ejabberd.</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">extauth_instances: Integer</span></span></dt><dd class="dd-description"> 
Indicate how many instances of the script to run simultaneously to serve authentication in the virtual host.
The default value is the minimum number: 1.</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">extauth_cache: false|CacheTimeInteger</span></span></dt><dd class="dd-description"> 
The value <span style="font-family:monospace">false</span> disables the caching feature, this is the default.
The integer <span style="font-family:monospace">0</span> (zero) enables caching for statistics, but doesn&#X2019;t use that cached information to authenticate users.
If another integer value is set, caching is enabled both for statistics and for authentication:
the CacheTimeInteger indicates the number of seconds that ejabberd can reuse
the authentication information since the user last disconnected,
to verify again the user authentication without querying again the extauth script.
Note: caching should not be enabled in a host if internal auth is also enabled.
If caching is enabled, <span style="font-family:monospace">mod_last</span> must be enabled also in that vhost.
</dd></dl><p>This example sets external authentication, the extauth script, enables caching for 10 minutes,
and starts three instances of the script for each virtual host defined in ejabberd:
</p><pre class="verbatim">auth_method: [external]
extauth_program: "/etc/ejabberd/JabberAuth.class.php"
extauth_cache: 600
extauth_instances: 3
</pre><p> <a id="saslanonymous"></a> </p>
<!--TOC subsubsection id="sec35" Anonymous Login and SASL Anonymous-->
<h4 id="sec35" class="subsubsection"><a href="#saslanonymous">Anonymous Login and SASL Anonymous</a></h4><!--SEC END --><p> <a id="saslanonymous"></a> 
</p><p>The <span style="font-family:monospace">anonymous</span> authentication method enables two modes for anonymous authentication:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">Anonymous login:</span></span></dt><dd class="dd-description"> This is a standard login, that use the
classical login and password mechanisms, but where password is
accepted or preconfigured for all anonymous users. This login is
compliant with SASL authentication, password and digest non-SASL
authentication, so this option will work with almost all XMPP
clients</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">SASL Anonymous:</span></span></dt><dd class="dd-description"> This is a special SASL authentication
mechanism that allows to login without providing username or
password (see <a href="http://xmpp.org/extensions/xep-0175.html">XEP-0175</a>). The main advantage of SASL Anonymous
is that the protocol was designed to give the user a login. This is
useful to avoid in some case, where the server has many users
already logged or registered and when it is hard to find a free
username. The main disavantage is that you need a client that
specifically supports the SASL Anonymous protocol.
</dd></dl><p>The anonymous authentication method can be configured with the following
options. Remember that you can use the <span style="font-family:monospace">host_config</span> option to set virtual
host specific options (see section&#XA0;<a href="#virtualhost">3.1.3</a>).</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">allow_multiple_connections: false|true</span></span></dt><dd class="dd-description"> This option is only used
when the anonymous mode is
enabled. Setting it to <span style="font-family:monospace">true</span> means that the same username can be taken
multiple times in anonymous login mode if different resource are used to
connect. This option is only useful in very special occasions. The default
value is <span style="font-family:monospace">false</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">anonymous_protocol: login_anon | sasl_anon | both</span></span></dt><dd class="dd-description">
<span style="font-family:monospace">login_anon</span> means that the anonymous login method will be used.
<span style="font-family:monospace">sasl_anon</span> means that the SASL Anonymous method will be used.
<span style="font-family:monospace">both</span> means that SASL Anonymous and login anonymous are both enabled.
</dd></dl><p>Those options are defined for each virtual host with the <span style="font-family:monospace">host_config</span>
parameter (see section&#XA0;<a href="#virtualhost">3.1.3</a>).</p><p>Examples:
</p><ul class="itemize"><li class="li-itemize">
To enable anonymous login on all virtual hosts:
<pre class="verbatim">auth_method: [anonymous]
anonymous_protocol: login_anon
</pre></li><li class="li-itemize">Similar as previous example, but limited to <span style="font-family:monospace">public.example.org</span>:
<pre class="verbatim">host_config:
  "public.example.org":
    auth_method: [anonymous]
    anonymous_protoco: login_anon
</pre></li><li class="li-itemize">To enable anonymous login and internal authentication on a virtual host:
<pre class="verbatim">host_config:
  "public.example.org":
    auth_method:
      - internal
      - anonymous
    anonymous_protocol: login_anon
</pre></li><li class="li-itemize">To enable SASL Anonymous on a virtual host:
<pre class="verbatim">host_config:
  "public.example.org":
    auth_method: [anonymous]
    anonymous_protocol: sasl_anon
</pre></li><li class="li-itemize">To enable SASL Anonymous and anonymous login on a virtual host:
<pre class="verbatim">host_config:
  "public.example.org":
    auth_method: [anonymous]
    anonymous_protocol: both
</pre></li><li class="li-itemize">To enable SASL Anonymous, anonymous login, and internal authentication on
a virtual host:
<pre class="verbatim">host_config:
  "public.example.org":
    auth_method:
      - internal
      - anonymous
    anonymous_protocol: both
</pre></li></ul><p>There are more configuration examples and XMPP client example stanzas in
<a href="http://www.ejabberd.im/Anonymous-users-support">Anonymous users support</a>.</p><p> <a id="pam"></a> </p>
<!--TOC subsubsection id="sec36" PAM Authentication-->
<h4 id="sec36" class="subsubsection"><a href="#pam">PAM Authentication</a></h4><!--SEC END --><p> <a id="pam"></a> 
</p><p><span style="font-family:monospace">ejabberd</span> supports authentication via Pluggable Authentication Modules (PAM).
PAM is currently supported in AIX, FreeBSD, HP-UX, Linux, Mac OS X, NetBSD and Solaris.
PAM authentication is disabled by default, so you have to configure and compile
<span style="font-family:monospace">ejabberd</span> with PAM support enabled:
</p><pre class="verbatim">./configure --enable-pam &amp;&amp; make install
</pre><p>Options:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">pam_service: Name</span></span></dt><dd class="dd-description">This option defines the PAM service name.
Default is <span style="font-family:monospace">"ejabberd"</span>. Refer to the PAM documentation of your operation system
for more information.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">pam_userinfotype: username|jid</span></span></dt><dd class="dd-description">
This option defines what type of information about the user ejabberd
provides to the PAM service: only the username, or the user JID.
Default is <span style="font-family:monospace">username</span>.
</dd></dl><p>Example:
</p><pre class="verbatim">auth_method: [pam]
pam_service: "ejabberd"
</pre><p>Though it is quite easy to set up PAM support in <span style="font-family:monospace">ejabberd</span>, PAM itself introduces some
security issues:</p><ul class="itemize"><li class="li-itemize">
To perform PAM authentication <span style="font-family:monospace">ejabberd</span> uses external C-program called
<span style="font-family:monospace">epam</span>. By default, it is located in <code>/var/lib/ejabberd/priv/bin/</code>
directory. You have to set it root on execution in the case when your PAM module
requires root privileges (<span style="font-family:monospace">pam_unix.so</span> for example). Also you have to grant access
for <span style="font-family:monospace">ejabberd</span> to this file and remove all other permissions from it.
Execute with root privileges:
<pre class="verbatim">chown root:ejabberd /var/lib/ejabberd/priv/bin/epam
chmod 4750 /var/lib/ejabberd/priv/bin/epam
</pre></li><li class="li-itemize">Make sure you have the latest version of PAM installed on your system.
Some old versions of PAM modules cause memory leaks. If you are not able to use the latest
version, you can <span style="font-family:monospace">kill(1)</span> <span style="font-family:monospace">epam</span> process periodically to reduce its memory
consumption: <span style="font-family:monospace">ejabberd</span> will restart this process immediately.
</li><li class="li-itemize"><span style="font-family:monospace">epam</span> program tries to turn off delays on authentication failures.
However, some PAM modules ignore this behavior and rely on their own configuration options.
You can create a configuration file <span style="font-family:monospace">ejabberd.pam</span>.
This example shows how to turn off delays in <span style="font-family:monospace">pam_unix.so</span> module:
<pre class="verbatim">#%PAM-1.0
auth        sufficient  pam_unix.so likeauth nullok nodelay
account     sufficient  pam_unix.so
</pre>That is not a ready to use configuration file: you must use it
as a hint when building your own PAM configuration instead. Note that if you want to disable
delays on authentication failures in the PAM configuration file, you have to restrict access
to this file, so a malicious user can&#X2019;t use your configuration to perform brute-force
attacks.
</li><li class="li-itemize">You may want to allow login access only for certain users. <span style="font-family:monospace">pam_listfile.so</span>
module provides such functionality.
</li><li class="li-itemize">If you use <span style="font-family:monospace">pam_winbind</span> to authorise against a Windows Active Directory,
then <span style="font-family:monospace">/etc/nsswitch.conf</span> must be configured to use <span style="font-family:monospace">winbind</span> as well.
</li></ul><p> <a id="accessrules"></a> </p>
<!--TOC subsection id="sec37" Access Rules-->
<h3 id="sec37" class="subsection">3.1.6&#XA0;&#XA0;<a href="#accessrules">Access Rules</a></h3><!--SEC END --><p> <a id="accessrules"></a> 
</p><p> <a id="ACLDefinition"></a> </p>
<!--TOC subsubsection id="sec38" ACL Definition-->
<h4 id="sec38" class="subsubsection"><a href="#ACLDefinition">ACL Definition</a></h4><!--SEC END --><p> <a id="ACLDefinition"></a> 
</p><p>Access control in <span style="font-family:monospace">ejabberd</span> is performed via Access Control Lists (ACLs). The
declarations of ACLs in the configuration file have the following syntax:
</p><dl class="description"><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">acl: { ACLName: { ACLType: ACLValue } }</span></span></dt></dl><p><span style="font-family:monospace">ACLType: ACLValue</span> can be one of the following:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">all</span></span></dt><dd class="dd-description"> Matches all JIDs. Example:
<pre class="verbatim">acl:
  world: all
</pre></dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">user: Username</span></span></dt><dd class="dd-description"> Matches the user with the name
<span style="font-family:monospace">Username</span> at the first virtual host. Example:
<pre class="verbatim">acl:
  admin:
    user: "yozhik"
</pre></dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">user: {Username: Server}</span></span></dt><dd class="dd-description"> Matches the user with the JID
<span style="font-family:monospace">Username@Server</span> and any resource. Example:
<pre class="verbatim">acl:
  admin:
    user:
      "yozhik": "example.org"
</pre></dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">server: Server</span></span></dt><dd class="dd-description"> Matches any JID from server
<span style="font-family:monospace">Server</span>. Example:
<pre class="verbatim">acl:
  exampleorg:
    server: "example.org"
</pre></dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">resource: Resource</span></span></dt><dd class="dd-description"> Matches any JID with a resource
<span style="font-family:monospace">Resource</span>. Example:
<pre class="verbatim">acl:
  mucklres:
   resource: "muckl"
</pre></dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">shared_group: Groupname</span></span></dt><dd class="dd-description"> Matches any member of a Shared Roster Group with name <span style="font-family:monospace">Groupname</span> in the virtual host. Example:
<pre class="verbatim">acl:
  techgroupmembers:
    shared_group: "techteam"
</pre></dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">shared_group: {Groupname: Server}</span></span></dt><dd class="dd-description"> Matches any member of a Shared Roster Group with name <span style="font-family:monospace">Groupname</span> in the virtual host <span style="font-family:monospace">Server</span>. Example:
<pre class="verbatim">acl:
  techgroupmembers:
    shared_group:
      "techteam": "example.org"
</pre></dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ip: Network</span></span></dt><dd class="dd-description"> Matches any IP address from the <span style="font-family:monospace">Network</span>. Example:
<pre class="verbatim">acl:
  loopback:
    ip:
      - "127.0.0.0/8"
      - "::"
</pre></dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">user_regexp: Regexp</span></span></dt><dd class="dd-description"> Matches any local user with a name that
matches <span style="font-family:monospace">Regexp</span> on local virtual hosts. Example:
<pre class="verbatim">acl:
  tests:
    user_regexp: "^test[0-9]*$"
</pre></dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">user_regexp: {Regexp: Server}</span></span></dt><dd class="dd-description"> Matches any user with a name
that matches <span style="font-family:monospace">Regexp</span> at server <span style="font-family:monospace">Server</span>. Example:
<pre class="verbatim">acl:
  tests:
    user_regexp:
      "^test": "example.org"
</pre></dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">server_regexp: Regexp</span></span></dt><dd class="dd-description"> Matches any JID from the server that
matches <span style="font-family:monospace">Regexp</span>. Example:
<pre class="verbatim">acl:
  icq:
    server_regexp: "^icq\\."
</pre></dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">resource_regexp: Regexp</span></span></dt><dd class="dd-description"> Matches any JID with a resource that
matches <span style="font-family:monospace">Regexp</span>. Example:
<pre class="verbatim">acl:
  icq:
    resource_regexp: "^laptop\\."
</pre></dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">node_regexp: {UserRegexp: ServerRegexp}</span></span></dt><dd class="dd-description"> Matches any user
with a name that matches <span style="font-family:monospace">UserRegexp</span> at any server that matches
<span style="font-family:monospace">ServerRegexp</span>. Example:
<pre class="verbatim">acl:
  yozhik:
    node_regexp:
      "^yozhik$": "^example.(com|org)$"
</pre></dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">user_glob: Glob}</span></span></dt><dd class="dd-description">
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">user_glob: {Glob: Server}</span></span></dt><dd class="dd-description">
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">server_glob: Glob</span></span></dt><dd class="dd-description">
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">resource_glob: Glob</span></span></dt><dd class="dd-description">
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">node_glob: {UserGlob: ServerGlob}</span></span></dt><dd class="dd-description"> This is the same as
above. However, it uses shell glob patterns instead of regexp. These patterns
can have the following special characters:
<dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">*</span></span></dt><dd class="dd-description"> matches any string including the null string.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">?</span></span></dt><dd class="dd-description"> matches any single character.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">[...]</span></span></dt><dd class="dd-description"> matches any of the enclosed characters. Character
ranges are specified by a pair of characters separated by a <span style="font-family:monospace">&#X2018;-&#X2019;</span>.
If the first character after <span style="font-family:monospace">&#X2018;[&#X2019;</span> is a <span style="font-family:monospace">&#X2018;!&#X2019;</span>, any
character not enclosed is matched.
</dd></dl>
</dd></dl><p>The following <span style="font-family:monospace">ACLName</span> are pre-defined:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">all</span></span></dt><dd class="dd-description"> Matches any JID.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">none</span></span></dt><dd class="dd-description"> Matches no JID.
</dd></dl><p> <a id="AccessRights"></a> </p>
<!--TOC subsubsection id="sec39" Access Rights-->
<h4 id="sec39" class="subsubsection"><a href="#AccessRights">Access Rights</a></h4><!--SEC END --><p> <a id="AccessRights"></a> 
</p><p>An entry allowing or denying access to different services.
The syntax is:
</p><dl class="description"><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">access: { AccessName: { ACLName: allow|deny } }</span></span></dt></dl><p>When a JID is checked to have access to <span style="font-family:monospace">Accessname</span>, the server
sequentially checks if that JID matches any of the ACLs that are named in the
first elements of the tuples in the list. If it matches, the second element of
the first matched tuple is returned, otherwise the value &#X2018;<span style="font-family:monospace">deny</span>&#X2019; is
returned.</p><p>If you define specific Access rights in a virtual host,
remember that the globally defined Access rights have precedence over those.
This means that, in case of conflict, the Access granted or denied in the global server is used
and the Access of a virtual host doesn&#X2019;t have effect.</p><p>Example:
</p><pre class="verbatim">access:
  configure:
    admin: allow
  something
    badmans: deny
    all: allow
</pre><p>The following <span style="font-family:monospace">AccessName</span> are pre-defined:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">all</span></span></dt><dd class="dd-description"> Always returns the value &#X2018;<span style="font-family:monospace">allow</span>&#X2019;.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">none</span></span></dt><dd class="dd-description"> Always returns the value &#X2018;<span style="font-family:monospace">deny</span>&#X2019;.
</dd></dl><p> <a id="configmaxsessions"></a> </p>
<!--TOC subsubsection id="sec40" Limiting Opened Sessions with ACL-->
<h4 id="sec40" class="subsubsection"><a href="#configmaxsessions">Limiting Opened Sessions with ACL</a></h4><!--SEC END --><p> <a id="configmaxsessions"></a> 
</p><p>The special access <span style="font-family:monospace">max_user_sessions</span> specifies the maximum
number of sessions (authenticated connections) per user. If a user
tries to open more sessions by using different resources, the first
opened session will be disconnected. The error <span style="font-family:monospace">session replaced</span>
will be sent to the disconnected session. The value for this option
can be either a number, or <span style="font-family:monospace">infinity</span>. The default value is
<span style="font-family:monospace">infinity</span>.</p><p>The syntax is:
</p><dl class="description"><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">{ max_user_sessions: { ACLName: MaxNumber } }</span></span></dt></dl><p>This example limits the number of sessions per user to 5 for all users, and to 10 for admins:
</p><pre class="verbatim">access:
  max_user_sessions:
    admin: 10
    all: 5
</pre><p> <a id="configmaxs2sconns"></a> </p>
<!--TOC subsubsection id="sec41" Several connections to a remote XMPP server with ACL-->
<h4 id="sec41" class="subsubsection"><a href="#configmaxs2sconns">Several connections to a remote XMPP server with ACL</a></h4><!--SEC END --><p> <a id="configmaxs2sconns"></a> 
</p><p>The special access <span style="font-family:monospace">max_s2s_connections</span> specifies how many
simultaneous S2S connections can be established to a specific remote XMPP server.
The default value is <span style="font-family:monospace">1</span>.
There&#X2019;s also available the access <span style="font-family:monospace">max_s2s_connections_per_node</span>.</p><p>The syntax is:
</p><dl class="description"><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">{ max_s2s_connections: { ACLName: MaxNumber } }</span></span></dt></dl><p>Examples:
</p><ul class="itemize"><li class="li-itemize">
Allow up to 3 connections with each remote server:
<pre class="verbatim">access:
  max_s2s_connections:
    all: 3
</pre></li></ul><p> <a id="shapers"></a> </p>
<!--TOC subsection id="sec42" Shapers-->
<h3 id="sec42" class="subsection">3.1.7&#XA0;&#XA0;<a href="#shapers">Shapers</a></h3><!--SEC END --><p> <a id="shapers"></a> 
</p><p>Shapers enable you to limit connection traffic.
The syntax is:
</p><dl class="description"><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">shaper: { ShaperName: Rate }</span></span></dt></dl><p>
where <span style="font-family:monospace">Rate</span> stands for the maximum allowed incoming rate in bytes per
second.
When a connection exceeds this limit, <span style="font-family:monospace">ejabberd</span> stops reading from the socket
until the average rate is again below the allowed maximum.</p><p>Examples:
</p><ul class="itemize"><li class="li-itemize">
To define a shaper named &#X2018;<span style="font-family:monospace">normal</span>&#X2019; with traffic speed limited to
1,000&#XA0;bytes/second:
<pre class="verbatim">shaper:
  normal: 1000
</pre></li><li class="li-itemize">To define a shaper named &#X2018;<span style="font-family:monospace">fast</span>&#X2019; with traffic speed limited to
50,000&#XA0;bytes/second:
<pre class="verbatim">shaper:
  fast: 50000
</pre></li></ul><p> <a id="language"></a> </p>
<!--TOC subsection id="sec43" Default Language-->
<h3 id="sec43" class="subsection">3.1.8&#XA0;&#XA0;<a href="#language">Default Language</a></h3><!--SEC END --><p> <a id="language"></a> 
</p><p>The option <span style="font-family:monospace">language</span> defines the default language of server strings that
can be seen by XMPP clients. If a XMPP client does not support
<span style="font-family:monospace">xml:lang</span>, the specified language is used.</p><p>The option syntax is:
</p><dl class="description"><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">language: Language</span></span></dt></dl><p>The default value is <span style="font-family:monospace">en</span>.
In order to take effect there must be a translation file
<span style="font-family:monospace">Language.msg</span> in <span style="font-family:monospace">ejabberd</span>&#X2019;s <span style="font-family:monospace">msgs</span> directory.</p><p>For example, to set Russian as default language:
</p><pre class="verbatim">language: "ru"
</pre><p>Appendix <a href="#i18ni10n">A</a> provides more details about internationalization and localization.</p><p> <a id="captcha"></a> </p>
<!--TOC subsection id="sec44" CAPTCHA-->
<h3 id="sec44" class="subsection">3.1.9&#XA0;&#XA0;<a href="#captcha">CAPTCHA</a></h3><!--SEC END --><p> <a id="captcha"></a> 
</p><p>Some <span style="font-family:monospace">ejabberd</span> modules can be configured to require a CAPTCHA challenge on certain actions.
If the client does not support CAPTCHA Forms (<a href="http://xmpp.org/extensions/xep-0158.html">XEP-0158</a>),
a web link is provided so the user can fill the challenge in a web browser.</p><p>An example script is provided that generates the image
using ImageMagick&#X2019;s Convert program.</p><p>The configurable options are:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">captcha_cmd: Path</span></span></dt><dd class="dd-description"> 
Full path to a script that generates the image.
The default value disables the feature: <span style="font-family:monospace">undefined</span>
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">captcha_host: ProtocolHostPort</span></span></dt><dd class="dd-description"> 
ProtocolHostPort is a string with the host, and optionally the Protocol and Port number.
It must identify where ejabberd listens for CAPTCHA requests.
The URL sent to the user is formed by: <span style="font-family:monospace">Protocol://Host:Port/captcha/</span>
The default value is: protocol <span style="font-family:monospace">http</span>, the first hostname configured, and port <span style="font-family:monospace">80</span>.
If you specify a port number that does not match exactly an ejabberd listener
(because you are using a reverse proxy or other port-forwarding tool),
then you must specify the transfer protocol, as seen in the example below.
</dd></dl><p>Additionally, an <span style="font-family:monospace">ejabberd_http</span> listener must be enabled with the <span style="font-family:monospace">captcha</span> option.
See section <a href="#listened-module">3.1.4</a>.</p><p>Example configuration:
</p><pre class="verbatim">hosts: ["example.org"]

captcha_cmd: "/lib/ejabberd/priv/bin/captcha.sh"
captcha_host: "example.org:5280"
## captcha_host: "https://example.org:443"
## captcha_host: "http://example.com"

listen:
  ...
  -
    port: 5280
    module: ejabberd_http
    captcha: true
  ...
</pre><p> <a id="stun"></a> </p>
<!--TOC subsection id="sec45" STUN and TURN-->
<h3 id="sec45" class="subsection">3.1.10&#XA0;&#XA0;<a href="#stun">STUN and TURN</a></h3><!--SEC END --><p> <a id="stun"></a> 
</p><p><span style="font-family:monospace">ejabberd</span> is able to act as a stand-alone STUN/TURN server
(<a href="http://tools.ietf.org/html/rfc5389">RFC 5389</a>/<a href="http://tools.ietf.org/html/rfc5766">RFC 5766</a>). In that role <span style="font-family:monospace">ejabberd</span> helps clients with ICE (<a href="http://tools.ietf.org/html/rfc5245">RFC 5245</a>) or Jingle ICE (<a href="http://xmpp.org/extensions/xep-0176.html">XEP-0176</a>) support to discover their external addresses and ports and to relay media traffic when it is impossible to establish direct
peer-to-peer connection.</p><p>You should configure <span style="font-family:monospace">ejabberd_stun</span> listening module as described in <a href="#listened">3.1.4</a> section.
The specific configurable options are:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">tls: true|false</span></span></dt><dd class="dd-description">
If enabled, <span style="font-family:monospace">certfile</span> option must be set, otherwise <span style="font-family:monospace">ejabberd</span>
will not be able to accept TLS connections. Obviously, this option
makes sense for <span style="font-family:monospace">tcp</span> transport only. The default is <span style="font-family:monospace">false</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">certfile: Path</span></span></dt><dd class="dd-description">
Path to the certificate file. Only makes sense when <span style="font-family:monospace">tls</span> is set.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">use_turn: true|false</span></span></dt><dd class="dd-description">
Enables/disables TURN (media relay) functionality. The default is <span style="font-family:monospace">false</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">turn_ip: String</span></span></dt><dd class="dd-description">
The IPv4 address advertised by your TURN server. The address should not be NAT&#X2019;ed
or firewalled. There is not default, so you should set this option explicitly.
Implies <span style="font-family:monospace">use_turn</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">turn_min_port: Integer</span></span></dt><dd class="dd-description">
Together with <span style="font-family:monospace">turn_max_port</span> forms port range to allocate from.
The default is 49152. Implies <span style="font-family:monospace">use_turn</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">turn_max_port: Integer</span></span></dt><dd class="dd-description">
Together with <span style="font-family:monospace">turn_min_port</span> forms port range to allocate from.
The default is 65535. Implies <span style="font-family:monospace">use_turn</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">turn_max_allocations: Integer|unlimited</span></span></dt><dd class="dd-description">
Maximum number of TURN allocations available from the particular IP address.
The default value is 10. Implies <span style="font-family:monospace">use_turn</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">turn_max_permissions: Integer|unlimited</span></span></dt><dd class="dd-description">
Maximum number of TURN permissions available from the particular IP address.
The default value is 10. Implies <span style="font-family:monospace">use_turn</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">auth_type: user|anonymous</span></span></dt><dd class="dd-description">
Which authentication type to use for TURN allocation requests. When type <span style="font-family:monospace">user</span>
is set, ejabberd authentication backend is used. For <span style="font-family:monospace">anonymous</span> type
no authentication is performed (not recommended for public services).
The default is <span style="font-family:monospace">user</span>. Implies <span style="font-family:monospace">use_turn</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">auth_realm: String</span></span></dt><dd class="dd-description">
When <span style="font-family:monospace">auth_type</span> is set to <span style="font-family:monospace">user</span> and you have several virtual
hosts configured you should set this option explicitly to the virtual host
you want to serve on this particular listening port. Implies <span style="font-family:monospace">use_turn</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">shaper: Atom</span></span></dt><dd class="dd-description">
For <span style="font-family:monospace">tcp</span> transports defines shaper to use. The default is <span style="font-family:monospace">none</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">server_name: String</span></span></dt><dd class="dd-description">
Defines software version to return with every response. The default is the
STUN library version.
</dd></dl><p>Example configuration with disabled TURN functionality (STUN only):
</p><pre class="verbatim">listen:
  ...
  - 
    port: 3478
    transport: udp
    module: ejabberd_stun
  - 
    port: 3478
    module: ejabberd_stun
  -
    port: 5349
    module: ejabberd_stun
    certfile: "/etc/ejabberd/server.pem"
  ...
</pre><p>Example configuration with TURN functionality. Note that STUN is always
enabled if TURN is enabled. Here, only UDP section is shown:
</p><pre class="verbatim">listen:
  ...
  - 
    port: 3478
    transport: udp
    use_turn: true
    turn_ip: 10.20.30.1
    module: ejabberd_stun
  ...
</pre><p>You also need to configure DNS SRV records properly so clients can easily discover a
STUN/TURN server serving your XMPP domain. Refer to section
<a href="http://tools.ietf.org/html/rfc5389#section-9">DNS Discovery of a Server</a>
of <a href="http://tools.ietf.org/html/rfc5389">RFC 5389</a> and section
<a href="http://tools.ietf.org/html/rfc5766#section-6">Creating an Allocation</a>
of <a href="http://tools.ietf.org/html/rfc5766">RFC 5766</a> for details.</p><p>Example DNS SRV configuration for STUN only:
</p><pre class="verbatim">_stun._udp   IN SRV  0 0 3478 stun.example.com.
_stun._tcp   IN SRV  0 0 3478 stun.example.com.
_stuns._tcp  IN SRV  0 0 5349 stun.example.com.
</pre><p>And you should also add these in the case if TURN is enabled:
</p><pre class="verbatim">_turn._udp   IN SRV  0 0 3478 turn.example.com.
_turn._tcp   IN SRV  0 0 3478 turn.example.com.
_turns._tcp  IN SRV  0 0 5349 turn.example.com.
</pre><p> <a id="sip"></a> </p>
<!--TOC subsection id="sec46" SIP-->
<h3 id="sec46" class="subsection">3.1.11&#XA0;&#XA0;<a href="#sip">SIP</a></h3><!--SEC END --><p> <a id="sip"></a> 
</p><p><span style="font-family:monospace">ejabberd</span> has built-in SIP support. In order to activate it you need to add
listeners for it, configure DNS properly and enable <span style="font-family:monospace">mod_sip</span> for
the desired virtual host.</p><p>To add a listener you should configure <span style="font-family:monospace">ejabberd_sip</span> listening module as
described in <a href="#listened">3.1.4</a> section. If option <span style="font-family:monospace">tls</span> is specified, option
<span style="font-family:monospace">certfile</span> must be specified as well, otherwise incoming TLS connections would fail.</p><p>Example configuration with standard ports
(as per <a href="http://tools.ietf.org/html/rfc3261">RFC 3261</a>):
</p><pre class="verbatim">listen:
  ...
  - 
    port: 5060
    transport: udp
    module: ejabberd_sip
  - 
    port: 5060
    module: ejabberd_sip
  -
    port: 5061
    module: ejabberd_sip
    tls: true
    certfile: "/etc/ejabberd/server.pem"
  ...
</pre><p>Note that there is no StartTLS support in SIP and <a href="http://en.wikipedia.org/wiki/Server_Name_Indication">SNI</a> support is somewhat tricky, so for TLS you have to configure
different virtual hosts on different ports if you have different certificate files for them.</p><p>Next you need to configure DNS SIP records for your virtual domains.
Refer to <a href="http://tools.ietf.org/html/rfc3263">RFC 3263</a> for the detailed explanation.
Simply put, you should add NAPTR and SRV records for your domains.
Skip NAPTR configuration if your DNS provider doesn&#X2019;t support this type of records.
It&#X2019;s not fatal, however, highly recommended.</p><p>Example configuration of NAPTR records:
</p><pre class="verbatim">example.com IN NAPTR 10  0 "s" "SIPS+D2T" "" _sips._tcp.example.com.
example.com IN NAPTR 20  0 "s" "SIP+D2T" "" _sip._tcp.example.com.
example.com IN NAPTR 30  0 "s" "SIP+D2U" "" _sip._udp.example.com.
</pre><p>Example configuration of SRV records with standard ports
(as per <a href="http://tools.ietf.org/html/rfc3261">RFC 3261</a>):
</p><pre class="verbatim">_sip._udp   IN SRV  0 0 5060 sip.example.com.
_sip._tcp   IN SRV  0 0 5060 sip.example.com.
_sips._tcp  IN SRV  0 0 5061 sip.example.com.
</pre><p> <a id="includeconfigfile"></a> </p>
<!--TOC subsection id="sec47" Include Additional Configuration Files-->
<h3 id="sec47" class="subsection">3.1.12&#XA0;&#XA0;<a href="#includeconfigfile">Include Additional Configuration Files</a></h3><!--SEC END --><p> <a id="includeconfigfile"></a> 
</p><p>The option <span style="font-family:monospace">include_config_file</span> in a configuration file instructs <span style="font-family:monospace">ejabberd</span> to include other configuration files immediately.</p><p>The basic syntax is:
</p><dl class="description"><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">include_config_file: [Filename]</span></span></dt></dl><p>
It is possible to specify suboptions using the full syntax:
</p><dl class="description"><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">include_config_file: { Filename: [Suboption, ...] }</span></span></dt></dl><p>The filename can be indicated either as an absolute path,
or relative to the main <span style="font-family:monospace">ejabberd</span> configuration file.
It isn&#X2019;t possible to use wildcards.
The file must exist and be readable.</p><p>The allowed suboptions are:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">disallow: [Optionname, ...]</span></span></dt><dd class="dd-description"> Disallows the usage of those options in the included configuration file.
The options that match this criteria are not accepted.
The default value is an empty list: <span style="font-family:monospace">[]</span>
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">allow_only: [Optionname, ...]</span></span></dt><dd class="dd-description"> Allows only the usage of those options in the included configuration file.
The options that do not match this criteria are not accepted.
The default value is: <span style="font-family:monospace">all</span>
</dd></dl><p>This is a basic example:
</p><pre class="verbatim">include_config_file: "/etc/ejabberd/additional.yml"
</pre><p>In this example, the included file is not allowed to contain a <span style="font-family:monospace">listen</span> option.
If such an option is present, the option will not be accepted.
The file is in a subdirectory from where the main configuration file is.
</p><pre class="verbatim">include_config_file:
  "./example.org/additional_not_listen.yml":
    disallow: [listen]
</pre><p>In this example, <span style="font-family:monospace">ejabberd.yml</span> defines some ACL and Access rules,
and later includes another file with additional rules:
</p><pre class="verbatim">acl:
  admin:
    user:
      - "admin": "localhost"
access:
  announce:
    admin: allow
include_config_file:
  "/etc/ejabberd/acl_and_access.yml":
    allow_only:
      - acl
      - access
</pre><p>and content of the file <span style="font-family:monospace">acl_and_access.yml</span> can be, for example:
</p><pre class="verbatim">acl:
  admin:
    user:
      - "bob": "localhost"
      - "jan": "localhost"
</pre><p> <a id="optionmacros"></a> </p>
<!--TOC subsection id="sec48" Option Macros in Configuration File-->
<h3 id="sec48" class="subsection">3.1.13&#XA0;&#XA0;<a href="#optionmacros">Option Macros in Configuration File</a></h3><!--SEC END --><p> <a id="optionmacros"></a> 
</p><p>In the <span style="font-family:monospace">ejabberd</span> configuration file,
it is possible to define a macro for a value
and later use this macro when defining an option.</p><p>A macro is defined with this syntax:
</p><dl class="description"><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">define_macro: { &#X2019;MACRO&#X2019;: Value }</span></span></dt></dl><p>
The <span style="font-family:monospace">MACRO</span> must be surrounded by single quotation marks,
and all letters in uppercase; check the examples bellow.
The <span style="font-family:monospace">value</span> can be any valid arbitrary Erlang term.</p><p>The first definition of a macro is preserved,
and additional definitions of the same macro are forgotten.</p><p>Macros are processed after
additional configuration files have been included,
so it is possible to use macros that
are defined in configuration files included before the usage.</p><p>It isn&#X2019;t possible to use a macro in the definition
of another macro.</p><p>This example shows the basic usage of a macro:
</p><pre class="verbatim">define_macro:
  'LOG_LEVEL_NUMBER': 5
loglevel: 'LOG_LEVEL_NUMBER'
</pre><p>The resulting option interpreted by <span style="font-family:monospace">ejabberd</span> is: <span style="font-family:monospace">loglevel: 5</span>.</p><p>This example shows that values can be any arbitrary Erlang term:
</p><pre class="verbatim">define_macro:
  'USERBOB':
    user:
      - "bob": "localhost"
acl:
  admin: 'USERBOB'
</pre><p>The resulting option interpreted by <span style="font-family:monospace">ejabberd</span> is:
</p><pre class="verbatim">acl:
  admin:
    user:
      - "bob": "localhost"
</pre><p>This complex example:
</p><pre class="verbatim">define_macro:
  'NUMBER_PORT_C2S': 5222
  'NUMBER_PORT_HTTP': 5280
listen:
  - 
    port: 'NUMBER_PORT_C2S'
    module: ejabberd_c2s
  - 
    port: 'NUMBER_PORT_HTTP'
    module: ejabberd_http
</pre><p>produces this result after being interpreted:
</p><pre class="verbatim">listen:
  - 
    port: 5222
    module: ejabberd_c2s
  - 
    port: 5280
    module: ejabberd_http
</pre><p> <a id="database"></a> </p>
<!--TOC section id="sec49" Database and LDAP Configuration-->
<h2 id="sec49" class="section">3.2&#XA0;&#XA0;<a href="#database">Database and LDAP Configuration</a></h2><!--SEC END --><p> <a id="database"></a> 

</p><p><span style="font-family:monospace">ejabberd</span> uses its internal Mnesia database by default. However, it is
possible to use a relational database or an LDAP server to store persistent,
long-living data. <span style="font-family:monospace">ejabberd</span> is very flexible: you can configure different
authentication methods for different virtual hosts, you can configure different
authentication mechanisms for the same virtual host (fallback), you can set
different storage systems for modules, and so forth.</p><p>The following databases are supported by <span style="font-family:monospace">ejabberd</span>:
</p><ul class="itemize"><li class="li-itemize">
<a href="http://www.erlang.org/doc/apps/mnesia/index.html">Mnesia</a>
</li><li class="li-itemize"><a href="http://www.mysql.com/">MySQL</a>
</li><li class="li-itemize"><a href="http://en.wikipedia.org/wiki/Open_Database_Connectivity">Any ODBC compatible database</a>
</li><li class="li-itemize"><a href="http://www.postgresql.org/">PostgreSQL</a>
</li></ul><p>The following LDAP servers are tested with <span style="font-family:monospace">ejabberd</span>:
</p><ul class="itemize"><li class="li-itemize">
<a href="http://www.microsoft.com/activedirectory/">Active Directory</a>
(see section&#XA0;<a href="#ad">3.2.2</a>)
</li><li class="li-itemize"><a href="http://www.openldap.org/">OpenLDAP</a>
</li><li class="li-itemize"><a href="http://www.communigate.com/">CommuniGate Pro</a>
</li><li class="li-itemize">Normally any LDAP compatible server should work; inform us about your
success with a not-listed server so that we can list it here.
</li></ul><p>Important note about virtual hosting:
if you define several domains in ejabberd.yml (see section <a href="#hostnames">3.1.2</a>),
you probably want that each virtual host uses a different configuration of database, authentication and storage,
so that usernames do not conflict and mix between different virtual hosts.
For that purpose, the options described in the next sections
must be set inside a <span style="font-family:monospace">host_config</span> for each vhost (see section <a href="#virtualhost">3.1.3</a>).
For example:
</p><pre class="verbatim">host_config:
  "public.example.org":
    odbc_type: pgsql
    odbc_server: "localhost"
    odbc_database: "database-public-example-org"
    odbc_username: "ejabberd"
    odbc_password: "password"
    auth_method: [odbc]
</pre><p> <a id="odbc"></a> </p>
<!--TOC subsection id="sec50" ODBC-->
<h3 id="sec50" class="subsection">3.2.1&#XA0;&#XA0;<a href="#odbc">ODBC</a></h3><!--SEC END --><p> <a id="odbc"></a> </p><p>The actual database access is defined in the options with <span style="font-family:monospace">odbc_</span> prefix. The
values are used to define if we want to use ODBC, or one of the two native
interface available, PostgreSQL or MySQL.</p><p>The following paramaters are available:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">odbc_type: mysql | pgsql | odbc</span></span></dt><dd class="dd-description"> The type of an ODBC connection.
The default is <span style="font-family:monospace">odbc</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">odbc_server: String</span></span></dt><dd class="dd-description"> A hostname of the ODBC server. The default is
<span style="font-family:monospace">&#X2018;&#X2018;localhost&#X2019;&#X2019;</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">odbc_port: Port</span></span></dt><dd class="dd-description"> The port where the ODBC server is accepting connections.
The option is only valid for <span style="font-family:monospace">mysql</span> and <span style="font-family:monospace">pgsql</span>. The default is
<span style="font-family:monospace">3306</span> and <span style="font-family:monospace">5432</span> respectively.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">odbc_database: String</span></span></dt><dd class="dd-description"> The database name. The default is <span style="font-family:monospace">&#X2018;&#X2018;ejabberd&#X2019;&#X2019;</span>.
The option is only valid for <span style="font-family:monospace">mysql</span> and <span style="font-family:monospace">pgsql</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">odbc_username: String</span></span></dt><dd class="dd-description"> The username. The default is <span style="font-family:monospace">&#X2018;&#X2018;ejabberd&#X2019;&#X2019;</span>.
The option is only valid for <span style="font-family:monospace">mysql</span> and <span style="font-family:monospace">pgsql</span>. 
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">odbc_password: String</span></span></dt><dd class="dd-description"> The password. The default is empty string.
The option is only valid for <span style="font-family:monospace">mysql</span> and <span style="font-family:monospace">pgsql</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">odbc_pool_size: N</span></span></dt><dd class="dd-description"> By default <span style="font-family:monospace">ejabberd</span> opens 10 connections to
the database for each virtual host. You can change this number by using this option.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">odbc_keepalive_interval: N</span></span></dt><dd class="dd-description"> You can configure an interval to
make a dummy SQL request to keep alive the connections to the database.
The default value is &#X2019;undefined&#X2019;, so no keepalive requests are made.
Specify in seconds: for example 28800 means 8 hours.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">odbc_start_interval: N</span></span></dt><dd class="dd-description"> If the connection to the database fails,
<span style="font-family:monospace">ejabberd</span> waits 30 seconds before retrying.
You can modify this interval with this option.
</dd></dl><p>Example of plain ODBC connection:
</p><pre class="verbatim">odbc_server: "DSN=database;UID=ejabberd;PWD=password"
</pre><p>Example of MySQL connection:
</p><pre class="verbatim">odbc_type: mysql
odbc_server: "server.company.com"
odbc_port: 3306 # the default
odbc_database: "mydb"
odbc_username: "user1"
odbc_password: "**********"
odbc_pool_size: 5
</pre><p> <a id="odbcstorage"></a> </p>
<!--TOC subsubsection id="sec51" Storage-->
<h4 id="sec51" class="subsubsection"><a href="#odbcstorage">Storage</a></h4><!--SEC END --><p> <a id="odbcstorage"></a> 
</p><p>An ODBC compatible database also can be used to store information into from
several <span style="font-family:monospace">ejabberd</span>
modules. See section&#XA0;<a href="#modoverview">3.3.1</a> to see which modules can be used with
relational databases like MySQL. To enable storage to your database, just make
sure that your database is running well (see previous sections), and add the
module option <span style="font-family:monospace">db_type: odbc</span>.</p><p> <a id="ldap"></a> </p>
<!--TOC subsection id="sec52" LDAP-->
<h3 id="sec52" class="subsection">3.2.2&#XA0;&#XA0;<a href="#ldap">LDAP</a></h3><!--SEC END --><p> <a id="ldap"></a> 
</p><p><span style="font-family:monospace">ejabberd</span> has built-in LDAP support. You can authenticate users against LDAP
server and use LDAP directory as vCard storage.</p><p>Usually <span style="font-family:monospace">ejabberd</span> treats LDAP as a read-only storage:
it is possible to consult data, but not possible to
create accounts or edit vCard that is stored in LDAP.
However, it is possible to change passwords if <span style="font-family:monospace">mod_register</span> module is enabled
and LDAP server supports
<a href="http://tools.ietf.org/html/rfc3062">RFC 3062</a>.</p><p> <a id="ldapconnection"></a> </p>
<!--TOC subsubsection id="sec53" Connection-->
<h4 id="sec53" class="subsubsection"><a href="#ldapconnection">Connection</a></h4><!--SEC END --><p> <a id="ldapconnection"></a> </p><p>Two connections are established to the LDAP server per vhost,
one for authentication and other for regular calls.</p><p>Parameters:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">ldap_servers: [Servers, ...]</span></span></dt><dd class="dd-description"> List of IP addresses or DNS names of your
LDAP servers. This option is required.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ldap_encrypt: none|tls</span></span></dt><dd class="dd-description"> Type of connection encryption to the LDAP server.
Allowed values are: <span style="font-family:monospace">none</span>, <span style="font-family:monospace">tls</span>.
The value <span style="font-family:monospace">tls</span> enables encryption by using LDAP over SSL.
Note that STARTTLS encryption is not supported.
The default value is: <span style="font-family:monospace">none</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ldap_tls_verify: false|soft|hard</span></span></dt><dd class="dd-description"> 
This option specifies whether to verify LDAP server certificate or not when TLS is enabled.
When <span style="font-family:monospace">hard</span> is enabled <span style="font-family:monospace">ejabberd</span> doesn&#X2019;t proceed if a certificate is invalid.
When <span style="font-family:monospace">soft</span> is enabled <span style="font-family:monospace">ejabberd</span> proceeds even if check fails.
The default is <span style="font-family:monospace">false</span> which means no checks are performed.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ldap_tls_cacertfile: Path</span></span></dt><dd class="dd-description"> 
Path to file containing PEM encoded CA certificates. This option is needed
(and required) when TLS verification is enabled.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ldap_tls_depth: Number</span></span></dt><dd class="dd-description"> 
Specifies the maximum verification depth when TLS verification is enabled,
i.e. how far in a chain of certificates the verification process can proceed
before the verification is considered to fail.
Peer certificate = 0, CA certificate = 1, higher level CA certificate = 2, etc.
The value 2 thus means that a chain can at most contain peer cert,
CA cert, next CA cert, and an additional CA cert. The default value is 1.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ldap_port: Number</span></span></dt><dd class="dd-description"> Port to connect to your LDAP server.
The default port is&#XA0;389 if encryption is disabled; and 636 if encryption is enabled.
If you configure a value, it is stored in <span style="font-family:monospace">ejabberd</span>&#X2019;s database.
Then, if you remove that value from the configuration file,
the value previously stored in the database will be used instead of the default port.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ldap_rootdn: RootDN</span></span></dt><dd class="dd-description"> Bind DN. The default value
is&#XA0;<span style="font-family:monospace">""</span> which means &#X2018;anonymous connection&#X2019;.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ldap_password: Password</span></span></dt><dd class="dd-description"> Bind password. The default
value is <span style="font-family:monospace">""</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ldap_deref_aliases: never|always|finding|searching</span></span></dt><dd class="dd-description">  Whether or not to dereference aliases. The default is <span style="font-family:monospace">never</span>.
</dd></dl><p>Example:
</p><pre class="verbatim">auth_method: [ldap]
ldap_servers:
  - "ldap1.example.org"
ldap_port: 389
ldap_rootdn: "cn=Manager,dc=domain,dc=org"
ldap_password: "**********"
</pre><p> <a id="ldapauth"></a> </p>
<!--TOC subsubsection id="sec54" Authentication-->
<h4 id="sec54" class="subsubsection"><a href="#ldapauth">Authentication</a></h4><!--SEC END --><p> <a id="ldapauth"></a> </p><p>You can authenticate users against an LDAP directory. 
Note that current LDAP implementation does not support SASL authentication.</p><p>Available options are:</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">ldap_base: Base</span></span></dt><dd class="dd-description">LDAP base directory which stores
users accounts. This option is required.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ldap_uids: [ ldap_uidattr | {ldap_uidattr: ldap_uidattr_format} ]</span></span></dt><dd class="dd-description">
LDAP attribute which holds a list of attributes to use as alternatives for getting the JID. 
The default attributes are <span style="font-family:monospace">[{"uid", "%u"}]</span>.
The attributes are of the form:
<span style="font-family:monospace">[{ldap_uidattr}]</span> or <span style="font-family:monospace">[{ldap_uidattr, ldap_uidattr_format}]</span>.
You can use as many comma separated attributes as needed. 
The values for <span style="font-family:monospace">ldap_uidattr</span> and
<span style="font-family:monospace">ldap_uidattr_format</span> are described as follow:
<dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">ldap_uidattr</span></span></dt><dd class="dd-description">LDAP attribute which holds
the user&#X2019;s part of a JID. The default value is <span style="font-family:monospace">"uid"</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ldap_uidattr_format</span></span></dt><dd class="dd-description">Format of
the <span style="font-family:monospace">ldap_uidattr</span> variable. The format <em>must</em> contain one and
only one pattern variable <span style="font-family:monospace">"%u"</span> which will be replaced by the
user&#X2019;s part of a JID. For example, <span style="font-family:monospace">"%u@example.org"</span>. The default
value is <span style="font-family:monospace">"%u"</span>.
</dd></dl>
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ldap_filter: Filter</span></span></dt><dd class="dd-description">
<a href="http://tools.ietf.org/html/rfc4515">RFC 4515</a> LDAP filter. The
default Filter value is: <span style="font-family:monospace">undefined</span>. Example:
<span style="font-family:monospace">"(&amp;(objectClass=shadowAccount)(memberOf=Jabber Users))"</span>. Please, do
not forget to close brackets and do not use superfluous whitespaces. Also you
<em>must not</em> use <span style="font-family:monospace">ldap_uidattr</span> attribute in filter because this
attribute will be substituted in LDAP filter automatically.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ldap_dn_filter: { Filter: FilterAttrs }</span></span></dt><dd class="dd-description">
This filter is applied on the results returned by the main filter. This filter
performs additional LDAP lookup to make the complete result. This is useful
when you are unable to define all filter rules in <span style="font-family:monospace">ldap_filter</span>. You
can define <span style="font-family:monospace">"%u"</span>, <span style="font-family:monospace">"%d"</span>, <span style="font-family:monospace">"%s"</span> and <span style="font-family:monospace">"%D"</span> pattern
variables in Filter: <span style="font-family:monospace">"%u"</span> is replaced by a user&#X2019;s part of a JID,
<span style="font-family:monospace">"%d"</span> is replaced by the corresponding domain (virtual host),
all <span style="font-family:monospace">"%s"</span> variables are consecutively replaced by values of FilterAttrs
attributes and <span style="font-family:monospace">"%D"</span> is replaced by Distinguished Name. By default
<span style="font-family:monospace">ldap_dn_filter</span> is undefined.
Example:
<pre class="verbatim">ldap_dn_filter:
  "(&amp;(name=%s)(owner=%D)(user=%u@%d))": ["sn"]
</pre>Since this filter makes additional LDAP lookups, use it only in the
last resort: try to define all filter rules in <span style="font-family:monospace">ldap_filter</span> if possible.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">{ldap_local_filter, Filter}</span></span></dt><dd class="dd-description">
If you can&#X2019;t use <span style="font-family:monospace">ldap_filter</span> due to performance reasons
(the LDAP server has many users registered),
you can use this local filter.
The local filter checks an attribute in ejabberd,
not in LDAP, so this limits the load on the LDAP directory.
The default filter is: <span style="font-family:monospace">undefined</span>.
Example values:
<pre class="verbatim">{ldap_local_filter, {notequal, {"accountStatus",["disabled"]}}}.
{ldap_local_filter, {equal, {"accountStatus",["enabled"]}}}.
{ldap_local_filter, undefined}.
</pre></dd></dl><p> <a id="ldapexamples"></a> </p>
<!--TOC subsubsection id="sec55" Examples-->
<h4 id="sec55" class="subsubsection"><a href="#ldapexamples">Examples</a></h4><!--SEC END --><p> <a id="ldapexamples"></a> </p><p> <a id="ldapcommonexample"></a> </p>
<!--TOC paragraph id="sec56" Common example-->
<h5 id="sec56" class="paragraph"><a href="#ldapcommonexample">Common example</a></h5><!--SEC END --><p> <a id="ldapcommonexample"></a> </p><p>Let&#X2019;s say <span style="font-family:monospace">ldap.example.org</span> is the name of our LDAP server. We have
users with their passwords in <span style="font-family:monospace">"ou=Users,dc=example,dc=org"</span> directory.
Also we have addressbook, which contains users emails and their additional
infos in <span style="font-family:monospace">"ou=AddressBook,dc=example,dc=org"</span> directory.
The connection to the LDAP server is encrypted using TLS,
and using the custom port 6123.
Corresponding authentication section should looks like this:</p><pre class="verbatim">## Authentication method
auth_method: [ldap]
## DNS name of our LDAP server
ldap_servers: ["ldap.example.org"]
## Bind to LDAP server as "cn=Manager,dc=example,dc=org" with password "secret"
ldap_rootdn: "cn=Manager,dc=example,dc=org"
ldap_password: "secret"
ldap_encrypt: tls
ldap_port: 6123
## Define the user's base
ldap_base: "ou=Users,dc=example,dc=org"
## We want to authorize users from 'shadowAccount' object class only
ldap_filter: "(objectClass=shadowAccount)"
</pre><p>Now we want to use users LDAP-info as their vCards. We have four attributes
defined in our LDAP schema: <span style="font-family:monospace">"mail"</span> &#X2014; email address, <span style="font-family:monospace">"givenName"</span>
&#X2014; first name, <span style="font-family:monospace">"sn"</span> &#X2014; second name, <span style="font-family:monospace">"birthDay"</span> &#X2014; birthday.
Also we want users to search each other. Let&#X2019;s see how we can set it up:</p><pre class="verbatim">modules:
  ...
  mod_vcard_ldap:
    ## We use the same server and port, but want to bind anonymously because
    ## our LDAP server accepts anonymous requests to
    ## "ou=AddressBook,dc=example,dc=org" subtree.
    ldap_rootdn: ""
    ldap_password: ""
    ## define the addressbook's base
    ldap_base: "ou=AddressBook,dc=example,dc=org"
    ## uidattr: user's part of JID is located in the "mail" attribute
    ## uidattr_format: common format for our emails
    ldap_uids:
      "mail": "%u@mail.example.org"
    ## We have to define empty filter here, because entries in addressbook does not
    ## belong to shadowAccount object class
    ldap_filter: ""
    ## Now we want to define vCard pattern
    ldap_vcard_map:
     "NICKNAME": {"%u": []} # just use user's part of JID as his nickname
     "GIVEN": {"%s": ["givenName"]}
     "FAMILY": {"%s": ["sn"]}
     "FN": {"%s, %s": ["sn", "givenName"]}, # example: "Smith, John"
     "EMAIL": {"%s": ["mail"]}
     "BDAY": {"%s": ["birthDay"]}]}
    ## Search form
    ldap_search_fields:
      "User": "%u"
      "Name": "givenName"
      "Family Name": "sn"
      "Email": "mail"
      "Birthday": "birthDay"
    ## vCard fields to be reported
    ## Note that JID is always returned with search results
    ldap_search_reported:
      "Full Name": "FN"
      "Nickname": "NICKNAME"
      "Birthday": "BDAY"
  ...
</pre><p>Note that <span style="font-family:monospace">mod_vcard_ldap</span> module checks for the existence of the user before
searching in his information in LDAP.</p><p> <a id="ad"></a> </p>
<!--TOC paragraph id="sec57" Active Directory-->
<h5 id="sec57" class="paragraph"><a href="#ad">Active Directory</a></h5><!--SEC END --><p> <a id="ad"></a> 
</p><p>Active Directory is just an LDAP-server with predefined attributes. A sample
configuration is shown below:</p><pre class="verbatim">auth_method: [ldap]
ldap_servers: ["office.org"]  # List of LDAP servers
ldap_base: "DC=office,DC=org" # Search base of LDAP directory
ldap_rootdn: "CN=Administrator,CN=Users,DC=office,DC=org" # LDAP manager
ldap_password: "*******" # Password to LDAP manager
ldap_uids: ["sAMAccountName"]
ldap_filter: "(memberOf=*)"

modules: 
  ...
  mod_vcard_ldap: 
    ldap_vcard_map: 
      "NICKNAME": {"%u", []}
      "GIVEN": {"%s", ["givenName"]}
      "MIDDLE": {"%s", ["initials"]}
      "FAMILY": {"%s", ["sn"]}
      "FN": {"%s", ["displayName"]}
      "EMAIL": {"%s", ["mail"]}
      "ORGNAME": {"%s", ["company"]}
      "ORGUNIT": {"%s", ["department"]}
      "CTRY": {"%s", ["c"]}
      "LOCALITY": {"%s", ["l"]}
      "STREET": {"%s", ["streetAddress"]}
      "REGION": {"%s", ["st"]}
      "PCODE": {"%s", ["postalCode"]}
      "TITLE": {"%s", ["title"]}
      "URL": {"%s", ["wWWHomePage"]}
      "DESC": {"%s", ["description"]}
      "TEL": {"%s", ["telephoneNumber"]}]}
    ldap_search_fields: 
      "User": "%u"
      "Name": "givenName"
      "Family Name": "sn"
      "Email": "mail"
      "Company": "company"
      "Department": "department"
      "Role": "title"
      "Description": "description"
      "Phone": "telephoneNumber"
    ldap_search_reported: 
      "Full Name": "FN"
      "Nickname": "NICKNAME"
      "Email": "EMAIL"
  ...
</pre><p> <a id="modules"></a> </p>
<!--TOC section id="sec58" Modules Configuration-->
<h2 id="sec58" class="section">3.3&#XA0;&#XA0;<a href="#modules">Modules Configuration</a></h2><!--SEC END --><p> <a id="modules"></a> 
</p><p>The option <span style="font-family:monospace">modules</span> defines the list of modules that will be loaded after
<span style="font-family:monospace">ejabberd</span>&#X2019;s startup. Each entry in the list is a tuple in which the first
element is the name of a module and the second is a list of options for that
module.</p><p>The syntax is:
</p><dl class="description"><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">modules: { ModuleName: ModuleOptions }</span></span></dt></dl><p>Examples:
</p><ul class="itemize"><li class="li-itemize">
In this example only the module <span style="font-family:monospace">mod_echo</span> is loaded and no module
options are specified between the square brackets:
<pre class="verbatim">modules:
  mod_echo: {}
</pre></li><li class="li-itemize">In the second example the modules <span style="font-family:monospace">mod_echo</span>, <span style="font-family:monospace">mod_time</span>, and
<span style="font-family:monospace">mod_version</span> are loaded without options.
<pre class="verbatim">modules:
  mod_echo:      {}
  mod_time:      {}
  mod_version:   {}
</pre></li></ul><p> <a id="modoverview"></a> </p>
<!--TOC subsection id="sec59" Modules Overview-->
<h3 id="sec59" class="subsection">3.3.1&#XA0;&#XA0;<a href="#modoverview">Modules Overview</a></h3><!--SEC END --><p> <a id="modoverview"></a> 
</p><p>The following table lists all modules included in <span style="font-family:monospace">ejabberd</span>.</p><blockquote class="table"><div class="center"><div class="center"><hr style="width:80%;height:2"></div>
<table border=1  style="border-spacing:0;" class="cellpadding1"><tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><span style="font-weight:bold">Module</span></td><td style="text-align:left;border:solid 1px;white-space:nowrap" ><span style="font-weight:bold">Feature</span></td><td style="text-align:left;border:solid 1px;white-space:nowrap" ><span style="font-weight:bold">Dependencies</span> </td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><span style="font-family:monospace">mod_adhoc</span></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Ad-Hoc Commands (<a href="http://xmpp.org/extensions/xep-0050.html">XEP-0050</a>)</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><a href="#modannounce"><span style="font-family:monospace">mod_announce</span></a></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Manage announcements</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >recommends <span style="font-family:monospace">mod_adhoc</span> </td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><span style="font-family:monospace">mod_blocking</span></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Simple Communications Blocking (<a href="http://xmpp.org/extensions/xep-0191.html">XEP-0191</a>)</td><td style="text-align:left;border:solid 1px;white-space:nowrap" ><span style="font-family:monospace">mod_privacy</span> </td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><span style="font-family:monospace">mod_caps</span></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Entity Capabilities (<a href="http://xmpp.org/extensions/xep-0115.html">XEP-0115</a>)</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><span style="font-family:monospace">mod_carboncopy</span></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Message Carbons (<a href="http://xmpp.org/extensions/xep-0280.html">XEP-0280</a>)</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><span style="font-family:monospace">mod_configure</span></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Server configuration using Ad-Hoc</td><td style="text-align:left;border:solid 1px;white-space:nowrap" ><span style="font-family:monospace">mod_adhoc</span> </td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><a href="#moddisco"><span style="font-family:monospace">mod_disco</span></a></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Service Discovery (<a href="http://xmpp.org/extensions/xep-0030.html">XEP-0030</a>)</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><a href="#modecho"><span style="font-family:monospace">mod_echo</span></a></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Echoes XMPP stanzas</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><a href="#modhttpbind"><span style="font-family:monospace">mod_http_bind</span></a></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >XMPP over Bosh service (HTTP Binding)</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><a href="#modhttpfileserver"><span style="font-family:monospace">mod_http_fileserver</span></a></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Small HTTP file server</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><a href="#modirc"><span style="font-family:monospace">mod_irc</span></a></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >IRC transport</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><a href="#modlast"><span style="font-family:monospace">mod_last</span></a></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Last Activity (<a href="http://xmpp.org/extensions/xep-0012.html">XEP-0012</a>)</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><a href="#modmuc"><span style="font-family:monospace">mod_muc</span></a></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Multi-User Chat (<a href="http://xmpp.org/extensions/xep-0045.html">XEP-0045</a>)</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><a href="#modmuclog"><span style="font-family:monospace">mod_muc_log</span></a></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Multi-User Chat room logging</td><td style="text-align:left;border:solid 1px;white-space:nowrap" ><span style="font-family:monospace">mod_muc</span> </td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><a href="#modoffline"><span style="font-family:monospace">mod_offline</span></a></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Offline message storage (<a href="http://xmpp.org/extensions/xep-0160.html">XEP-0160</a>)</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><a href="#modping"><span style="font-family:monospace">mod_ping</span></a></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >XMPP Ping and periodic keepalives (<a href="http://xmpp.org/extensions/xep-0199.html">XEP-0199</a>)</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><a href="#modprescounter"><span style="font-family:monospace">mod_pres_counter</span></a></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Detect presence subscription flood</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><a href="#modprivacy"><span style="font-family:monospace">mod_privacy</span></a></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Blocking Communication (<a href="http://xmpp.org/extensions/xep-0016.html">XEP-0016</a>)</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><a href="#modprivate"><span style="font-family:monospace">mod_private</span></a></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Private XML Storage (<a href="http://xmpp.org/extensions/xep-0049.html">XEP-0049</a>)</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><a href="#modproxy"><span style="font-family:monospace">mod_proxy65</span></a></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >SOCKS5 Bytestreams (<a href="http://xmpp.org/extensions/xep-0065.html">XEP-0065</a>)</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><a href="#modpubsub"><span style="font-family:monospace">mod_pubsub</span></a></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Pub-Sub (<a href="http://xmpp.org/extensions/xep-0060.html">XEP-0060</a>), PEP (<a href="http://xmpp.org/extensions/xep-0163.html">XEP-0163</a>)</td><td style="text-align:left;border:solid 1px;white-space:nowrap" ><span style="font-family:monospace">mod_caps</span> </td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><a href="#modpubsub"><span style="font-family:monospace">mod_pubsub_odbc</span></a></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Pub-Sub (<a href="http://xmpp.org/extensions/xep-0060.html">XEP-0060</a>), PEP (<a href="http://xmpp.org/extensions/xep-0163.html">XEP-0163</a>)</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >supported DB (*) and <span style="font-family:monospace">mod_caps</span> </td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><a href="#modregister"><span style="font-family:monospace">mod_register</span></a></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >In-Band Registration (<a href="http://xmpp.org/extensions/xep-0077.html">XEP-0077</a>)</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><a href="#modregisterweb"><span style="font-family:monospace">mod_register_web</span></a></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Web for Account Registrations</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><a href="#modroster"><span style="font-family:monospace">mod_roster</span></a></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Roster management (XMPP IM)</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><a href="#modservicelog"><span style="font-family:monospace">mod_service_log</span></a></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Copy user messages to logger service</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><a href="#modsharedroster"><span style="font-family:monospace">mod_shared_roster</span></a></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Shared roster management</td><td style="text-align:left;border:solid 1px;white-space:nowrap" ><span style="font-family:monospace">mod_roster</span> </td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><a href="#modsharedrosterldap"><span style="font-family:monospace">mod_shared_roster_ldap</span></a></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >LDAP Shared roster management</td><td style="text-align:left;border:solid 1px;white-space:nowrap" ><span style="font-family:monospace">mod_roster</span> </td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><a href="#modsic"><span style="font-family:monospace">mod_sic</span></a></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Server IP Check (<a href="http://xmpp.org/extensions/xep-0279.html">XEP-0279</a>)</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><a href="#modsip"><span style="font-family:monospace">mod_sip</span></a></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >SIP Registrar/Proxy (<a href="http://tools.ietf.org/html/rfc3261">RFC 3261</a>)</td><td style="text-align:left;border:solid 1px;white-space:nowrap" ><span style="font-family:monospace">ejabberd_sip</span> </td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><a href="#modstats"><span style="font-family:monospace">mod_stats</span></a></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Statistics Gathering (<a href="http://xmpp.org/extensions/xep-0039.html">XEP-0039</a>)</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><a href="#modtime"><span style="font-family:monospace">mod_time</span></a></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Entity Time (<a href="http://xmpp.org/extensions/xep-0202.html">XEP-0202</a>)</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><a href="#modvcard"><span style="font-family:monospace">mod_vcard</span></a></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >vcard-temp (<a href="http://xmpp.org/extensions/xep-0054.html">XEP-0054</a>)</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><a href="#modvcardldap"><span style="font-family:monospace">mod_vcard_ldap</span></a></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >vcard-temp (<a href="http://xmpp.org/extensions/xep-0054.html">XEP-0054</a>)</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >LDAP server </td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><a href="#modvcardxupdate"><span style="font-family:monospace">mod_vcard_xupdate</span></a></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >vCard-Based Avatars (<a href="http://xmpp.org/extensions/xep-0153.html">XEP-0153</a>)</td><td style="text-align:left;border:solid 1px;white-space:nowrap" ><span style="font-family:monospace">mod_vcard</span> </td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><a href="#modversion"><span style="font-family:monospace">mod_version</span></a></td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Software Version (<a href="http://xmpp.org/extensions/xep-0092.html">XEP-0092</a>)</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >&nbsp;</td></tr>
</table>
<div class="center"><hr style="width:80%;height:2"></div></div></blockquote><ul class="itemize"><li class="li-itemize">
(*) This module requires a supported database. For a list of supported databases, see section&#XA0;<a href="#database">3.2</a>.
</li></ul><p>You can see which database backend each module needs by looking at the suffix:
</p><ul class="itemize"><li class="li-itemize">
No suffix, this means that the module uses Erlang&#X2019;s built-in database
Mnesia as backend, or a ODBC database in some cases (see&#XA0;<a href="#database">3.2</a>).
</li><li class="li-itemize">&#X2018;_ldap&#X2019;, this means that the module needs an LDAP server as backend.
</li></ul><p>You can find more
<a href="http://www.ejabberd.im/contributions">contributed modules</a> on the
<span style="font-family:monospace">ejabberd</span> website. Please remember that these contributions might not work or
that they can contain severe bugs and security leaks. Therefore, use them at
your own risk!</p><p> <a id="modcommonoptions"></a> </p>
<!--TOC subsection id="sec60" Common Options-->
<h3 id="sec60" class="subsection">3.3.2&#XA0;&#XA0;<a href="#modcommonoptions">Common Options</a></h3><!--SEC END --><p> <a id="modcommonoptions"></a> </p><p>The following options are used by many modules. Therefore, they are described in
this separate section.</p><p> <a id="modiqdiscoption"></a> </p>
<!--TOC subsubsection id="sec61" <span style="font-family:monospace">iqdisc</span>-->
<h4 id="sec61" class="subsubsection"><a href="#modiqdiscoption"><span style="font-family:monospace">iqdisc</span></a></h4><!--SEC END --><p> <a id="modiqdiscoption"></a> 
</p><p>Many modules define handlers for processing IQ queries of different namespaces
to this server or to a user (e.&#XA0;g. to <span style="font-family:monospace">example.org</span> or to
<span style="font-family:monospace">user@example.org</span>). This option defines processing discipline for
these queries.</p><p>The syntax is:
</p><dl class="description"><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">iqdisc: Value</span></span></dt></dl><p>Possible <span style="font-family:monospace">Value</span> are:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">no_queue</span></span></dt><dd class="dd-description"> All queries of a namespace with this processing discipline are
processed directly. This means that the XMPP connection that sends this IQ query gets blocked:
no other packets can be processed
until this one has been completely processed. Hence this discipline is not
recommended if the processing of a query can take a relatively long time.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">one_queue</span></span></dt><dd class="dd-description"> In this case a separate queue is created for the processing
of IQ queries of a namespace with this discipline. In addition, the processing
of this queue is done in parallel with that of other packets. This discipline
is most recommended.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">N</span></span></dt><dd class="dd-description"> N separate queues are created to process the
queries. The queries are thus processed in parallel, but in a
controlled way.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">parallel</span></span></dt><dd class="dd-description"> For every packet with this discipline a separate Erlang process
is spawned. Consequently, all these packets are processed in parallel.
Although spawning of Erlang process has a relatively low cost, this can break
the server&#X2019;s normal work, because the Erlang emulator has a limit on the
number of processes (32000 by default).
</dd></dl><p>Example:
</p><pre class="verbatim">modules:
  ...
  mod_time:
    iqdisc: no_queue
  ...
</pre><p> <a id="modhostoption"></a> </p>
<!--TOC subsubsection id="sec62" <span style="font-family:monospace">host</span>-->
<h4 id="sec62" class="subsubsection"><a href="#modhostoption"><span style="font-family:monospace">host</span></a></h4><!--SEC END --><p> <a id="modhostoption"></a> 
</p><p>This option defines the Jabber ID of a service provided by an <span style="font-family:monospace">ejabberd</span> module.</p><p>The syntax is:
</p><dl class="description"><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">host: HostName</span></span></dt></dl><p>If you include the keyword "@HOST@" in the HostName,
it is replaced at start time with the real virtual host string.</p><p>This example configures
the echo module to provide its echoing service
in the Jabber ID <span style="font-family:monospace">mirror.example.org</span>:
</p><pre class="verbatim">modules:
  ...
  mod_echo:
    host: "mirror.example.org"
  ...
</pre><p>However, if there are several virtual hosts and this module is enabled in all of them,
the "@HOST@" keyword must be used:
</p><pre class="verbatim">modules:
  ...
  mod_echo:
    host: "mirror.@HOST@"
  ...
</pre><p> <a id="modannounce"></a> </p>
<!--TOC subsection id="sec63" <span style="font-family:monospace">mod_announce</span>-->
<h3 id="sec63" class="subsection">3.3.3&#XA0;&#XA0;<a href="#modannounce"><span style="font-family:monospace">mod_announce</span></a></h3><!--SEC END --><p> <a id="modannounce"></a> 
</p><p>This module enables configured users to broadcast announcements and to set
the message of the day (MOTD).
Configured users can perform these actions with a
XMPP client either using Ad-hoc commands
or sending messages to specific JIDs.</p><p>The Ad-hoc commands are listed in the Server Discovery.
For this feature to work, <span style="font-family:monospace">mod_adhoc</span> must be enabled.</p><p>The specific JIDs where messages can be sent are listed bellow.
The first JID in each entry will apply only to the specified virtual host
<span style="font-family:monospace">example.org</span>, while the JID between brackets will apply to all virtual
hosts in ejabberd.
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">example.org/announce/all (example.org/announce/all-hosts/all)</span></span></dt><dd class="dd-description"> The
message is sent to all registered users. If the user is online and connected
to several resources, only the resource with the highest priority will receive
the message. If the registered user is not connected, the message will be
stored offline in assumption that offline storage
(see section&#XA0;<a href="#modoffline">3.3.12</a>) is enabled.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">example.org/announce/online (example.org/announce/all-hosts/online)</span></span></dt><dd class="dd-description">The
message is sent to all connected users. If the user is online and connected
to several resources, all resources will receive the message.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">example.org/announce/motd (example.org/announce/all-hosts/motd)</span></span></dt><dd class="dd-description">The
message is set as the message of the day (MOTD) and is sent to users when they
login. In addition the message is sent to all connected users (similar to
<span style="font-family:monospace">announce/online</span>).
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">example.org/announce/motd/update (example.org/announce/all-hosts/motd/update)</span></span></dt><dd class="dd-description">
The message is set as message of the day (MOTD) and is sent to users when they
login. The message is <em>not sent</em> to any currently connected user.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">example.org/announce/motd/delete (example.org/announce/all-hosts/motd/delete)</span></span></dt><dd class="dd-description">
Any message sent to this JID removes the existing message of the day (MOTD).
</dd></dl><p>Options:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">db_type: internal|odbc</span></span></dt><dd class="dd-description"> 
Define the type of storage where the module will create the tables and store user information.
The default is to store in the internal Mnesia database.
If <span style="font-family:monospace">odbc</span> value is defined, make sure you have defined the database, see&#XA0;<a href="#database">3.2</a>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">access: AccessName</span></span></dt><dd class="dd-description"> This option specifies who is allowed to
send announcements and to set the message of the day (by default, nobody is
able to send such messages).
</dd></dl><p>Examples:
</p><ul class="itemize"><li class="li-itemize">
Only administrators can send announcements:
<pre class="verbatim">access:
  announce:
    admin: allow

modules:
  ...
  mod_adhoc: {}
  mod_announce:
    access: announce
  ...
</pre></li><li class="li-itemize">Administrators as well as the direction can send announcements:
<pre class="verbatim">acl:
  direction:
    user:
      "big_boss": "example.org"
      "assistant": "example.org"
  admin:
    user:
      "admin": "example.org"
access:
  announce:
    admin: allow
    direction: allow

modules:
  ...
  mod_adhoc: {}
  mod_announce:
    access: announce
  ...
</pre></li></ul><p>Note that <span style="font-family:monospace">mod_announce</span> can be resource intensive on large
deployments as it can broadcast lot of messages. This module should be
disabled for instances of <span style="font-family:monospace">ejabberd</span> with hundreds of thousands users.</p><p> <a id="moddisco"></a> </p>
<!--TOC subsection id="sec64" <span style="font-family:monospace">mod_disco</span>-->
<h3 id="sec64" class="subsection">3.3.4&#XA0;&#XA0;<a href="#moddisco"><span style="font-family:monospace">mod_disco</span></a></h3><!--SEC END --><p> <a id="moddisco"></a> 




</p><p>This module adds support for Service Discovery (<a href="http://xmpp.org/extensions/xep-0030.html">XEP-0030</a>). With
this module enabled, services on your server can be discovered by
XMPP clients. Note that <span style="font-family:monospace">ejabberd</span> has no modules with support
for the superseded Jabber Browsing (<a href="http://xmpp.org/extensions/xep-0011.html">XEP-0011</a>) and Agent Information
(<a href="http://xmpp.org/extensions/xep-0094.html">XEP-0094</a>). Accordingly, XMPP clients need to have support for
the newer Service Discovery protocol if you want them be able to discover
the services you offer.</p><p>Options:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">iqdisc: Discipline</span></span></dt><dd class="dd-description"> This specifies
the processing discipline for Service Discovery (<span style="font-family:monospace">http://jabber.org/protocol/disco#items</span> and
<span style="font-family:monospace">http://jabber.org/protocol/disco#info</span>) IQ queries (see section&#XA0;<a href="#modiqdiscoption">3.3.2</a>).
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">extra_domains: [Domain, ...]</span></span></dt><dd class="dd-description"> With this option,
you can specify a list of extra domains that are added to the Service Discovery item list.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">server_info: [ { modules: Modules, name: Name, urls: [URL, ...] } ]</span></span></dt><dd class="dd-description"> 
Specify additional information about the server,
as described in Contact Addresses for XMPP Services (<a href="http://xmpp.org/extensions/xep-0157.html">XEP-0157</a>).
<span style="font-family:monospace">Modules</span> can be the keyword &#X2018;all&#X2019;, 
in which case the information is reported in all the services;
or a list of <span style="font-family:monospace">ejabberd</span> modules, 
in which case the information is only specified for the services provided by those modules.
Any arbitrary <span style="font-family:monospace">Name</span> and <span style="font-family:monospace">URL</span> can be specified, not only contact addresses.
</dd></dl><p>Examples:
</p><ul class="itemize"><li class="li-itemize">
To serve a link to the Jabber User Directory on <span style="font-family:monospace">jabber.org</span>:
<pre class="verbatim">modules:
  ...
  mod_disco:
    extra_domains: ["users.jabber.org"]
  ...
</pre></li><li class="li-itemize">To serve a link to the transports on another server:
<pre class="verbatim">modules:
  ...
  mod_disco:
    extra_domains:
      - "icq.example.com"
      - "msn.example.com"
  ...
</pre></li><li class="li-itemize">To serve a link to a few friendly servers:
<pre class="verbatim">modules:
  ...
  mod_disco:
    extra_domains:
      - "example.org"
      - "example.com"
  ...
</pre></li><li class="li-itemize">With this configuration, all services show abuse addresses,
feedback address on the main server,
and admin addresses for both the main server and the vJUD service:
<pre class="verbatim">modules:
  ...
  mod_disco:
    server_info:
      - 
        modules: all
        name: "abuse-addresses"
        urls: ["mailto:abuse@shakespeare.lit"]
      - 
        modules: [mod_muc]
        name: "Web chatroom logs"
        urls: ["http://www.example.org/muc-logs"]
      - 
        modules: [mod_disco]
        name: "feedback-addresses"
        urls:
          - "http://shakespeare.lit/feedback.php"
          - "mailto:feedback@shakespeare.lit"
          - "xmpp:feedback@shakespeare.lit"
      - 
        modules:
          - mod_disco
          - mod_vcard
        name: "admin-addresses"
        urls:
          - "mailto:xmpp@shakespeare.lit"
          - "xmpp:admins@shakespeare.lit"
  ...
</pre></li></ul><p> <a id="modecho"></a> </p>
<!--TOC subsection id="sec65" <span style="font-family:monospace">mod_echo</span>-->
<h3 id="sec65" class="subsection">3.3.5&#XA0;&#XA0;<a href="#modecho"><span style="font-family:monospace">mod_echo</span></a></h3><!--SEC END --><p> <a id="modecho"></a> 
</p><p>This module simply echoes any XMPP
packet back to the sender. This mirror can be of interest for
<span style="font-family:monospace">ejabberd</span> and XMPP client debugging.</p><p>Options:
</p><dl class="description"><dt class="dt-description">

<span style="font-weight:bold"><span style="font-family:monospace">host: HostName</span></span></dt><dd class="dd-description">  This option defines the Jabber ID of the
service. If the <span style="font-family:monospace">host</span> option is not specified, the Jabber ID will be the
hostname of the virtual host with the prefix &#X2018;<span style="font-family:monospace">echo.</span>&#X2019;. The keyword "@HOST@"
is replaced at start time with the real virtual host name.

</dd></dl><p>Example: Mirror, mirror, on the wall, who is the most beautiful
of them all?
</p><pre class="verbatim">modules:
  ...
  mod_echo:
    host: "mirror.example.org"
  ...
</pre><p> <a id="modhttpbind"></a> </p>
<!--TOC subsection id="sec66" <span style="font-family:monospace">mod_http_bind</span>-->
<h3 id="sec66" class="subsection">3.3.6&#XA0;&#XA0;<a href="#modhttpbind"><span style="font-family:monospace">mod_http_bind</span></a></h3><!--SEC END --><p> <a id="modhttpbind"></a> 
</p><p>This module implements XMPP over Bosh (formerly known as HTTP Binding)
as defined in <a href="http://xmpp.org/extensions/xep-0124.html">XEP-0124</a> and <a href="http://xmpp.org/extensions/xep-0206.html">XEP-0206</a>.
It extends ejabberd&#X2019;s built in HTTP service with a configurable
resource at which this service will be hosted.</p><p>To use HTTP-Binding, enable the module:
</p><pre class="verbatim">modules:
  ...
  mod_http_bind: {}
  ...
</pre><p>and add <code>http_bind</code> in the HTTP service. For example:
</p><pre class="verbatim">listen:
  ...
  - 
    port: 5280
    module: ejabberd_http
    http_bind: true
    http_poll: true
    web_admin: true
  ...
</pre><p>With this configuration, the module will serve the requests sent to 
<code>http://example.org:5280/http-bind/</code>
Remember that this page is not designed to be used by web browsers,
it is used by XMPP clients that support XMPP over Bosh.</p><p>If you want to set the service in a different URI path or use a different module, 
you can configure it manually using the option <code>request_handlers</code>. 
For example:
</p><pre class="verbatim">listen:
  ...
  - 
    port: 5280
    module: ejabberd_http
    request_handlers:
       "/http-bind": mod_http_bind
    http_poll: true
    web_admin: true
  ...
</pre><p>Options:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">{max_inactivity, Seconds}</span></span></dt><dd class="dd-description"> 
Define the maximum inactivity period in seconds.
Default value is 30 seconds.
For example, to set 50 seconds:
<pre class="verbatim">modules:
  ...
  mod_http_bind:
    max_inactivity: 50
  ...
</pre></dd></dl><p> <a id="modhttpfileserver"></a> </p>
<!--TOC subsection id="sec67" <span style="font-family:monospace">mod_http_fileserver</span>-->
<h3 id="sec67" class="subsection">3.3.7&#XA0;&#XA0;<a href="#modhttpfileserver"><span style="font-family:monospace">mod_http_fileserver</span></a></h3><!--SEC END --><p> <a id="modhttpfileserver"></a> 
</p><p>This simple module serves files from the local disk over HTTP.</p><p>Options:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">docroot: Path</span></span></dt><dd class="dd-description"> 
Directory to serve the files.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">accesslog: Path</span></span></dt><dd class="dd-description"> 
File to log accesses using an Apache-like format.
No log will be recorded if this option is not specified.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">directory_indices: [Index, ...]</span></span></dt><dd class="dd-description"> 
Indicate one or more directory index files, similarly to Apache&#X2019;s
DirectoryIndex variable. When a web request hits a directory
instead of a regular file, those directory indices are looked in
order, and the first one found is returned.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">custom_headers: {Name: Value}</span></span></dt><dd class="dd-description"> 
Indicate custom HTTP headers to be included in all responses.
Default value is: <span style="font-family:monospace">[]</span>
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">content_types: {Name: Type}</span></span></dt><dd class="dd-description"> 
Specify mappings of extension to content type.
There are several content types already defined,
with this option you can add new definitions, modify or delete existing ones.
To delete an existing definition, simply define it with a value: &#X2018;undefined&#X2019;.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">default_content_type: Type</span></span></dt><dd class="dd-description"> 
Specify the content type to use for unknown extensions.
Default value is &#X2018;application/octet-stream&#X2019;.
</dd></dl><p>This example configuration will serve the files from 
the local directory <code>/var/www</code>
in the address <code>http://example.org:5280/pub/archive/</code>.
In this example a new content type <span style="font-family:monospace">ogg</span> is defined,
<span style="font-family:monospace">png</span> is redefined, and <span style="font-family:monospace">jpg</span> definition is deleted.
To use this module you must enable it:
</p><pre class="verbatim">modules:
  ...
  mod_http_fileserver:
    docroot: "/var/www"
    accesslog: "/var/log/ejabberd/access.log"
    directory_indices:
      - "index.html"
      - "main.htm"
    custom_headers:
      "X-Powered-By": "Erlang/OTP"
      "X-Fry": "It's a widely-believed fact!"
    content_types:
      ".ogg": "audio/ogg"
      ".png": "image/png"
      ".jpg": undefined
    default_content_type: "text/html"
  ...
</pre><p>And define it as a handler in the HTTP service:
</p><pre class="verbatim">listen:
  ...
  - 
    port: 5280
    module: ejabberd_http
    request_handlers:
      ...
      "/pub/archive": mod_http_fileserver
      ...
  ...
</pre><p> <a id="modirc"></a> </p>
<!--TOC subsection id="sec68" <span style="font-family:monospace">mod_irc</span>-->
<h3 id="sec68" class="subsection">3.3.8&#XA0;&#XA0;<a href="#modirc"><span style="font-family:monospace">mod_irc</span></a></h3><!--SEC END --><p> <a id="modirc"></a> 
</p><p>This module is an IRC transport that can be used to join channels on IRC
servers.</p><p>End user information:

</p><ul class="itemize"><li class="li-itemize">
A XMPP client with &#X2018;groupchat 1.0&#X2019; support or Multi-User
Chat support (<a href="http://xmpp.org/extensions/xep-0045.html">XEP-0045</a>) is necessary to join IRC channels.
</li><li class="li-itemize">An IRC channel can be joined in nearly the same way as joining a
XMPP Multi-User Chat room. The difference is that the room name will
be &#X2018;channel%<span style="font-family:monospace">irc.example.org</span>&#X2019; in case <span style="font-family:monospace">irc.example.org</span> is
the IRC server hosting &#X2018;channel&#X2019;. And of course the host should point
to the IRC transport instead of the Multi-User Chat service.
</li><li class="li-itemize">You can register your nickame by sending &#X2018;IDENTIFY password&#X2019; to <br>
 <span style="font-family:monospace">nickserver!irc.example.org@irc.jabberserver.org</span>.
</li><li class="li-itemize">Entering your password is possible by sending &#X2018;LOGIN nick password&#X2019; <br>
 to <span style="font-family:monospace">nickserver!irc.example.org@irc.jabberserver.org</span>.
</li><li class="li-itemize">The IRC transport provides Ad-Hoc Commands (<a href="http://xmpp.org/extensions/xep-0050.html">XEP-0050</a>)
to join a channel, and to set custom IRC username and encoding.
</li><li class="li-itemize">When using a popular XMPP server, it can occur that no
connection can be achieved with some IRC servers because they limit the
number of connections from one IP.
</li></ul><p>Options:
</p><dl class="description"><dt class="dt-description">

<span style="font-weight:bold"><span style="font-family:monospace">host: HostName</span></span></dt><dd class="dd-description">  This option defines the Jabber ID of the
service. If the <span style="font-family:monospace">host</span> option is not specified, the Jabber ID will be the
hostname of the virtual host with the prefix &#X2018;<span style="font-family:monospace">irc.</span>&#X2019;. The keyword "@HOST@"
is replaced at start time with the real virtual host name.

</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">db_type: internal|odbc</span></span></dt><dd class="dd-description"> 
Define the type of storage where the module will create the tables and store user information.
The default is to store in the internal Mnesia database.
If <span style="font-family:monospace">odbc</span> value is defined, make sure you have defined the database, see&#XA0;<a href="#database">3.2</a>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">access: AccessName</span></span></dt><dd class="dd-description"> This option can be used to specify who
may use the IRC transport (default value: <span style="font-family:monospace">all</span>).
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">default_encoding: Encoding</span></span></dt><dd class="dd-description"> Set the default IRC encoding.
Default value: <span style="font-family:monospace">"iso8859-1"</span>
</dd></dl><p>Examples:
</p><ul class="itemize"><li class="li-itemize">
In the first example, the IRC transport is available on (all) your
virtual host(s) with the prefix &#X2018;<span style="font-family:monospace">irc.</span>&#X2019;. Furthermore, anyone is
able to use the transport. The default encoding is set to "iso8859-15".
<pre class="verbatim">modules:
  ...
  mod_irc:
    access: all
    default_encoding: "iso8859-15"
  ...
</pre></li><li class="li-itemize">In next example the IRC transport is available with JIDs with prefix <span style="font-family:monospace">irc-t.net</span>.
Moreover, the transport is only accessible to two users 
of <span style="font-family:monospace">example.org</span>, and any user of <span style="font-family:monospace">example.com</span>:
<pre class="verbatim">acl:
  paying_customers:
    user:
      - "customer1": "example.org"
      - "customer2": "example.org"
    server: "example.com"

access:
  irc_users:
    paying_customers: allow
    all: deny

modules:
  ...
  mod_irc:
    access: irc_users
    host: "irc.example.net"
  ...
</pre></li></ul><p> <a id="modlast"></a> </p>
<!--TOC subsection id="sec69" <span style="font-family:monospace">mod_last</span>-->
<h3 id="sec69" class="subsection">3.3.9&#XA0;&#XA0;<a href="#modlast"><span style="font-family:monospace">mod_last</span></a></h3><!--SEC END --><p> <a id="modlast"></a> 
</p><p>This module adds support for Last Activity (<a href="http://xmpp.org/extensions/xep-0012.html">XEP-0012</a>). It can be used to
discover when a disconnected user last accessed the server, to know when a
connected user was last active on the server, or to query the uptime of the
<span style="font-family:monospace">ejabberd</span> server.</p><p>Options:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">iqdisc: Discipline</span></span></dt><dd class="dd-description"> This specifies
the processing discipline for Last activity (<span style="font-family:monospace">jabber:iq:last</span>) IQ queries (see section&#XA0;<a href="#modiqdiscoption">3.3.2</a>).
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">db_type: internal|odbc</span></span></dt><dd class="dd-description"> 
Define the type of storage where the module will create the tables and store user information.
The default is to store in the internal Mnesia database.
If <span style="font-family:monospace">odbc</span> value is defined, make sure you have defined the database, see&#XA0;<a href="#database">3.2</a>.
</dd></dl><p> <a id="modmuc"></a> </p>
<!--TOC subsection id="sec70" <span style="font-family:monospace">mod_muc</span>-->
<h3 id="sec70" class="subsection">3.3.10&#XA0;&#XA0;<a href="#modmuc"><span style="font-family:monospace">mod_muc</span></a></h3><!--SEC END --><p> <a id="modmuc"></a> 
</p><p>This module provides a Multi-User Chat (<a href="http://xmpp.org/extensions/xep-0045.html">XEP-0045</a>) service.
Users can discover existing rooms, join or create them.
Occupants of a room can chat in public or have private chats.</p><p>Some of the features of Multi-User Chat:
</p><ul class="itemize"><li class="li-itemize">
Sending public and private messages to room occupants.
</li><li class="li-itemize">Inviting other users to a room.
</li><li class="li-itemize">Setting a room subject.
</li><li class="li-itemize">Creating password protected rooms.
</li><li class="li-itemize">Kicking and banning occupants.
</li></ul><p>The MUC service allows any Jabber ID to register a nickname,
so nobody else can use that nickname in any room in the MUC service.
To register a nickname, open the Service Discovery in your
XMPP client and register in the MUC service.</p><p>This module supports clustering and load
balancing. One module can be started per cluster node. Rooms are
distributed at creation time on all available MUC module
instances. The multi-user chat module is clustered but the rooms
themselves are not clustered nor fault-tolerant: if the node managing a
set of rooms goes down, the rooms disappear and they will be recreated
on an available node on first connection attempt.</p><p>Module options:
</p><dl class="description"><dt class="dt-description">

<span style="font-weight:bold"><span style="font-family:monospace">host: HostName</span></span></dt><dd class="dd-description">  This option defines the Jabber ID of the
service. If the <span style="font-family:monospace">host</span> option is not specified, the Jabber ID will be the
hostname of the virtual host with the prefix &#X2018;<span style="font-family:monospace">conference.</span>&#X2019;. The keyword "@HOST@"
is replaced at start time with the real virtual host name.

</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">db_type: internal|odbc</span></span></dt><dd class="dd-description"> 
Define the type of storage where the module will create the tables and store user information.
The default is to store in the internal Mnesia database.
If <span style="font-family:monospace">odbc</span> value is defined, make sure you have defined the database, see&#XA0;<a href="#database">3.2</a>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">access: AccessName</span></span></dt><dd class="dd-description"> You can specify who is allowed to use
the Multi-User Chat service. By default everyone is allowed to use it.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">access_create: AccessName</span></span></dt><dd class="dd-description"> To configure who is
allowed to create new rooms at the Multi-User Chat service, this option can be used.
By default any account in the local ejabberd server is allowed to create rooms.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">access_persistent: AccessName</span></span></dt><dd class="dd-description"> To configure who is
allowed to modify the &#X2019;persistent&#X2019; room option.
By default any account in the local ejabberd server is allowed to modify that option.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">access_admin: AccessName</span></span></dt><dd class="dd-description"> This option specifies
who is allowed to administrate the Multi-User Chat service. The default
value is <span style="font-family:monospace">none</span>, which means that only the room creator can
administer his room.
The administrators can send a normal message to the service JID,
and it will be shown in all active rooms as a service message.
The administrators can send a groupchat message to the JID of an active room,
and the message will be shown in the room as a service message.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">history_size: Size</span></span></dt><dd class="dd-description"> A small history of
the current discussion is sent to users when they enter the
room. With this option you can define the number of history messages
to keep and send to users joining the room. The value is an
integer. Setting the value to <span style="font-family:monospace">0</span> disables the history feature
and, as a result, nothing is kept in memory. The default value is
<span style="font-family:monospace">20</span>. This value is global and thus affects all rooms on the
service.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">max_users: Number</span></span></dt><dd class="dd-description">  This option defines at
the service level, the maximum number of users allowed per
room. It can be lowered in each room configuration but cannot be
increased in individual room configuration. The default value is
200.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">max_users_admin_threshold: Number</span></span></dt><dd class="dd-description">
 This option defines the
number of service admins or room owners allowed to enter the room when
the maximum number of allowed occupants was reached. The default limit
is 5.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">max_user_conferences: Number</span></span></dt><dd class="dd-description">
 This option defines the maximum
number of rooms that any given user can join. The default value
is 10. This option is used to prevent possible abuses. Note that
this is a soft limit: some users can sometimes join more conferences
in cluster configurations.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">max_room_id: Number</span></span></dt><dd class="dd-description"> 
This option defines the maximum number of characters that Room ID
can have when creating a new room.
The default value is to not limit: infinite.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">max_room_name: Number</span></span></dt><dd class="dd-description"> 
This option defines the maximum number of characters that Room Name
can have when configuring the room.
The default value is to not limit: infinite.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">max_room_desc: Number</span></span></dt><dd class="dd-description"> 
This option defines the maximum number of characters that Room Description
can have when configuring the room.
The default value is to not limit: infinite.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">min_message_interval: Number</span></span></dt><dd class="dd-description"> 
This option defines the minimum interval between two messages send
by an occupant in seconds. This option is global and valid for all
rooms. A decimal value can be used. When this option is not defined,
message rate is not limited. This feature can be used to protect a
MUC service from occupant abuses and limit number of messages that will
be broadcasted by the service. A good value for this minimum message
interval is 0.4 second. If an occupant tries to send messages faster, an
error is send back explaining that the message has been discarded
and describing the reason why the message is not acceptable.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">min_presence_interval: Number</span></span></dt><dd class="dd-description">
 This option defines the
minimum of time between presence changes coming from a given occupant in
seconds. This option is global and valid for all rooms. A
decimal value can be used. When this option is not defined, no
restriction is applied. This option can be used to protect a MUC
service for occupants abuses. If an occupant tries
to change its presence more often than the specified interval, the
presence is cached by <span style="font-family:monospace">ejabberd</span> and only the last presence is
broadcasted to all occupants in the room after expiration of the
interval delay. Intermediate presence packets are silently
discarded. A good value for this option is 4 seconds.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">default_room_options: {OptionName: OptionValue}</span></span></dt><dd class="dd-description"> 
This module option allows to define the desired default room options.
Note that the creator of a room can modify the options of his room
at any time using an XMPP client with MUC capability.
The available room options and the default values are:
<dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">allow_change_subj: true|false</span></span></dt><dd class="dd-description"> Allow occupants to change the subject.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">allow_private_messages: true|false</span></span></dt><dd class="dd-description"> Occupants can send private messages to other occupants.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">allow_private_messages_from_visitors: anyone|moderators|nobody</span></span></dt><dd class="dd-description"> Visitors can send private messages to other occupants.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">allow_query_users: true|false</span></span></dt><dd class="dd-description"> Occupants can send IQ queries to other occupants.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">allow_user_invites: false|true</span></span></dt><dd class="dd-description"> Allow occupants to send invitations.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">allow_visitor_nickchange: true|false</span></span></dt><dd class="dd-description"> Allow visitors to
change nickname.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">allow_visitor_status: true|false</span></span></dt><dd class="dd-description"> Allow visitors to send
status text in presence updates. If disallowed, the <span style="font-family:monospace">status</span>
text is stripped before broadcasting the presence update to all
the room occupants.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">anonymous: true|false</span></span></dt><dd class="dd-description"> The room is anonymous:
occupants don&#X2019;t see the real JIDs of other occupants.
Note that the room moderators can always see the real JIDs of the occupants.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">captcha_protected: false</span></span></dt><dd class="dd-description"> 
When a user tries to join a room where he has no affiliation (not owner, admin or member),
the room requires him to fill a CAPTCHA challenge (see section <a href="#captcha">3.1.9</a>)
in order to accept her join in the room.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">logging: false|true</span></span></dt><dd class="dd-description"> The public messages are logged using <span style="font-family:monospace">mod_muc_log</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">max_users: 200</span></span></dt><dd class="dd-description"> Maximum number of occupants in the room.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">members_by_default: true|false</span></span></dt><dd class="dd-description"> The occupants that enter the room are participants by default, so they have &#X2019;voice&#X2019;.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">members_only: false|true</span></span></dt><dd class="dd-description"> Only members of the room can enter.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">moderated: true|false</span></span></dt><dd class="dd-description"> Only occupants with &#X2019;voice&#X2019; can send public messages.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">password: "roompass123"</span></span></dt><dd class="dd-description"> Password of the room. You may want to enable the next option too.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">password_protected: false|true</span></span></dt><dd class="dd-description"> The password is required to enter the room.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">persistent: false|true</span></span></dt><dd class="dd-description"> The room persists even if the last participant leaves.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">public: true|false</span></span></dt><dd class="dd-description"> The room is public in the list of the MUC service, so it can be discovered.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">public_list: true|false</span></span></dt><dd class="dd-description"> The list of participants is public, without requiring to enter the room.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">title: "Room Title"</span></span></dt><dd class="dd-description"> A human-readable title of the room.
</dd></dl>
All of those room options can be set to <span style="font-family:monospace">true</span> or <span style="font-family:monospace">false</span>,
except <span style="font-family:monospace">password</span> and <span style="font-family:monospace">title</span> which are strings,
and <span style="font-family:monospace">max_users</span> that is integer.
</dd></dl><p>Examples:
</p><ul class="itemize"><li class="li-itemize">
In the first example everyone is allowed to use the Multi-User Chat
service. Everyone will also be able to create new rooms but only the user
<span style="font-family:monospace">admin@example.org</span> is allowed to administrate any room. In this
example he is also a global administrator. When <span style="font-family:monospace">admin@example.org</span>
sends a message such as &#X2018;Tomorrow, the XMPP server will be moved
to new hardware. This will involve service breakdowns around 23:00 UMT.
We apologise for this inconvenience.&#X2019; to <span style="font-family:monospace">conference.example.org</span>,
it will be displayed in all active rooms. In this example the history
feature is disabled.
<pre class="verbatim">acl:
  admin:
    user:
      - "admin": "example.org"

access:
  muc_admin:
    admin: allow

modules:
  ...
  mod_muc:
    access: all
    access_create: all
    access_admin: muc_admin
    history_size: 0
  ...
</pre></li><li class="li-itemize">In the second example the Multi-User Chat service is only accessible by
paying customers registered on our domains and on other servers. Of course
the administrator is also allowed to access rooms. In addition, he is the
only authority able to create and administer rooms. When
<span style="font-family:monospace">admin@example.org</span> sends a message such as &#X2018;Tomorrow, the Jabber
server will be moved to new hardware. This will involve service breakdowns
around 23:00 UMT. We apologise for this inconvenience.&#X2019; to
<span style="font-family:monospace">conference.example.org</span>, it will be displayed in all active rooms. No
<span style="font-family:monospace">history_size</span> option is used, this means that the feature is enabled
and the default value of 20 history messages will be send to the users.
<pre class="verbatim">acl:
  paying_customers:
    user:
      - "customer1": "example.net"
      - "customer2": "example.com"
      - "customer3": "example.org"
  admin:
    user:
      - "admin": "example.org"

access:
  muc_admin
    admin: allow
    all: deny
  muc_access:
    paying_customers: allow
    admin: allow
    all: deny

modules:
  ...
  mod_muc:
    access: muc_access
    access_create: muc_admin
    access_admin: muc_admin
  ...
</pre></li><li class="li-itemize">In the following example, MUC anti abuse options are used. An
occupant cannot send more than one message every 0.4 seconds and cannot
change its presence more than once every 4 seconds.
The length of Room IDs and Room Names are limited to 20 characters,
and Room Description to 300 characters. No ACLs are
defined, but some user restriction could be added as well:<pre class="verbatim">modules:
  ...
  mod_muc:
    min_message_interval: 0.4
    min_presence_interval: 4
    max_room_id: 20
    max_room_name: 20
    max_room_desc: 300
  ...
</pre></li><li class="li-itemize">This example shows how to use <span style="font-family:monospace">default_room_options</span> to make sure
the newly created rooms have by default those options.
<pre class="verbatim">modules:
  ...
  mod_muc:
    access: muc_access
    access_create: muc_admin
    default_room_options:
      allow_change_subj: false
      allow_query_users: true
      allow_private_messages: true
      members_by_default: false
      title: "New chatroom"
      anonymous: false
    access_admin: muc_admin
  ...
</pre></li></ul><p> <a id="modmuclog"></a> </p>
<!--TOC subsection id="sec71" <span style="font-family:monospace">mod_muc_log</span>-->
<h3 id="sec71" class="subsection">3.3.11&#XA0;&#XA0;<a href="#modmuclog"><span style="font-family:monospace">mod_muc_log</span></a></h3><!--SEC END --><p> <a id="modmuclog"></a> 
</p><p>This module enables optional logging of Multi-User Chat (MUC) public conversations to
HTML. Once you enable this module, users can join a room using a MUC capable
XMPP client, and if they have enough privileges, they can request the
configuration form in which they can set the option to enable room logging.</p><p>Features:
</p><ul class="itemize"><li class="li-itemize">
Room details are added on top of each page: room title, JID,
author, subject and configuration.
</li><li class="li-itemize">
The room JID in the generated HTML is a link to join the room (using
<a href="http://xmpp.org/rfcs/rfc5122.html">XMPP URI</a>).
</li><li class="li-itemize">Subject and room configuration changes are tracked and displayed.
</li><li class="li-itemize">Joins, leaves, nick changes, kicks, bans and &#X2018;/me&#X2019; are tracked and
displayed, including the reason if available.
</li><li class="li-itemize">Generated HTML files are XHTML 1.0 Transitional and CSS compliant.
</li><li class="li-itemize">Timestamps are self-referencing links.
</li><li class="li-itemize">Links on top for quicker navigation: Previous day, Next day, Up.
</li><li class="li-itemize">CSS is used for style definition, and a custom CSS file can be used.
</li><li class="li-itemize">URLs on messages and subjects are converted to hyperlinks.
</li><li class="li-itemize">Timezone used on timestamps is shown on the log files.
</li><li class="li-itemize">A custom link can be added on top of each page.
</li></ul><p>Options:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">access_log: AccessName</span></span></dt><dd class="dd-description">
This option restricts which occupants are allowed to enable or disable room
logging. The default value is <span style="font-family:monospace">muc_admin</span>. Note for this default setting
you need to have an access rule for <span style="font-family:monospace">muc_admin</span> in order to take effect.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">cssfile: false|URL</span></span></dt><dd class="dd-description">
With this option you can set whether the HTML files should have a custom CSS
file or if they need to use the embedded CSS file. Allowed values are
<span style="font-family:monospace">false</span> and an URL to a CSS file. With the first value, HTML files will
include the embedded CSS code. With the latter, you can specify the URL of the
custom CSS file (for example: <span style="font-family:monospace">"http://example.com/my.css"</span>). The default value
is <span style="font-family:monospace">false</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">dirname: room_jid|room_name</span></span></dt><dd class="dd-description">
Allows to configure the name of the room directory.
Allowed values are <span style="font-family:monospace">room_jid</span> and <span style="font-family:monospace">room_name</span>.
With the first value, the room directory name will be the full room JID.
With the latter, the room directory name will be only the room name,
not including the MUC service name.
The default value is <span style="font-family:monospace">room_jid</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">dirtype: subdirs|plain</span></span></dt><dd class="dd-description">
The type of the created directories can be specified with this option. Allowed
values are <span style="font-family:monospace">subdirs</span> and <span style="font-family:monospace">plain</span>. With the first value,
subdirectories are created for each year and month. With the latter, the
names of the log files contain the full date, and there are no subdirectories.
The default value is <span style="font-family:monospace">subdirs</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">file_format: html|plaintext</span></span></dt><dd class="dd-description">
Define the format of the log files:
<span style="font-family:monospace">html</span> stores in HTML format,
<span style="font-family:monospace">plaintext</span> stores in plain text.
The default value is <span style="font-family:monospace">html</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">file_permissions: {mode: Mode, group: Group}</span></span></dt><dd class="dd-description">
Define the permissions that must be used when creating the log files:
the number of the mode, and the numeric id of the group that will own the files.
The default value is <span style="font-family:monospace">{644, 33}</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">outdir: Path</span></span></dt><dd class="dd-description">
This option sets the full path to the directory in which the HTML files should
be stored. Make sure the <span style="font-family:monospace">ejabberd</span> daemon user has write access on that
directory. The default value is <span style="font-family:monospace">"www/muc"</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">spam_prevention: true|false</span></span></dt><dd class="dd-description">
To prevent spam, the <span style="font-family:monospace">spam_prevention</span> option adds a special attribute
to links that prevent their indexation by search engines. The default value
is <span style="font-family:monospace">true</span>, which mean that nofollow attributes will be added to user
submitted links.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">timezone: local|universal</span></span></dt><dd class="dd-description">
The time zone for the logs is configurable with this option. Allowed values
are <span style="font-family:monospace">local</span> and <span style="font-family:monospace">universal</span>. With the first value, the local time,
as reported to Erlang by the operating system, will be used. With the latter,
GMT/UTC time will be used. The default value is <span style="font-family:monospace">local</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">top_link: {URL: Text}</span></span></dt><dd class="dd-description">
With this option you can customize the link on the top right corner of each
log file. The default value is <span style="font-family:monospace">{"/", "Home"}</span>.
</dd></dl><p>Examples:
</p><ul class="itemize"><li class="li-itemize">
In the first example any room owner can enable logging, and a
custom CSS file will be used (http://example.com/my.css). The names
of the log files will contain the full date, and there will be no
subdirectories. The log files will be stored in /var/www/muclogs, and the
time zone will be GMT/UTC. Finally, the top link will be
<code>&lt;a href="http://www.jabber.ru/"&gt;Jabber.ru&lt;/a&gt;</code>.
<pre class="verbatim">access: 
  muc: 
    all: allow

modules: 
  ...
  mod_muc_log: 
    access_log: muc
    cssfile: "http://example.com/my.css"
    dirtype: plain
    dirname: room_jid
    outdir: "/var/www/muclogs"
    timezone: universal
    spam_prevention: true
    top_link: 
      "http://www.jabber.ru/": "Jabber.ru"
  ...
</pre></li><li class="li-itemize">In the second example only <span style="font-family:monospace">admin1@example.org</span> and
<span style="font-family:monospace">admin2@example.net</span> can enable logging, and the embedded CSS file will be
used. The names of the log files will only contain the day (number),
and there will be subdirectories for each year and month. The log files will
be stored in /var/www/muclogs, and the local time will be used. Finally, the
top link will be the default <code>&lt;a href="/"&gt;Home&lt;/a&gt;</code>.
<pre class="verbatim">acl: 
  admin: 
    user: 
      - "admin1": "example.org"
      - "admin2": "example.net"
access: 
  muc_log: 
    admin: allow
    all: deny

modules: 
  ...
  mod_muc_log: 
    access_log: muc_log
    cssfile: false
    dirtype: subdirs
    file_permissions:
      mode: 644
      group: 33
    outdir: "/var/www/muclogs"
    timezone: local
  ...
</pre></li></ul><p> <a id="modoffline"></a> </p>
<!--TOC subsection id="sec72" <span style="font-family:monospace">mod_offline</span>-->
<h3 id="sec72" class="subsection">3.3.12&#XA0;&#XA0;<a href="#modoffline"><span style="font-family:monospace">mod_offline</span></a></h3><!--SEC END --><p> <a id="modoffline"></a> 
</p><p>This module implements offline message storage (<a href="http://xmpp.org/extensions/xep-0160.html">XEP-0160</a>).
This means that all messages
sent to an offline user will be stored on the server until that user comes
online again. Thus it is very similar to how email works. Note that
<span style="font-family:monospace">ejabberdctl</span> has a command to delete expired messages
(see section&#XA0;<a href="#ejabberdctl">4.1</a>).</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">db_type: internal|odbc</span></span></dt><dd class="dd-description"> 
Define the type of storage where the module will create the tables and store user information.
The default is to store in the internal Mnesia database.
If <span style="font-family:monospace">odbc</span> value is defined, make sure you have defined the database, see&#XA0;<a href="#database">3.2</a>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">access_max_user_messages: AccessName</span></span></dt><dd class="dd-description">
This option defines which access rule will be enforced to limit
the maximum number of offline messages that a user can have (quota).
When a user has too many offline messages, any new messages that he receive are discarded,
and a resource-constraint error is returned to the sender.
The default value is <span style="font-family:monospace">max_user_offline_messages</span>.
Then you can define an access rule with a syntax similar to 
<span style="font-family:monospace">max_user_sessions</span> (see <a href="#configmaxsessions">3.1.6</a>).
</dd></dl><p>This example allows power users to have as much as 5000 offline messages,
administrators up to 2000,
and all the other users up to 100.
</p><pre class="verbatim">acl: 
  admin: 
    user: 
      - "admin1": "localhost"
      - "admin2": "example.org"
  poweruser: 
    user: 
      - "bob": "example.org"
      - "jane": "example.org"

access: 
  max_user_offline_messages: 
    poweruser: 5000
    admin: 2000
    all: 100

modules: 
  ...
  mod_offline: 
    access_max_user_messages: max_user_offline_messages
  ...
</pre><p> <a id="modping"></a> </p>
<!--TOC subsection id="sec73" <span style="font-family:monospace">mod_ping</span>-->
<h3 id="sec73" class="subsection">3.3.13&#XA0;&#XA0;<a href="#modping"><span style="font-family:monospace">mod_ping</span></a></h3><!--SEC END --><p> <a id="modping"></a> 
</p><p>This module implements support for XMPP Ping (<a href="http://xmpp.org/extensions/xep-0199.html">XEP-0199</a>) and periodic keepalives.
When this module is enabled ejabberd responds correctly to
ping requests, as defined in the protocol.</p><p>Configuration options:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">send_pings: true|false</span></span></dt><dd class="dd-description">
If this option is set to <span style="font-family:monospace">true</span>, the server sends pings to connected clients
that are not active in a given interval <span style="font-family:monospace">ping_interval</span>.
This is useful to keep client connections alive or checking availability.
By default this option is disabled.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ping_interval: Seconds</span></span></dt><dd class="dd-description">
How often to send pings to connected clients, if the previous option is enabled.
If a client connection does not send or receive any stanza in this interval,
a ping request is sent to the client.
The default value is 60 seconds.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">timeout_action: none|kill</span></span></dt><dd class="dd-description">
What to do when a client does not answer to a server ping request in less than 32 seconds.
The default is to do nothing.
</dd></dl><p>This example enables Ping responses, configures the module to send pings
to client connections that are inactive for 4 minutes,
and if a client does not answer to the ping in less than 32 seconds, its connection is closed:
</p><pre class="verbatim">modules:
  ...
  mod_ping:
    send_pings: true
    ping_interval: 240
    timeout_action: kill
  ...
</pre><p> <a id="modprescounter"></a> </p>
<!--TOC subsection id="sec74" <span style="font-family:monospace">mod_pres_counter</span>-->
<h3 id="sec74" class="subsection">3.3.14&#XA0;&#XA0;<a href="#modprescounter"><span style="font-family:monospace">mod_pres_counter</span></a></h3><!--SEC END --><p> <a id="modprescounter"></a> 
</p><p>This module detects flood/spam in presence subscription stanza traffic.
If a user sends or receives more of those stanzas in a time interval,
the exceeding stanzas are silently dropped, and warning is logged.</p><p>Configuration options:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">count: StanzaNumber</span></span></dt><dd class="dd-description">
The number of subscription presence stanzas
(subscribe, unsubscribe, subscribed, unsubscribed)
allowed for any direction (input or output)
per time interval.
Please note that two users subscribing to each other usually generate
4 stanzas, so the recommended value is 4 or more.
The default value is: 5.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">interval: Seconds</span></span></dt><dd class="dd-description">
The time interval defined in seconds.
The default value is 60.
</dd></dl><p>This example enables the module, and allows up to 5 presence subscription stanzas
to be sent or received by the users in 60 seconds:
</p><pre class="verbatim">modules:
  ...
  mod_pres_counter:
    count: 5
    interval: 60
  ...
</pre><p> <a id="modprivacy"></a> </p>
<!--TOC subsection id="sec75" <span style="font-family:monospace">mod_privacy</span>-->
<h3 id="sec75" class="subsection">3.3.15&#XA0;&#XA0;<a href="#modprivacy"><span style="font-family:monospace">mod_privacy</span></a></h3><!--SEC END --><p> <a id="modprivacy"></a> 
</p><p>This module implements Blocking Communication (also known as Privacy Rules)
as defined in section 10 from XMPP IM. If end users have support for it in
their XMPP client, they will be able to:
</p><blockquote class="quote">
<ul class="itemize"><li class="li-itemize">
Retrieving one&#X2019;s privacy lists.
</li><li class="li-itemize">Adding, removing, and editing one&#X2019;s privacy lists.
</li><li class="li-itemize">Setting, changing, or declining active lists.
</li><li class="li-itemize">Setting, changing, or declining the default list (i.e., the list that
is active by default).
</li><li class="li-itemize">Allowing or blocking messages based on JID, group, or subscription type
(or globally).
</li><li class="li-itemize">Allowing or blocking inbound presence notifications based on JID, group,
or subscription type (or globally).
</li><li class="li-itemize">Allowing or blocking outbound presence notifications based on JID, group,
or subscription type (or globally).
</li><li class="li-itemize">Allowing or blocking IQ stanzas based on JID, group, or subscription type
(or globally).
</li><li class="li-itemize">Allowing or blocking all communications based on JID, group, or
subscription type (or globally).
</li></ul>
(from <a href="http://xmpp.org/rfcs/rfc3921.html#privacy"><span style="font-family:monospace">http://xmpp.org/rfcs/rfc3921.html#privacy</span></a>)
</blockquote><p>Options:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">iqdisc: Discipline</span></span></dt><dd class="dd-description"> This specifies
the processing discipline for Blocking Communication (<span style="font-family:monospace">jabber:iq:privacy</span>) IQ queries (see section&#XA0;<a href="#modiqdiscoption">3.3.2</a>).
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">db_type: internal|odbc</span></span></dt><dd class="dd-description"> 
Define the type of storage where the module will create the tables and store user information.
The default is to store in the internal Mnesia database.
If <span style="font-family:monospace">odbc</span> value is defined, make sure you have defined the database, see&#XA0;<a href="#database">3.2</a>.
</dd></dl><p> <a id="modprivate"></a> </p>
<!--TOC subsection id="sec76" <span style="font-family:monospace">mod_private</span>-->
<h3 id="sec76" class="subsection">3.3.16&#XA0;&#XA0;<a href="#modprivate"><span style="font-family:monospace">mod_private</span></a></h3><!--SEC END --><p> <a id="modprivate"></a> 
</p><p>This module adds support for Private XML Storage (<a href="http://xmpp.org/extensions/xep-0049.html">XEP-0049</a>):
</p><blockquote class="quote">
Using this method, XMPP entities can store private data on the server and
retrieve it whenever necessary. The data stored might be anything, as long as
it is valid XML. One typical usage for this namespace is the server-side storage
of client-specific preferences; another is Bookmark Storage (<a href="http://xmpp.org/extensions/xep-0048.html">XEP-0048</a>).
</blockquote><p>Options:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">iqdisc: Discipline</span></span></dt><dd class="dd-description"> This specifies
the processing discipline for Private XML Storage (<span style="font-family:monospace">jabber:iq:private</span>) IQ queries (see section&#XA0;<a href="#modiqdiscoption">3.3.2</a>).
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">db_type: internal|odbc</span></span></dt><dd class="dd-description"> 
Define the type of storage where the module will create the tables and store user information.
The default is to store in the internal Mnesia database.
If <span style="font-family:monospace">odbc</span> value is defined, make sure you have defined the database, see&#XA0;<a href="#database">3.2</a>.
</dd></dl><p> <a id="modproxy"></a> </p>
<!--TOC subsection id="sec77" <span style="font-family:monospace">mod_proxy65</span>-->
<h3 id="sec77" class="subsection">3.3.17&#XA0;&#XA0;<a href="#modproxy"><span style="font-family:monospace">mod_proxy65</span></a></h3><!--SEC END --><p> <a id="modproxy"></a> 
</p><p>This module implements SOCKS5 Bytestreams (<a href="http://xmpp.org/extensions/xep-0065.html">XEP-0065</a>).
It allows <span style="font-family:monospace">ejabberd</span> to act as a file transfer proxy between two
XMPP clients.</p><p>Options:
</p><dl class="description"><dt class="dt-description">

<span style="font-weight:bold"><span style="font-family:monospace">host: HostName</span></span></dt><dd class="dd-description">  This option defines the Jabber ID of the
service. If the <span style="font-family:monospace">host</span> option is not specified, the Jabber ID will be the
hostname of the virtual host with the prefix &#X2018;<span style="font-family:monospace">proxy.</span>&#X2019;. The keyword "@HOST@"
is replaced at start time with the real virtual host name.

</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">name: Text</span></span></dt><dd class="dd-description">Defines Service Discovery name of the service.
Default is <span style="font-family:monospace">"SOCKS5 Bytestreams"</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ip: IP</span></span></dt><dd class="dd-description">This option specifies which network interface
to listen for. Default is an IP address of the service&#X2019;s DNS name, or,
if fails, <code>"127.0.0.1"</code>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">port: Number</span></span></dt><dd class="dd-description">This option defines port to listen for
incoming connections. Default is&#XA0;7777.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">hostname: HostName</span></span></dt><dd class="dd-description">Defines a hostname advertised
by the service when establishing a session with clients. This is useful when
you run the service behind a NAT. The default is the value of <span style="font-family:monospace">ip</span> option.
Examples: <span style="font-family:monospace">"proxy.mydomain.org"</span>, <span style="font-family:monospace">"200.150.100.50"</span>. Note that 
not all clients understand domain names in stream negotiation,
so you should think twice before setting domain name in this option.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">auth_type: anonymous|plain</span></span></dt><dd class="dd-description">SOCKS5 authentication type.
Possible values are <span style="font-family:monospace">anonymous</span> and <span style="font-family:monospace">plain</span>. Default is
<span style="font-family:monospace">anonymous</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">access: AccessName</span></span></dt><dd class="dd-description">Defines ACL for file transfer initiators.
Default is <span style="font-family:monospace">all</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">max_connections: Number</span></span></dt><dd class="dd-description">Maximum number of
active connections per file transfer initiator. No limit by default.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">shaper: none|ShaperName</span></span></dt><dd class="dd-description">This option defines shaper for
the file transfer peers. Shaper with the maximum bandwidth will be selected.
Default is <span style="font-family:monospace">none</span>.
</dd></dl><p>Examples:
</p><ul class="itemize"><li class="li-itemize">
The simpliest configuration of the module:
<pre class="verbatim">modules:
  ...
  mod_proxy65: {}
  ...
</pre></li><li class="li-itemize">More complicated configuration.
<pre class="verbatim">acl: 
  admin: 
    user: 
      - "admin": "example.org"
  proxy_users: 
    server: 
      - "example.org"

access: 
  proxy65_access: 
    proxy_users: allow
    all: deny
  proxy65_shaper: 
    admin: none
    proxy_users: proxyrate

shaper: 
  proxyrate: 10240

modules: 
  ...
  mod_proxy65: 
    host: "proxy1.example.org"
    name: "File Transfer Proxy"
    ip: "200.150.100.1"
    port: 7778
    max_connections: 5
    access: proxy65_access
    shaper: proxy65_shaper
  ...
</pre></li></ul><p> <a id="modpubsub"></a> </p>
<!--TOC subsection id="sec78" <span style="font-family:monospace">mod_pubsub</span>-->
<h3 id="sec78" class="subsection">3.3.18&#XA0;&#XA0;<a href="#modpubsub"><span style="font-family:monospace">mod_pubsub</span></a></h3><!--SEC END --><p> <a id="modpubsub"></a> 
</p><p>This module offers a Publish-Subscribe Service (<a href="http://xmpp.org/extensions/xep-0060.html">XEP-0060</a>).
The functionality in <span style="font-family:monospace">mod_pubsub</span> can be extended using plugins.
The plugin that implements PEP (Personal Eventing via Pubsub) (<a href="http://xmpp.org/extensions/xep-0163.html">XEP-0163</a>)
is enabled in the default ejabberd configuration file,
and it requires <span style="font-family:monospace">mod_caps</span>.</p><p>Options:
</p><dl class="description"><dt class="dt-description">

<span style="font-weight:bold"><span style="font-family:monospace">host: HostName</span></span></dt><dd class="dd-description">  This option defines the Jabber ID of the
service. If the <span style="font-family:monospace">host</span> option is not specified, the Jabber ID will be the
hostname of the virtual host with the prefix &#X2018;<span style="font-family:monospace">pubsub.</span>&#X2019;. The keyword "@HOST@"
is replaced at start time with the real virtual host name.

If you use <span style="font-family:monospace">mod_pubsub_odbc</span>, please ensure the prefix contains only one dot,
for example &#X2018;<span style="font-family:monospace">pubsub.</span>&#X2019;, or &#X2018;<span style="font-family:monospace">publish.</span>&#X2019;,.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">access_createnode: AccessName</span></span></dt><dd class="dd-description"> 
This option restricts which users are allowed to create pubsub nodes using
ACL and ACCESS.
By default any account in the local ejabberd server is allowed to create pubsub nodes.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">max_items_node: MaxItems</span></span></dt><dd class="dd-description"> 
Define the maximum number of items that can be stored in a node.
Default value is 10.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">plugins: [ Plugin, ...]</span></span></dt><dd class="dd-description"> 
To specify which pubsub node plugins to use.
The first one in the list is used by default.
If this option is not defined, the default plugins list is: <span style="font-family:monospace">["flat"]</span>.
PubSub clients can define which plugin to use when creating a node:
add <span style="font-family:monospace">type=&#X2019;plugin-name&#X2019;</span> attribute to the <span style="font-family:monospace">create</span> stanza element.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">nodetree: Nodetree</span></span></dt><dd class="dd-description"> 
To specify which nodetree to use.
If not defined, the default pubsub nodetree is used: "tree".
Only one nodetree can be used per host, and is shared by all node plugins.<p>The "virtual" nodetree does not store nodes on database.
This saves resources on systems with tons of nodes.
If using the "virtual" nodetree,
you can only enable those node plugins:
["flat","pep"] or ["flat"];
any other plugins configuration will not work. 
Also, all nodes will have the defaut configuration,
and this can not be changed.
Using "virtual" nodetree requires to start from a clean database,
it will not work if you used the default "tree" nodetree before.</p><p>The "dag" nodetree provides experimental support for PubSub Collection Nodes (<a href="http://xmpp.org/extensions/xep-0248.html">XEP-0248</a>).
In that case you should also add "dag" node plugin as default, for example:
<span style="font-family:monospace">plugins: ["dag","flat","hometree","pep"]</span>
</p></dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ignore_pep_from_offline: false|true</span></span></dt><dd class="dd-description"> 
To specify whether or not we should get last published PEP items
from users in our roster which are offline when we connect. Value is true or false.
If not defined, pubsub assumes true so we only get last items of online contacts.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">last_item_cache: false|true</span></span></dt><dd class="dd-description"> 
To specify whether or not pubsub should cache last items. Value is true
or false. If not defined, pubsub do not cache last items. On systems with not so many nodes,
caching last items speeds up pubsub and allows to raise user connection rate. The cost is memory
usage, as every item is stored in memory.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">pep_mapping: {Key, Value}</span></span></dt><dd class="dd-description"> 
This allow to define a Key-Value list to choose defined node plugins on given PEP namespace.
The following example will use node_tune instead of node_pep for every PEP node with tune namespace:
<pre class="verbatim">modules:
  ...
  mod_pubsub:
    pep_mapping:
      "http://jabber.org/protocol/tune": "tune"
  ...
</pre></dd></dl><p>Example of configuration that uses flat nodes as default, and allows use of flat, nodetree and pep nodes:
</p><pre class="verbatim">modules:
  ...
  mod_pubsub:
    access_createnode: pubsub_createnode
    plugins:
      - "flat"
      - "hometree"
      - "pep"
  ...
</pre><p>Using ODBC database requires using mod_pubsub_odbc without option changes. Only flat, hometree and pep plugins supports ODBC.
The following example shows previous configuration with ODBC usage:
</p><pre class="verbatim">modules:
  ...
  mod_pubsub_odbc:
    access_createnode: pubsub_createnode
    plugins:
      - "flat"
      - "hometree"
      - "pep"
  ...
</pre><p> <a id="modregister"></a> </p>
<!--TOC subsection id="sec79" <span style="font-family:monospace">mod_register</span>-->
<h3 id="sec79" class="subsection">3.3.19&#XA0;&#XA0;<a href="#modregister"><span style="font-family:monospace">mod_register</span></a></h3><!--SEC END --><p> <a id="modregister"></a> 
</p><p>This module adds support for In-Band Registration (<a href="http://xmpp.org/extensions/xep-0077.html">XEP-0077</a>). This protocol
enables end users to use a XMPP client to:
</p><ul class="itemize"><li class="li-itemize">
Register a new account on the server.
</li><li class="li-itemize">Change the password from an existing account on the server.
</li><li class="li-itemize">Delete an existing account on the server.
</li></ul><p>Options:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">access: AccessName</span></span></dt><dd class="dd-description"> 
Specify rules to restrict what usernames can be registered and unregistered.
If a rule returns &#X2018;deny&#X2019; on the requested username,
registration and unregistration of that user name is denied.
There are no restrictions by default.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">access_from: AccessName</span></span></dt><dd class="dd-description"> By default, <span style="font-family:monospace">ejabberd</span>
doesn&#X2019;t allow to register new accounts from s2s or existing c2s sessions. You can
change it by defining access rule in this option. Use with care: allowing registration
from s2s leads to uncontrolled massive accounts creation by rogue users.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">captcha_protected: false|true</span></span></dt><dd class="dd-description"> 
Protect registrations with CAPTCHA (see section <a href="#captcha">3.1.9</a>). The default is <span style="font-family:monospace">false</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ip_access: AccessName</span></span></dt><dd class="dd-description"> 
Define rules to allow or deny account registration depending
on the IP address of the XMPP client. The <span style="font-family:monospace">AccessName</span> should be
of type <span style="font-family:monospace">ip</span>. The default value is <span style="font-family:monospace">all</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">password_strength: Entropy</span></span></dt><dd class="dd-description"> 
This option sets the minimum informational entropy for passwords. The value <span style="font-family:monospace">Entropy</span>
is a number of bits of entropy. The recommended minimum is 32 bits.
The default is 0, i.e. no checks are performed.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">welcome_message: {subject: Subject, body: Body}</span></span></dt><dd class="dd-description">
 Set a welcome message that
is sent to each newly registered account. The first string is the subject, and
the second string is the message body.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">registration_watchers: [ JID, ...]</span></span></dt><dd class="dd-description"> This option defines a
list of JIDs which will be notified each time a new account is registered.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">iqdisc: Discipline</span></span></dt><dd class="dd-description"> This specifies
the processing discipline for In-Band Registration (<span style="font-family:monospace">jabber:iq:register</span>) IQ queries (see section&#XA0;<a href="#modiqdiscoption">3.3.2</a>).
</dd></dl><p>This module reads also another option defined globally for the server:
<span style="font-family:monospace">registration_timeout: Timeout</span>. 
This option limits the frequency of registration from a given IP or username.
So, a user that tries to register a new account from the same IP address or JID during
this number of seconds after his previous registration
will receive an error <span style="font-family:monospace">resource-constraint</span> with the explanation:
&#X201C;Users are not allowed to register accounts so quickly&#X201D;.
The timeout is expressed in seconds, and it must be an integer.
To disable this limitation,
instead of an integer put a word like: <span style="font-family:monospace">infinity</span>.
Default value: 600 seconds.</p><p>Examples:
</p><ul class="itemize"><li class="li-itemize">
Next example prohibits the registration of too short account names,
and allows to create accounts only to clients of the local network:
<pre class="verbatim">acl: 
  loopback:
    ip:
      - "127.0.0.0/8"
      - "::"
  shortname: 
    user_glob: 
      - "?"
      - "??"
    ## The same using regexp:
    ##user_regexp: "^..?$"

access: 
  mynetworks: 
    loopback: allow
    all: deny
  register: 
    shortname: deny
    all: allow

modules: 
  mod_register: 
    ip_access: mynetworks
    access: register
</pre></li><li class="li-itemize">This configuration prohibits usage of In-Band Registration
to create or delete accounts,
but allows existing accounts to change the password:
<pre class="verbatim">access:
  register:
    all: deny

modules:
  ...
  mod_register:
    access: register
  ...
</pre></li><li class="li-itemize">This configuration disables all In-Band Registration
functionality: create, delete accounts and change password:
<pre class="verbatim">modules:
  ...
  ## mod_register:
  ##   access: register
  ...
</pre></li><li class="li-itemize">Define the welcome message and two registration watchers.
Also define a registration timeout of one hour:
<pre class="verbatim">registration_timeout: 3600
modules:
  ...
  mod_register:
    welcome_message:
      subject: "Welcome!"
      body: |-
        Hi.
        Welcome to this Jabber server.
        Check http://www.jabber.org
        
        Bye
    registration_watchers:
      - "admin1@example.org"
      - "boss@example.net"
  ...
</pre></li></ul><p> <a id="modregisterweb"></a> </p>
<!--TOC subsection id="sec80" <span style="font-family:monospace">mod_register_web</span>-->
<h3 id="sec80" class="subsection">3.3.20&#XA0;&#XA0;<a href="#modregisterweb"><span style="font-family:monospace">mod_register_web</span></a></h3><!--SEC END --><p> <a id="modregisterweb"></a> 
</p><p>This module provides a web page where people can:
</p><ul class="itemize"><li class="li-itemize">
Register a new account on the server.
</li><li class="li-itemize">Change the password from an existing account on the server.
</li><li class="li-itemize">Delete an existing account on the server.
</li></ul><p>This module supports CAPTCHA image to register a new account.
To enable this feature, configure the options captcha_cmd and captcha_host.</p><p>Options:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">registration_watchers: [ JID, ...]</span></span></dt><dd class="dd-description"> This option defines a
list of JIDs which will be notified each time a new account is registered.
</dd></dl><p>This example configuration shows how to enable the module and the web handler:
</p><pre class="verbatim">hosts: 
  - "localhost"
  - "example.org"
  - "example.com"
listen: 
  ...
  - 
    port: 5281
    module: ejabberd_http
    register: true
    certfile: "/etc/ejabberd/certificate.pem"
    tls: true
  ...

modules: 
  ...
  mod_register_web: {}
  ...
</pre><p>For example, the users of the host <span style="font-family:monospace">example.org</span> can visit the page:
<span style="font-family:monospace">https://example.org:5281/register/</span>
It is important to include the last / character in the URL,
otherwise the subpages URL will be incorrect.</p><p> <a id="modroster"></a> </p>
<!--TOC subsection id="sec81" <span style="font-family:monospace">mod_roster</span>-->
<h3 id="sec81" class="subsection">3.3.21&#XA0;&#XA0;<a href="#modroster"><span style="font-family:monospace">mod_roster</span></a></h3><!--SEC END --><p> <a id="modroster"></a> 
</p><p>This module implements roster management as defined in
<a href="http://xmpp.org/rfcs/rfc3921.html#roster">RFC 3921: XMPP IM</a>.
It also supports Roster Versioning (<a href="http://xmpp.org/extensions/xep-0237.html">XEP-0237</a>).</p><p>Options:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">iqdisc: Discipline</span></span></dt><dd class="dd-description"> This specifies
the processing discipline for Roster Management (<span style="font-family:monospace">jabber:iq:roster</span>) IQ queries (see section&#XA0;<a href="#modiqdiscoption">3.3.2</a>).
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">db_type: internal|odbc</span></span></dt><dd class="dd-description"> 
Define the type of storage where the module will create the tables and store user information.
The default is to store in the internal Mnesia database.
If <span style="font-family:monospace">odbc</span> value is defined, make sure you have defined the database, see&#XA0;<a href="#database">3.2</a>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">versioning: false|true</span></span></dt><dd class="dd-description"> Enables
Roster Versioning.
This option is disabled by default.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">store_current_id: false|true</span></span></dt><dd class="dd-description"> 
If this option is enabled, the current version number is stored on the database.
If disabled, the version number is calculated on the fly each time.
Enabling this option reduces the load for both ejabberd and the database.
This option does not affect the client in any way.
This option is only useful if Roster Versioning is enabled.
This option is disabled by default.
Important: if you use <span style="font-family:monospace">mod_shared_roster</span> or <span style="font-family:monospace">mod_shared_roster_ldap</span>,
you must disable this option.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">access</span></span></dt><dd class="dd-description"> 
This option can be configured to specify rules to restrict roster management.
If a rule returns &#X2018;deny&#X2019; on the requested user name,
that user cannot modify his personal roster:
not add/remove/modify contacts,
or subscribe/unsubscribe presence.
By default there aren&#X2019;t restrictions.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">managers</span></span></dt><dd class="dd-description"> 
List of remote entities that can manage users rosters using Remote Roster Management
(<a href="http://xmpp.org/extensions/xep-0321.html">XEP-0321</a>).
The protocol sections implemented are:
<span style="font-family:monospace">4.2. The remote entity requests current user&#X2019;s roster</span>.
<span style="font-family:monospace">4.3. The user updates roster</span>.
<span style="font-family:monospace">4.4. The remote entity updates the user&#X2019;s roster</span>.
A remote entity cab only get or modify roster items that have the same domain as the entity.
Default value is: <span style="font-family:monospace">[]</span>.
</dd></dl><p>This example configuration enables Roster Versioning with storage of current id.
The ICQ and MSN transports can get ICQ and MSN contacts, add them, or remove them for any local account:
</p><pre class="verbatim">modules:
  ...
  mod_roster:
    versioning: true
    store_current_id: true
    managers:
     - "icq.example.org"
     - "msn.example.org"
  ...
</pre><p>With this example configuration, only admins can manage their rosters;
everybody else cannot modify the roster:
</p><pre class="verbatim">acl:
  admin:
    user:
      - "sarah": "example.org"
access:
  roster:
    admin: allow

modules:
  ...
  mod_roster:
    access: roster
  ...
</pre><p> <a id="modservicelog"></a> </p>
<!--TOC subsection id="sec82" <span style="font-family:monospace">mod_service_log</span>-->
<h3 id="sec82" class="subsection">3.3.22&#XA0;&#XA0;<a href="#modservicelog"><span style="font-family:monospace">mod_service_log</span></a></h3><!--SEC END --><p> <a id="modservicelog"></a> 
</p><p>This module adds support for logging end user packets via a XMPP message
auditing service such as
<a href="http://www.funkypenguin.info/project/bandersnatch/">Bandersnatch</a>. All user
packets are encapsulated in a <code>&lt;route/&gt;</code> element and sent to the specified
service(s).</p><p>Options:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">loggers: [Names, ...]</span></span></dt><dd class="dd-description"> With this option a (list of) service(s)
that will receive the packets can be specified.
</dd></dl><p>Examples:
</p><ul class="itemize"><li class="li-itemize">
To log all end user packets to the Bandersnatch service running on
<span style="font-family:monospace">bandersnatch.example.com</span>:
<pre class="verbatim">modules:
  ...
  mod_service_log:
    loggers: ["bandersnatch.example.com"]
  ...
</pre></li><li class="li-itemize">To log all end user packets to the Bandersnatch service running on
<span style="font-family:monospace">bandersnatch.example.com</span> and the backup service on
<span style="font-family:monospace">bandersnatch.example.org</span>:
<pre class="verbatim">modules:
  ...
  mod_service_log:
    loggers:
      - "bandersnatch.example.com"
      - "bandersnatch.example.org"
  ...
</pre></li></ul><p> <a id="modsharedroster"></a> </p>
<!--TOC subsection id="sec83" <span style="font-family:monospace">mod_shared_roster</span>-->
<h3 id="sec83" class="subsection">3.3.23&#XA0;&#XA0;<a href="#modsharedroster"><span style="font-family:monospace">mod_shared_roster</span></a></h3><!--SEC END --><p> <a id="modsharedroster"></a> 
</p><p>This module enables you to create shared roster groups. This means that you can
create groups of people that can see members from (other) groups in their
rosters. The big advantages of this feature are that end users do not need to
manually add all users to their rosters, and that they cannot permanently delete
users from the shared roster groups.
A shared roster group can have members from any XMPP server,
but the presence will only be available from and to members
of the same virtual host where the group is created.</p><p>Options:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">db_type: internal|odbc</span></span></dt><dd class="dd-description"> 
Define the type of storage where the module will create the tables and store user information.
The default is to store in the internal Mnesia database.
If <span style="font-family:monospace">odbc</span> value is defined, make sure you have defined the database, see&#XA0;<a href="#database">3.2</a>.
</dd></dl><p>Shared roster groups can be edited <em>only</em> via the Web Admin. Each group
has a unique identification and the following parameters:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold">Name</span></dt><dd class="dd-description"> The name of the group, which will be displayed in the roster.
</dd><dt class="dt-description"><span style="font-weight:bold">Description</span></dt><dd class="dd-description"> The description of the group. This parameter does not affect
anything.
</dd><dt class="dt-description"><span style="font-weight:bold">Members</span></dt><dd class="dd-description"> A list of JIDs of group members, entered one per line in
the Web Admin.
The special member directive <span style="font-family:monospace">@all@</span>
represents all the registered users in the virtual host;
which is only recommended for a small server with just a few hundred users.
The special member directive <span style="font-family:monospace">@online@</span>
represents the online users in the virtual host.
</dd><dt class="dt-description"><span style="font-weight:bold">Displayed groups</span></dt><dd class="dd-description">
A list of groups that will be in the rosters of this group&#X2019;s members.
A group of other vhost can be identified with <span style="font-family:monospace">groupid@vhost</span>
</dd></dl><p>Examples:
</p><ul class="itemize"><li class="li-itemize">
Take the case of a computer club that wants all its members seeing each
other in their rosters. To achieve this, they need to create a shared roster
group similar to next table:
<blockquote class="table"><div class="center"><div class="center"><hr style="width:80%;height:2"></div>
<table border=1  style="border-spacing:0;" class="cellpadding1"><tr><td style="text-align:left;border:solid 1px;white-space:nowrap" >Identification</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Group &#X2018;<span style="font-family:monospace">club_members</span>&#X2019;</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" >Name</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Club Members</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" >Description</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Members from the computer club</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" >Members</td><td style="text-align:left;border:solid 1px;white-space:nowrap" > <table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" > <span style="font-family:monospace">member1@example.org</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" > <span style="font-family:monospace">member2@example.org</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" > <span style="font-family:monospace">member3@example.org</span>
</td></tr>
</table>
</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" >Displayed groups</td><td style="text-align:left;border:solid 1px;white-space:nowrap" ><span style="font-family:monospace">club_members</span></td></tr>
</table>
<div class="center"><hr style="width:80%;height:2"></div></div></blockquote>
</li><li class="li-itemize">In another case we have a company which has three divisions: Management,
Marketing and Sales. All group members should see all other members in their
rosters. Additionally, all managers should have all marketing and sales people
in their roster. Simultaneously, all marketeers and the whole sales team
should see all managers. This scenario can be achieved by creating shared
roster groups as shown in the following table:
<blockquote class="table"><div class="center"><div class="center"><hr style="width:80%;height:2"></div>
<table border=1  style="border-spacing:0;" class="cellpadding1"><tr><td style="text-align:left;border:solid 1px;white-space:nowrap" >Identification</td><td style="text-align:left;border:solid 1px;white-space:nowrap" > Group &#X2018;<span style="font-family:monospace">management</span>&#X2019;</td><td style="text-align:left;border:solid 1px;white-space:nowrap" > Group &#X2018;<span style="font-family:monospace">marketing</span>&#X2019;</td><td style="text-align:left;border:solid 1px;white-space:nowrap" > Group &#X2018;<span style="font-family:monospace">sales</span>&#X2019;</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" >Name</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Management</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Marketing</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Sales</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" >Description</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >&nbsp;</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" > Members</td><td style="text-align:left;border:solid 1px;white-space:nowrap" > <table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" > <span style="font-family:monospace">manager1@example.org</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" > <span style="font-family:monospace">manager2@example.org</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" > <span style="font-family:monospace">manager3@example.org</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" > <span style="font-family:monospace">manager4@example.org</span>
</td></tr>
</table>
</td><td style="text-align:left;border:solid 1px;white-space:nowrap" > <table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" > <span style="font-family:monospace">marketeer1@example.org</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" > <span style="font-family:monospace">marketeer2@example.org</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" > <span style="font-family:monospace">marketeer3@example.org</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" > <span style="font-family:monospace">marketeer4@example.org</span>
</td></tr>
</table>
</td><td style="text-align:left;border:solid 1px;white-space:nowrap" > <table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" > <span style="font-family:monospace">saleswoman1@example.org</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" > <span style="font-family:monospace">salesman1@example.org</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" > <span style="font-family:monospace">saleswoman2@example.org</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" > <span style="font-family:monospace">salesman2@example.org</span>
</td></tr>
</table>
</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" >Displayed groups</td><td style="text-align:left;border:solid 1px;white-space:nowrap" > <table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" > <span style="font-family:monospace">management</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" > <span style="font-family:monospace">marketing</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" > <span style="font-family:monospace">sales</span>
</td></tr>
</table>
</td><td style="text-align:left;border:solid 1px;white-space:nowrap" > <table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" > <span style="font-family:monospace">management</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" > <span style="font-family:monospace">marketing</span>
</td></tr>
</table>
</td><td style="text-align:left;border:solid 1px;white-space:nowrap" > <table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="text-align:left;white-space:nowrap" > <span style="font-family:monospace">management</span></td></tr>
<tr><td style="text-align:left;white-space:nowrap" > <span style="font-family:monospace">sales</span>
</td></tr>
</table>
</td></tr>
</table>
<div class="center"><hr style="width:80%;height:2"></div></div></blockquote>
</li></ul><p> <a id="modsharedrosterldap"></a> </p>
<!--TOC subsection id="sec84" <span style="font-family:monospace">mod_shared_roster_ldap</span>-->
<h3 id="sec84" class="subsection">3.3.24&#XA0;&#XA0;<a href="#modsharedrosterldap"><span style="font-family:monospace">mod_shared_roster_ldap</span></a></h3><!--SEC END --><p> <a id="modsharedrosterldap"></a> 
</p><p>This module lets the server administrator
automatically populate users&#X2019; rosters (contact lists) with entries based on
users and groups defined in an LDAP-based directory.</p><p> <a id="msrlconfigparams"></a> </p>
<!--TOC subsubsection id="sec85" Configuration parameters-->
<h4 id="sec85" class="subsubsection"><a href="#msrlconfigparams">Configuration parameters</a></h4><!--SEC END --><p> <a id="msrlconfigparams"></a> </p><p>The module accepts the following configuration parameters. Some of them, if
unspecified, default to the values specified for the top level of
configuration. This lets you avoid specifying, for example, the bind password,
in multiple places.</p><p> <a id="msrlfilters"></a> </p>
<!--TOC paragraph id="sec86" Filters-->
<h5 id="sec86" class="paragraph"><a href="#msrlfilters">Filters</a></h5><!--SEC END --><p> <a id="msrlfilters"></a> </p><p>These parameters specify LDAP filters used to query for shared roster information.
All of them are run against the <code>ldap_base</code>.</p><dl class="description"><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ldap_rfilter</span></span></dt><dd class="dd-description">
So called &#X201C;Roster Filter&#X201D;. Used to find names of all &#X201C;shared roster&#X201D; groups.
See also the <code>ldap_groupattr</code> parameter.
If unspecified, defaults to the top-level parameter of the same name.
You <em>must</em> specify it in some place in the configuration, there is no default.</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ldap_ufilter</span></span></dt><dd class="dd-description">
&#X201C;User Filter&#X201D; &#X2013; used for retrieving the human-readable name of roster
entries (usually full names of people in the roster).
See also the parameters <code>ldap_userdesc</code> and <code>ldap_useruid</code>.
If unspecified, defaults to the top-level parameter of the same name.
If that one also is unspecified, then the filter is assembled from values of
other parameters as follows (<code>[ldap_SOMETHING]</code> is used to mean &#X201C;the
value of the configuration parameter <span style="font-family:monospace">ldap_SOMETHING</span>&#X201D;):<pre class="verbatim">(&amp;(&amp;([ldap_memberattr]=[ldap_memberattr_format])([ldap_groupattr]=%g))[ldap_filter])
</pre><p>Subsequently <span style="font-family:monospace">%u</span> and <span style="font-family:monospace">%g</span> are replaced with a <span style="font-family:monospace">*</span>. This means
that given the defaults, the filter sent to the LDAP server is would be
<code>(&amp;(memberUid=*)(cn=*))</code>. If however the <span style="font-family:monospace">ldap_memberattr_format</span>
is something like <code>uid=%u,ou=People,o=org</code>, then the filter will be
<code>(&amp;(memberUid=uid=*,ou=People,o=org)(cn=*))</code>.</p></dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ldap_gfilter</span></span></dt><dd class="dd-description">
&#X201C;Group Filter&#X201D; &#X2013; used when retrieving human-readable name (a.k.a.
&#X201C;Display Name&#X201D;) and the members of a group.
See also the parameters <code>ldap_groupattr</code>, <code>ldap_groupdesc</code> and <code>ldap_memberattr</code>.
If unspecified, defaults to the top-level parameter of the same name.
If that one also is unspecified, then the filter is constructed exactly in the
same way as <span style="font-family:monospace">User Filter</span>.</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ldap_filter</span></span></dt><dd class="dd-description">
Additional filter which is AND-ed together with <span style="font-family:monospace">User Filter</span> and <span style="font-family:monospace">Group Filter</span>.
If unspecified, defaults to the top-level parameter of the same name. If that
one is also unspecified, then no additional filter is merged with the other
filters.
</dd></dl><p>Note that you will probably need to manually define the <span style="font-family:monospace">User</span> and <span style="font-family:monospace">Group Filter</span>s (since the auto-assembled ones will not work) if:
</p><ul class="itemize"><li class="li-itemize">
your <span style="font-family:monospace">ldap_memberattr_format</span> is anything other than a simple <span style="font-family:monospace">%u</span>,
</li><li class="li-itemize"><span style="font-weight:bold">and</span> the attribute specified with <span style="font-family:monospace">ldap_memberattr</span> does not support substring matches.
</li></ul><p>
An example where it is the case is OpenLDAP and <span style="font-family:monospace">(unique)MemberName</span> attribute from the <span style="font-family:monospace">groupOf(Unique)Names</span> objectClass.
A symptom of this problem is that you will see messages such as the following in your <span style="font-family:monospace">slapd.log</span>:
</p><pre class="verbatim">get_filter: unknown filter type=130
filter="(&amp;(?=undefined)(?=undefined)(something=else))"
</pre><p> <a id="msrlattrs"></a> </p>
<!--TOC subsubsection id="sec87" Attributes-->
<h4 id="sec87" class="subsubsection"><a href="#msrlattrs">Attributes</a></h4><!--SEC END --><p> <a id="msrlattrs"></a> </p><p>These parameters specify the names of the attributes which hold interesting data
in the entries returned by running filters specified in
section&#XA0;<a href="#msrlfilters">3.3.24</a>.</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">ldap_groupattr</span></span></dt><dd class="dd-description">
The name of the attribute that holds the group name, and that is used to differentiate between them.
Retrieved from results of the &#X201C;Roster Filter&#X201D; and &#X201C;Group Filter&#X201D;.
Defaults to <span style="font-family:monospace">cn</span>.</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ldap_groupdesc</span></span></dt><dd class="dd-description">
The name of the attribute which holds the human-readable group name in the
objects you use to represent groups.
Retrieved from results of the &#X201C;Group Filter&#X201D;.
Defaults to whatever <span style="font-family:monospace">ldap_groupattr</span> is set.</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ldap_memberattr</span></span></dt><dd class="dd-description">
The name of the attribute which holds the IDs of the members of a group.
Retrieved from results of the &#X201C;Group Filter&#X201D;.
Defaults to <span style="font-family:monospace">memberUid</span>.<p>The name of the attribute differs depending on the <span style="font-family:monospace">objectClass</span> you use
for your group objects, for example:
</p><dl class="description"><dt class="dt-description">
</dt><dd class="dd-description"><span style="font-family:monospace">posixGroup</span> &#X2192; <span style="font-family:monospace">memberUid</span>
</dd><dt class="dt-description"></dt><dd class="dd-description"><span style="font-family:monospace">groupOfNames</span> &#X2192; <span style="font-family:monospace">member</span>
</dd><dt class="dt-description"></dt><dd class="dd-description"><span style="font-family:monospace">groupOfUniqueNames</span> &#X2192; <span style="font-family:monospace">uniqueMember</span>
</dd></dl></dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ldap_userdesc</span></span></dt><dd class="dd-description">
The name of the attribute which holds the human-readable user name.
Retrieved from results of the &#X201C;User Filter&#X201D;.
Defaults to <span style="font-family:monospace">cn</span>.</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ldap_useruid</span></span></dt><dd class="dd-description">
The name of the attribute which holds the ID of a roster item. Value of this
attribute in the roster item objects needs to match the ID retrieved from the
<span style="font-family:monospace">ldap_memberattr</span> attribute of a group object.
Retrieved from results of the &#X201C;User Filter&#X201D;.
Defaults to <span style="font-family:monospace">cn</span>.
</dd></dl><p> <a id="msrlcontrolparams"></a> </p>
<!--TOC subsubsection id="sec88" Control parameters-->
<h4 id="sec88" class="subsubsection"><a href="#msrlcontrolparams">Control parameters</a></h4><!--SEC END --><p> <a id="msrlcontrolparams"></a> </p><p>These paramters control the behaviour of the module.</p><dl class="description"><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ldap_memberattr_format</span></span></dt><dd class="dd-description">
A globbing format for extracting user ID from the value of the attribute named by
<code>ldap_memberattr</code>.
Defaults to <span style="font-family:monospace">%u</span>, which means that the whole value is the member ID. If
you change it to something different, you may also need to specify the User
and Group Filters manually &#X2014; see section&#XA0;<a href="#msrlfilters">3.3.24</a>.</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ldap_memberattr_format_re</span></span></dt><dd class="dd-description">
A regex for extracting user ID from the value of the attribute named by
<code>ldap_memberattr</code>.<p>An example value <span style="font-family:monospace">"CN=(</span>\\<span style="font-family:monospace">w*),(OU=.*,)*DC=company,DC=com"</span> works for user IDs such as the following:
</p><ul class="itemize"><li class="li-itemize">
<span style="font-family:monospace">CN=Romeo,OU=Montague,DC=company,DC=com</span>
</li><li class="li-itemize"><span style="font-family:monospace">CN=Abram,OU=Servants,OU=Montague,DC=company,DC=com</span>
</li><li class="li-itemize"><span style="font-family:monospace">CN=Juliet,OU=Capulet,DC=company,DC=com</span>
</li><li class="li-itemize"><span style="font-family:monospace">CN=Peter,OU=Servants,OU=Capulet,DC=company,DC=com</span>
</li></ul><p>In case:
</p><ul class="itemize"><li class="li-itemize">
the option is unset,
</li><li class="li-itemize">or the <span style="font-family:monospace">re</span> module in unavailable in the current Erlang environment,
</li><li class="li-itemize">or the regular expression does not compile,
</li></ul><p>
then instead of a regular expression, a simple format specified by <span style="font-family:monospace">ldap_memberattr_format</span> is used. Also, in the last two cases an error
message is logged during the module initialization.</p><p>Also, note that in all cases <span style="font-family:monospace">ldap_memberattr_format</span> (and <em>not</em> the
regex version) is used for constructing the default &#X201C;User/Group Filter&#X201D; &#X2014;
see section&#XA0;<a href="#msrlfilters">3.3.24</a>.</p></dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ldap_auth_check</span></span></dt><dd class="dd-description">
Whether the module should check (via the ejabberd authentication subsystem)
for existence of each user in the shared LDAP roster. See
section&#XA0;<a href="#msrlconfigroster">3.3.24</a> form more information. Set to <span style="font-family:monospace">off</span> if you
want to disable the check.
Defaults to <span style="font-family:monospace">on</span>.</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ldap_user_cache_validity</span></span></dt><dd class="dd-description">
Number of seconds for which the cache for roster item full names is considered
fresh after retrieval. 300 by default. See section&#XA0;<a href="#msrlconfigroster">3.3.24</a> on
how it is used during roster retrieval.</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ldap_group_cache_validity</span></span></dt><dd class="dd-description">
Number of seconds for which the cache for group membership is considered
fresh after retrieval. 300 by default. See section&#XA0;<a href="#msrlconfigroster">3.3.24</a> on
how it is used during roster retrieval.
</dd></dl><p> <a id="msrlconnparams"></a> </p>
<!--TOC subsubsection id="sec89" Connection parameters-->
<h4 id="sec89" class="subsubsection"><a href="#msrlconnparams">Connection parameters</a></h4><!--SEC END --><p> <a id="msrlconnparams"></a> </p><p>The module also accepts the connection parameters, all of which default to the
top-level parameter of the same name, if unspecified. See&#XA0;<a href="#ldapconnection">3.2.2</a>
for more information about them.</p><p> <a id="msrlconfigroster"></a> </p>
<!--TOC subsubsection id="sec90" Retrieving the roster-->
<h4 id="sec90" class="subsubsection"><a href="#msrlconfigroster">Retrieving the roster</a></h4><!--SEC END --><p> <a id="msrlconfigroster"></a> </p><p>When the module is called to retrieve the shared roster for a user, the
following algorithm is used:</p><ol class="enumerate" type=1><li class="li-enumerate">
<a id="step:rfilter"></a> A list of names of groups to display is created: the <span style="font-family:monospace">Roster Filter</span>
is run against the base DN, retrieving the values of the attribute named by
<span style="font-family:monospace">ldap_groupattr</span>.</li><li class="li-enumerate">Unless the group cache is fresh (see the <span style="font-family:monospace">ldap_group_cache_validity</span> option), it is refreshed:<ol class="enumerate" type=a><li class="li-enumerate">
Information for all groups is retrieved using a single query: the <span style="font-family:monospace">Group Filter</span> is run against the Base DN, retrieving the values of attributes
named by <span style="font-family:monospace">ldap_groupattr</span> (group ID), <span style="font-family:monospace">ldap_groupdesc</span> (group
&#X201C;Display Name&#X201D;) and <span style="font-family:monospace">ldap_memberattr</span> (IDs of group members).</li><li class="li-enumerate">group &#X201C;Display Name&#X201D;, read from the attribute named by <span style="font-family:monospace">ldap_groupdesc</span>, is stored in the cache for the given group</li><li class="li-enumerate">the following processing takes place for each retrieved value of
attribute named by <span style="font-family:monospace">ldap_memberattr</span>:
<ol class="enumerate" type=i><li class="li-enumerate">
the user ID part of it is extracted using <span style="font-family:monospace">ldap_memberattr_format(_re)</span>,</li><li class="li-enumerate">then (unless <span style="font-family:monospace">ldap_auth_check</span> is set to <span style="font-family:monospace">off</span>) for each
found user ID, the module checks (using the <span style="font-family:monospace">ejabberd</span> authentication
subsystem) whether such user exists in the given virtual host. It is
skipped if the check is enabled and fails.<p>This step is here for historical reasons. If you have a tidy DIT and
properly defined &#X201C;Roster Filter&#X201D; and &#X201C;Group Filter&#X201D;, it is safe to
disable it by setting <span style="font-family:monospace">ldap_auth_check</span> to <span style="font-family:monospace">off</span> &#X2014; it will
speed up the roster retrieval.</p></li><li class="li-enumerate">the user ID is stored in the list of members in the cache for the
given group
</li></ol>
</li></ol></li><li class="li-enumerate">For each item (group name) in the list of groups retrieved in step&#XA0;<a href="#step%3Arfilter">1</a>:<ol class="enumerate" type=a><li class="li-enumerate">
the display name of a shared roster group is retrieved from the group
cache</li><li class="li-enumerate">for each IDs of users which belong to the group, retrieved from the
group cache:<ol class="enumerate" type=i><li class="li-enumerate">
the ID is skipped if it&#X2019;s the same as the one for which we are
retrieving the roster. This is so that the user does not have himself in
the roster.</li><li class="li-enumerate">the display name of a shared roster user is retrieved:
<ol class="enumerate" type=A><li class="li-enumerate">
first, unless the user name cache is fresh (see the <span style="font-family:monospace">ldap_user_cache_validity</span> option), it is refreshed by running the
<span style="font-family:monospace">User Filter</span>, against the Base DN, retrieving the values of
attributes named by <span style="font-family:monospace">ldap_useruid</span> and <span style="font-family:monospace">ldap_userdesc</span>.
</li><li class="li-enumerate">then, the display name for the given user ID is retrieved from the
user name cache.
</li></ol>
</li></ol></li></ol></li></ol><p> <a id="msrlconfigexample"></a> </p>
<!--TOC subsubsection id="sec91" Configuration examples-->
<h4 id="sec91" class="subsubsection"><a href="#msrlconfigexample">Configuration examples</a></h4><!--SEC END --><p> <a id="msrlconfigexample"></a> </p><p>Since there are many possible
<a href="http://en.wikipedia.org/wiki/Directory_Information_Tree">DIT</a>
layouts, it will probably be easiest to understand how to configure the module
by looking at an example for a given DIT (or one resembling it).</p><p> <a id="msrlconfigexampleflat"></a> </p>
<!--TOC paragraph id="sec92" Flat DIT-->
<h5 id="sec92" class="paragraph"><a href="#msrlconfigexampleflat">Flat DIT</a></h5><!--SEC END --><p> <a id="msrlconfigexampleflat"></a> </p><p>This seems to be the kind of DIT for which this module was initially designed.
Basically there are just user objects, and group membership is stored in an
attribute individually for each user. For example in a layout shown in
figure&#XA0;<a href="#fig%3Amsrl-dit-flat">3.1</a>, the group of each user is stored in its <span style="font-family:monospace">ou</span> attribute.</p><blockquote class="figure"><div class="center"><div class="center"><hr style="width:80%;height:2"></div>

<img src="msrl-dit-flat.png" alt="msrl-dit-flat.png">


<div class="caption"><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="vertical-align:top;text-align:left;" >Figure 3.1: Flat DIT graph</td></tr>
</table></div>
<a id="fig:msrl-dit-flat"></a>
<div class="center"><hr style="width:80%;height:2"></div></div></blockquote><p>Such layout has a few downsides, including:
</p><ul class="itemize"><li class="li-itemize">
information duplication &#X2013; the group name is repeated in every member object
</li><li class="li-itemize">difficult group management &#X2013; information about group members is not
centralized, but distributed between member objects
</li><li class="li-itemize">inefficiency &#X2013; the list of unique group names has to be computed by iterating over all users
</li></ul><p>This however seems to be a common DIT layout, so the module keeps supporting it.
You can use the following configuration&#X2026;</p><pre class="verbatim">modules:
  ...
  mod_shared_roster_ldap:
    ldap_base: "ou=flat,dc=nodomain"
    ldap_rfilter: "(objectClass=inetOrgPerson)"
    ldap_groupattr: "ou"
    ldap_memberattr: "cn"
    ldap_filter: "(objectClass=inetOrgPerson)"
    ldap_userdesc: "displayName"
  ...
</pre><p>&#X2026;to be provided with a roster as shown in figure&#XA0;<a href="#fig%3Amsrl-roster-flat">3.2</a> upon connecting as user <span style="font-family:monospace">czesio</span>.</p><blockquote class="figure"><div class="center"><div class="center"><hr style="width:80%;height:2"></div>

<img src="msrl-roster-flat.png" alt="msrl-roster-flat.png">


<div class="caption"><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="vertical-align:top;text-align:left;" >Figure 3.2: Roster from flat DIT</td></tr>
</table></div>
<a id="fig:msrl-roster-flat"></a>
<div class="center"><hr style="width:80%;height:2"></div></div></blockquote><p> <a id="msrlconfigexampledeep"></a> </p>
<!--TOC paragraph id="sec93" Deep DIT-->
<h5 id="sec93" class="paragraph"><a href="#msrlconfigexampledeep">Deep DIT</a></h5><!--SEC END --><p> <a id="msrlconfigexampledeep"></a> </p><p>This type of DIT contains distinctly typed objects for users and groups &#X2013; see figure&#XA0;<a href="#fig%3Amsrl-dit-deep">3.3</a>.
They are shown separated into different subtrees, but it&#X2019;s not a requirement.</p><blockquote class="figure"><div class="center"><div class="center"><hr style="width:80%;height:2"></div>

<img src="msrl-dit-deep.png" alt="msrl-dit-deep.png">


<div class="caption"><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="vertical-align:top;text-align:left;" >Figure 3.3: Example &#X201C;deep&#X201D; DIT graph</td></tr>
</table></div>
<a id="fig:msrl-dit-deep"></a>
<div class="center"><hr style="width:80%;height:2"></div></div></blockquote><p>If you use the following example module configuration with it:
</p><pre class="verbatim">modules: 
  ...
  mod_shared_roster_ldap: 
    ldap_base: "ou=deep,dc=nodomain"
    ldap_rfilter: "(objectClass=groupOfUniqueNames)"
    ldap_filter: ""
    ldap_gfilter: "(&amp;(objectClass=groupOfUniqueNames)(cn=%g))"
    ldap_groupdesc: "description"
    ldap_memberattr: "uniqueMember"
    ldap_memberattr_format: "cn=%u,ou=people,ou=deep,dc=nodomain"
    ldap_ufilter: "(&amp;(objectClass=inetOrgPerson)(cn=%u))"
    ldap_userdesc: "displayName"
  ...
</pre><p>&#X2026;and connect as user <span style="font-family:monospace">czesio</span>, then <span style="font-family:monospace">ejabberd</span> will provide you with
the roster shown in figure&#XA0;<a href="#fig%3Amsrl-roster-deep">3.4</a>.</p><blockquote class="figure"><div class="center"><div class="center"><hr style="width:80%;height:2"></div>

<img src="msrl-roster-deep.png" alt="msrl-roster-deep.png">


<div class="caption"><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="vertical-align:top;text-align:left;" >Figure 3.4: Example roster from &#X201C;deep&#X201D; DIT</td></tr>
</table></div>
<a id="fig:msrl-roster-deep"></a>
<div class="center"><hr style="width:80%;height:2"></div></div></blockquote><p> <a id="modsic"></a> </p>
<!--TOC subsection id="sec94" <span style="font-family:monospace">mod_sic</span>-->
<h3 id="sec94" class="subsection">3.3.25&#XA0;&#XA0;<a href="#modsic"><span style="font-family:monospace">mod_sic</span></a></h3><!--SEC END --><p> <a id="modsic"></a> 
</p><p>This module adds support for Server IP Check (<a href="http://xmpp.org/extensions/xep-0279.html">XEP-0279</a>). This protocol
enables a client to discover its external IP address.</p><p>Options:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">iqdisc: Discipline</span></span></dt><dd class="dd-description"> This specifies
the processing discipline for <span style="font-family:monospace">urn:xmpp:sic:0</span> IQ queries (see section&#XA0;<a href="#modiqdiscoption">3.3.2</a>).
</dd></dl><p> <a id="modsip"></a> </p>
<!--TOC subsection id="sec95" <span style="font-family:monospace">mod_sip</span>-->
<h3 id="sec95" class="subsection">3.3.26&#XA0;&#XA0;<a href="#modsip"><span style="font-family:monospace">mod_sip</span></a></h3><!--SEC END --><p> <a id="modsip"></a> 

This module adds SIP proxy/registrar support for the corresponding virtual host.
Note that it is not enough to just load this module only. You should also configure
listeners and DNS records properly. See section <a href="#sip">3.1.11</a> for the full explanation.</p><p>Example configuration:
</p><pre class="verbatim">modules:
  ...
  mod_sip: {}
  ...
</pre><p>Options:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">via: [{type: Type, host: Host, port: Port}]</span></span></dt><dd class="dd-description">With
this option for every <span style="font-family:monospace">Type</span> you can specify <span style="font-family:monospace">Host</span> and <span style="font-family:monospace">Port</span>
to set in <span style="font-family:monospace">Via</span> header of outgoing SIP messages, where <span style="font-family:monospace">Type</span> can be
<span style="font-family:monospace">udp</span>, <span style="font-family:monospace">tcp</span> or <span style="font-family:monospace">tls</span>. <span style="font-family:monospace">Host</span> is a string and <span style="font-family:monospace">Port</span> is 
a non negative integer. This is useful if you&#X2019;re running your server in a non-standard
network topology. Example configuration:
<pre class="verbatim">modules:
  ...
  mod_sip:
    via:
      - 
        type: tls
        host: "sip-tls.example.com"
        port: 5061
      - 
        type: tcp
        host: "sip-tcp.example.com"
        port: 5060
      - 
        type: udp
        host: "sip-udp.example.com"
        port: 5060
  ...
</pre></dd></dl><p> <a id="modstats"></a> </p>
<!--TOC subsection id="sec96" <span style="font-family:monospace">mod_stats</span>-->
<h3 id="sec96" class="subsection">3.3.27&#XA0;&#XA0;<a href="#modstats"><span style="font-family:monospace">mod_stats</span></a></h3><!--SEC END --><p> <a id="modstats"></a> 
</p><p>This module adds support for Statistics Gathering (<a href="http://xmpp.org/extensions/xep-0039.html">XEP-0039</a>). This protocol
allows you to retrieve next statistics from your <span style="font-family:monospace">ejabberd</span> deployment:
</p><ul class="itemize"><li class="li-itemize">
Total number of registered users on the current virtual host (users/total).
</li><li class="li-itemize">Total number of registered users on all virtual hosts (users/all-hosts/total).
</li><li class="li-itemize">Total number of online users on the current virtual host (users/online).
</li><li class="li-itemize">Total number of online users on all virtual hosts (users/all-hosts/online).
</li></ul><p>Options:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">iqdisc: Discipline</span></span></dt><dd class="dd-description"> This specifies
the processing discipline for Statistics Gathering (<span style="font-family:monospace">http://jabber.org/protocol/stats</span>) IQ queries (see section&#XA0;<a href="#modiqdiscoption">3.3.2</a>).
</dd></dl><p>As there are only a small amount of clients (for example
<a href="http://tkabber.jabber.ru/">Tkabber</a>) and software libraries with
support for this XEP, a few examples are given of the XML you need to send
in order to get the statistics. Here they are:
</p><ul class="itemize"><li class="li-itemize">
You can request the number of online users on the current virtual host
(<span style="font-family:monospace">example.org</span>) by sending:
<pre class="verbatim">&lt;iq to='example.org' type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/stats'&gt;
    &lt;stat name='users/online'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</pre></li><li class="li-itemize">You can request the total number of registered users on all virtual hosts
by sending:
<pre class="verbatim">&lt;iq to='example.org' type='get'&gt;
  &lt;query xmlns='http://jabber.org/protocol/stats'&gt;
    &lt;stat name='users/all-hosts/total'/&gt;
  &lt;/query&gt;
&lt;/iq&gt;
</pre></li></ul><p> <a id="modtime"></a> </p>
<!--TOC subsection id="sec97" <span style="font-family:monospace">mod_time</span>-->
<h3 id="sec97" class="subsection">3.3.28&#XA0;&#XA0;<a href="#modtime"><span style="font-family:monospace">mod_time</span></a></h3><!--SEC END --><p> <a id="modtime"></a> 
</p><p>This module features support for Entity Time (<a href="http://xmpp.org/extensions/xep-0202.html">XEP-0202</a>). By using this XEP,
you are able to discover the time at another entity&#X2019;s location.</p><p>Options:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">iqdisc: Discipline</span></span></dt><dd class="dd-description"> This specifies
the processing discipline for Entity Time (<span style="font-family:monospace">jabber:iq:time</span>) IQ queries (see section&#XA0;<a href="#modiqdiscoption">3.3.2</a>).
</dd></dl><p> <a id="modvcard"></a> </p>
<!--TOC subsection id="sec98" <span style="font-family:monospace">mod_vcard</span>-->
<h3 id="sec98" class="subsection">3.3.29&#XA0;&#XA0;<a href="#modvcard"><span style="font-family:monospace">mod_vcard</span></a></h3><!--SEC END --><p> <a id="modvcard"></a> 
</p><p>This module allows end users to store and retrieve their vCard, and to retrieve
other users vCards, as defined in vcard-temp (<a href="http://xmpp.org/extensions/xep-0054.html">XEP-0054</a>). The module also
implements an uncomplicated Jabber User Directory based on the vCards of
these users. Moreover, it enables the server to send its vCard when queried.</p><p>Options:
</p><dl class="description"><dt class="dt-description">

<span style="font-weight:bold"><span style="font-family:monospace">host: HostName</span></span></dt><dd class="dd-description">  This option defines the Jabber ID of the
service. If the <span style="font-family:monospace">host</span> option is not specified, the Jabber ID will be the
hostname of the virtual host with the prefix &#X2018;<span style="font-family:monospace">vjud.</span>&#X2019;. The keyword "@HOST@"
is replaced at start time with the real virtual host name.

</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">iqdisc: Discipline</span></span></dt><dd class="dd-description"> This specifies
the processing discipline for <span style="font-family:monospace">vcard-temp</span> IQ queries (see section&#XA0;<a href="#modiqdiscoption">3.3.2</a>).
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">db_type: internal|odbc</span></span></dt><dd class="dd-description"> 
Define the type of storage where the module will create the tables and store user information.
The default is to store in the internal Mnesia database.
If <span style="font-family:monospace">odbc</span> value is defined, make sure you have defined the database, see&#XA0;<a href="#database">3.2</a>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">search: true|false</span></span></dt><dd class="dd-description">This option specifies whether the search
functionality is enabled or not
If disabled, the option <span style="font-family:monospace">host</span> will be ignored and the
Jabber User Directory service will not appear in the Service Discovery item
list. The default value is <span style="font-family:monospace">true</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">matches: infinity|Number</span></span></dt><dd class="dd-description">With this option, the number of reported
search results can be limited. If the option&#X2019;s value is set to <span style="font-family:monospace">infinity</span>,
all search results are reported. The default value is <span style="font-family:monospace">30</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">allow_return_all: false|true</span></span></dt><dd class="dd-description">This option enables
you to specify if search operations with empty input fields should return all
users who added some information to their vCard. The default value is
<span style="font-family:monospace">false</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">search_all_hosts, true|false</span></span></dt><dd class="dd-description">If this option is set
to <span style="font-family:monospace">true</span>, search operations will apply to all virtual hosts. Otherwise
only the current host will be searched. The default value is <span style="font-family:monospace">true</span>.
This option is available in <span style="font-family:monospace">mod_vcard</span>when using Mnesia, but not when using ODBC storage.
</dd></dl><p>Examples:
</p><ul class="itemize"><li class="li-itemize">
In this first situation, search results are limited to twenty items,
every user who added information to their vCard will be listed when people
do an empty search, and only users from the current host will be returned:
<pre class="verbatim">modules:
  ...
  mod_vcard:
    search: true
    matches: 20
    allow_return_all: true
    search_all_hosts: false
  ...
</pre></li><li class="li-itemize">The second situation differs in a way that search results are not limited,
and that all virtual hosts will be searched instead of only the current one:
<pre class="verbatim">modules:
  ...
  mod_vcard:
    search: true
    matches: infinity
    allow_return_all: true
  ...
</pre></li></ul><p> <a id="modvcardldap"></a> </p>
<!--TOC subsection id="sec99" <span style="font-family:monospace">mod_vcard_ldap</span>-->
<h3 id="sec99" class="subsection">3.3.30&#XA0;&#XA0;<a href="#modvcardldap"><span style="font-family:monospace">mod_vcard_ldap</span></a></h3><!--SEC END --><p> <a id="modvcardldap"></a> 
</p><p><span style="font-family:monospace">ejabberd</span> can map LDAP attributes to vCard fields. This behaviour is
implemented in the <span style="font-family:monospace">mod_vcard_ldap</span> module. This module does not depend on the
authentication method (see&#XA0;<a href="#ldapauth">3.2.2</a>).</p><p>Usually <span style="font-family:monospace">ejabberd</span> treats LDAP as a read-only storage:
it is possible to consult data, but not possible to
create accounts or edit vCard that is stored in LDAP.
However, it is possible to change passwords if <span style="font-family:monospace">mod_register</span> module is enabled
and LDAP server supports
<a href="http://tools.ietf.org/html/rfc3062">RFC 3062</a>.</p><p>The <span style="font-family:monospace">mod_vcard_ldap</span> module has
its own optional parameters. The first group of parameters has the same
meaning as the top-level LDAP parameters to set the authentication method:
<span style="font-family:monospace">ldap_servers</span>, <span style="font-family:monospace">ldap_port</span>, <span style="font-family:monospace">ldap_rootdn</span>,
<span style="font-family:monospace">ldap_password</span>, <span style="font-family:monospace">ldap_base</span>, <span style="font-family:monospace">ldap_uids</span>,
<span style="font-family:monospace">ldap_deref_aliases</span> and <span style="font-family:monospace">ldap_filter</span>.
See section&#XA0;<a href="#ldapauth">3.2.2</a> for detailed information
about these options. If one of these options is not set, <span style="font-family:monospace">ejabberd</span> will look
for the top-level option with the same name.</p><p>The second group of parameters
consists of the following <span style="font-family:monospace">mod_vcard_ldap</span>-specific options:</p><dl class="description"><dt class="dt-description">

<span style="font-weight:bold"><span style="font-family:monospace">host: HostName</span></span></dt><dd class="dd-description">  This option defines the Jabber ID of the
service. If the <span style="font-family:monospace">host</span> option is not specified, the Jabber ID will be the
hostname of the virtual host with the prefix &#X2018;<span style="font-family:monospace">vjud.</span>&#X2019;. The keyword "@HOST@"
is replaced at start time with the real virtual host name.

</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">iqdisc: Discipline</span></span></dt><dd class="dd-description"> This specifies
the processing discipline for <span style="font-family:monospace">vcard-temp</span> IQ queries (see section&#XA0;<a href="#modiqdiscoption">3.3.2</a>).
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">{search, true|false}</span></span></dt><dd class="dd-description">This option specifies whether the search
functionality is enabled (value: <span style="font-family:monospace">true</span>) or disabled (value:
<span style="font-family:monospace">false</span>). If disabled, the option <span style="font-family:monospace">host</span> will be ignored and the
Jabber User Directory service will not appear in the Service Discovery item
list. The default value is <span style="font-family:monospace">true</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">{matches, infinity|Number}</span></span></dt><dd class="dd-description">With this option, the number of reported
search results can be limited. If the option&#X2019;s value is set to <span style="font-family:monospace">infinity</span>,
all search results are reported. The default value is <span style="font-family:monospace">30</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">{ldap_vcard_map, [ {Name, Pattern, LDAPattributes}, ...]}</span></span></dt><dd class="dd-description"> 
With this option you can set the table that maps LDAP attributes to vCard fields.

<span style="font-family:monospace">Name</span> is the type name of the vCard as defined in
<a href="http://tools.ietf.org/html/rfc2426">RFC 2426</a>.
<span style="font-family:monospace">Pattern</span> is a string which contains pattern variables
<span style="font-family:monospace">"%u"</span>, <span style="font-family:monospace">"%d"</span> or <span style="font-family:monospace">"%s"</span>.
<span style="font-family:monospace">LDAPattributes</span> is the list containing LDAP attributes.
The pattern variables 
<span style="font-family:monospace">"%s"</span> will be sequentially replaced 
with the values of LDAP attributes from <span style="font-family:monospace">List_of_LDAP_attributes</span>,
<span style="font-family:monospace">"%u"</span> will be replaced with the user part of a JID, 
and <span style="font-family:monospace">"%d"</span> will be replaced with the domain part of a JID. 
The default is:
<pre class="verbatim">[{"NICKNAME", "%u", []},
 {"FN", "%s", ["displayName"]},
 {"LAST", "%s", ["sn"]},
 {"FIRST", "%s", ["givenName"]},
 {"MIDDLE", "%s", ["initials"]},
 {"ORGNAME", "%s", ["o"]},
 {"ORGUNIT", "%s", ["ou"]},
 {"CTRY", "%s", ["c"]},
 {"LOCALITY", "%s", ["l"]},
 {"STREET", "%s", ["street"]},
 {"REGION", "%s", ["st"]},
 {"PCODE", "%s", ["postalCode"]},
 {"TITLE", "%s", ["title"]},
 {"URL", "%s", ["labeleduri"]},
 {"DESC", "%s", ["description"]},
 {"TEL", "%s", ["telephoneNumber"]},
 {"EMAIL", "%s", ["mail"]},
 {"BDAY", "%s", ["birthDay"]},
 {"ROLE", "%s", ["employeeType"]},
 {"PHOTO", "%s", ["jpegPhoto"]}]
</pre></dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">{ldap_search_fields, [ {Name, Attribute}, ...]}</span></span></dt><dd class="dd-description">This option
defines the search form and the LDAP attributes to search within.
<span style="font-family:monospace">Name</span> is the name of a search form
field which will be automatically translated by using the translation
files (see <span style="font-family:monospace">msgs/*.msg</span> for available words). <span style="font-family:monospace">Attribute</span> is the
LDAP attribute or the pattern <span style="font-family:monospace">"%u"</span>. The default is:
<pre class="verbatim">[{"User", "%u"},
 {"Full Name", "displayName"},
 {"Given Name", "givenName"},
 {"Middle Name", "initials"},
 {"Family Name", "sn"},
 {"Nickname", "%u"},
 {"Birthday", "birthDay"},
 {"Country", "c"},
 {"City", "l"},
 {"Email", "mail"},
 {"Organization Name", "o"},
 {"Organization Unit", "ou"}]
</pre></dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">{ldap_search_reported, [ {SearchField, VcardField}, ...]}</span></span></dt><dd class="dd-description">This option
defines which search fields should be reported.
<span style="font-family:monospace">SearchField</span> is the name of a search form
field which will be automatically translated by using the translation
files (see <span style="font-family:monospace">msgs/*.msg</span> for available words). <span style="font-family:monospace">VcardField</span> is the
vCard field name defined in the <span style="font-family:monospace">ldap_vcard_map</span> option. The default
is:
<pre class="verbatim">[{"Full Name", "FN"},
 {"Given Name", "FIRST"},
 {"Middle Name", "MIDDLE"},
 {"Family Name", "LAST"},
 {"Nickname", "NICKNAME"},
 {"Birthday", "BDAY"},
 {"Country", "CTRY"},
 {"City", "LOCALITY"},
 {"Email", "EMAIL"},
 {"Organization Name", "ORGNAME"},
 {"Organization Unit", "ORGUNIT"}]
</pre></dd></dl><p>Examples:
</p><ul class="itemize"><li class="li-itemize">
<p>Let&#X2019;s say <span style="font-family:monospace">ldap.example.org</span> is the name of our LDAP server. We have
users with their passwords in <span style="font-family:monospace">"ou=Users,dc=example,dc=org"</span> directory.
Also we have addressbook, which contains users emails and their additional
infos in <span style="font-family:monospace">"ou=AddressBook,dc=example,dc=org"</span> directory. Corresponding
authentication section should looks like this:</p><pre class="verbatim">%% authentication method
{auth_method, ldap}.
%% DNS name of our LDAP server
{ldap_servers, ["ldap.example.org"]}.
%% We want to authorize users from 'shadowAccount' object class only
{ldap_filter, "(objectClass=shadowAccount)"}.
</pre><p>Now we want to use users LDAP-info as their vCards. We have four attributes
defined in our LDAP schema: <span style="font-family:monospace">"mail"</span> &#X2014; email address, <span style="font-family:monospace">"givenName"</span>
&#X2014; first name, <span style="font-family:monospace">"sn"</span> &#X2014; second name, <span style="font-family:monospace">"birthDay"</span> &#X2014; birthday.
Also we want users to search each other. Let&#X2019;s see how we can set it up:</p><pre class="verbatim">{modules,
  ...
  {mod_vcard_ldap,
   [
    %% We use the same server and port, but want to bind anonymously because
    %% our LDAP server accepts anonymous requests to
    %% "ou=AddressBook,dc=example,dc=org" subtree.
    {ldap_rootdn, ""},
    {ldap_password, ""},
    %% define the addressbook's base
    {ldap_base, "ou=AddressBook,dc=example,dc=org"},
    %% uidattr: user's part of JID is located in the "mail" attribute
    %% uidattr_format: common format for our emails
    {ldap_uids, [{"mail","%u@mail.example.org"}]},
    %% We have to define empty filter here, because entries in addressbook does not
    %% belong to shadowAccount object class
    {ldap_filter, ""},
    %% Now we want to define vCard pattern
    {ldap_vcard_map,
     [{"NICKNAME", "%u", []}, % just use user's part of JID as his nickname
      {"FIRST", "%s", ["givenName"]},
      {"LAST", "%s", ["sn"]},
      {"FN", "%s, %s", ["sn", "givenName"]}, % example: "Smith, John"
      {"EMAIL", "%s", ["mail"]},
      {"BDAY", "%s", ["birthDay"]}]},
    %% Search form
    {ldap_search_fields,
     [{"User", "%u"},
      {"Name", "givenName"},
      {"Family Name", "sn"},
      {"Email", "mail"},
      {"Birthday", "birthDay"}]},
    %% vCard fields to be reported
    %% Note that JID is always returned with search results
    {ldap_search_reported,
     [{"Full Name", "FN"},
      {"Nickname", "NICKNAME"},
      {"Birthday", "BDAY"}]}
  ]}
  ...
}.
</pre><p>Note that <span style="font-family:monospace">mod_vcard_ldap</span> module checks an existence of the user before
searching his info in LDAP.</p></li><li class="li-itemize"><span style="font-family:monospace">ldap_vcard_map</span> example:
<pre class="verbatim">{ldap_vcard_map,
 [{"NICKNAME", "%u", []},
  {"FN", "%s", ["displayName"]},
  {"CTRY", "Russia", []},
  {"EMAIL", "%u@%d", []},
  {"DESC", "%s\n%s", ["title", "description"]}
 ]},
</pre></li><li class="li-itemize"><span style="font-family:monospace">ldap_search_fields</span> example:
<pre class="verbatim">{ldap_search_fields,
 [{"User", "uid"},
  {"Full Name", "displayName"},
  {"Email", "mail"}
 ]},
</pre></li><li class="li-itemize"><span style="font-family:monospace">ldap_search_reported</span> example:
<pre class="verbatim">{ldap_search_reported,
 [{"Full Name", "FN"},
  {"Email", "EMAIL"},
  {"Birthday", "BDAY"},
  {"Nickname", "NICKNAME"}
 ]},
</pre></li></ul><p> <a id="modvcardxupdate"></a> </p>
<!--TOC subsection id="sec100" <span style="font-family:monospace">mod_vcard_xupdate</span>-->
<h3 id="sec100" class="subsection">3.3.31&#XA0;&#XA0;<a href="#modvcardxupdate"><span style="font-family:monospace">mod_vcard_xupdate</span></a></h3><!--SEC END --><p> <a id="modvcardxupdate"></a> 
</p><p>The user&#X2019;s client can store an avatar in the user vCard.
The vCard-Based Avatars protocol (<a href="http://xmpp.org/extensions/xep-0153.html">XEP-0153</a>)
provides a method for clients to inform the contacts what is the avatar hash value.
However, simple or small clients may not implement that protocol.</p><p>If this module is enabled, all the outgoing client presence stanzas get automatically
the avatar hash on behalf of the client.
So, the contacts receive the presence stanzas with the Update Data described
in <a href="http://xmpp.org/extensions/xep-0153.html">XEP-0153</a> as if the client would had inserted it itself.
If the client had already included such element in the presence stanza,
it is replaced with the element generated by ejabberd.</p><p>By enabling this module, each vCard modification produces a hash recalculation,
and each presence sent by a client produces hash retrieval and a
presence stanza rewrite.
For this reason, enabling this module will introduce a computational overhead
in servers with clients that change frequently their presence.</p><p>Options:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">db_type: internal|odbc</span></span></dt><dd class="dd-description"> 
Define the type of storage where the module will create the tables and store user information.
The default is to store in the internal Mnesia database.
If <span style="font-family:monospace">odbc</span> value is defined, make sure you have defined the database, see&#XA0;<a href="#database">3.2</a>.
</dd></dl><p> <a id="modversion"></a> </p>
<!--TOC subsection id="sec101" <span style="font-family:monospace">mod_version</span>-->
<h3 id="sec101" class="subsection">3.3.32&#XA0;&#XA0;<a href="#modversion"><span style="font-family:monospace">mod_version</span></a></h3><!--SEC END --><p> <a id="modversion"></a> 
</p><p>This module implements Software Version (<a href="http://xmpp.org/extensions/xep-0092.html">XEP-0092</a>). Consequently, it
answers <span style="font-family:monospace">ejabberd</span>&#X2019;s version when queried.</p><p>Options:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">show_os: true|false</span></span></dt><dd class="dd-description">Should the operating system be revealed or not.
The default value is <span style="font-family:monospace">true</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">iqdisc: Discipline</span></span></dt><dd class="dd-description"> This specifies
the processing discipline for Software Version (<span style="font-family:monospace">jabber:iq:version</span>) IQ queries (see section&#XA0;<a href="#modiqdiscoption">3.3.2</a>).
</dd></dl><p> <a id="manage"></a> </p>
<!--TOC chapter id="sec102" Managing an <span style="font-family:monospace">ejabberd</span> Server-->
<h1 id="sec102" class="chapter">Chapter&#XA0;4&#XA0;&#XA0;<a href="#manage">Managing an <span style="font-family:monospace">ejabberd</span> Server</a></h1><!--SEC END --><p> <a id="manage"></a> </p><p> <a id="ejabberdctl"></a> </p>
<!--TOC section id="sec103" <span style="font-family:monospace">ejabberdctl</span>-->
<h2 id="sec103" class="section">4.1&#XA0;&#XA0;<a href="#ejabberdctl"><span style="font-family:monospace">ejabberdctl</span></a></h2><!--SEC END --><p> <a id="ejabberdctl"></a> </p><p>With the <span style="font-family:monospace">ejabberdctl</span> command line administration script 
you can execute <span style="font-family:monospace">ejabberdctl commands</span> (described in the next section, <a href="#ectl-commands">4.1.1</a>)
and also many general <span style="font-family:monospace">ejabberd commands</span> (described in section <a href="#eja-commands">4.2</a>).
This means you can start, stop and perform many other administrative tasks
in a local or remote <span style="font-family:monospace">ejabberd</span> server (by providing the argument <span style="font-family:monospace">--node NODENAME</span>).</p><p>The <span style="font-family:monospace">ejabberdctl</span> script can be configured in the file <span style="font-family:monospace">ejabberdctl.cfg</span>.
This file includes detailed information about each configurable option. See section <a href="#erlangconfiguration">4.1.2</a>.</p><p>The <span style="font-family:monospace">ejabberdctl</span> script returns a numerical status code.
Success is represented by <span style="font-family:monospace">0</span>,
error is represented by <span style="font-family:monospace">1</span>,
and other codes may be used for specific results.
This can be used by other scripts to determine automatically
if a command succeeded or failed,
for example using: <span style="font-family:monospace">echo $?</span></p><p>If you use Bash, you can get Bash completion by copying the file <span style="font-family:monospace">tools/ejabberdctl.bc</span>
to the directory <span style="font-family:monospace">/etc/bash_completion.d/</span> (in Debian, Ubuntu, Fedora and maybe others).</p><p> <a id="ectl-commands"></a> </p>
<!--TOC subsection id="sec104" ejabberdctl Commands-->
<h3 id="sec104" class="subsection">4.1.1&#XA0;&#XA0;<a href="#ectl-commands">ejabberdctl Commands</a></h3><!--SEC END --><p> <a id="ectl-commands"></a> </p><p>When <span style="font-family:monospace">ejabberdctl</span> is executed without any parameter,
it displays the available options. If there isn&#X2019;t an <span style="font-family:monospace">ejabberd</span> server running,
the available parameters are:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">start</span></span></dt><dd class="dd-description"> Start <span style="font-family:monospace">ejabberd</span> in background mode. This is the default method.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">debug</span></span></dt><dd class="dd-description"> Attach an Erlang shell to an already existing <span style="font-family:monospace">ejabberd</span> server. This allows to execute commands interactively in the <span style="font-family:monospace">ejabberd</span> server.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">live</span></span></dt><dd class="dd-description"> Start <span style="font-family:monospace">ejabberd</span> in live mode: the shell keeps attached to the started server, showing log messages and allowing to execute interactive commands.
</dd></dl><p>If there is an <span style="font-family:monospace">ejabberd</span> server running in the system,
<span style="font-family:monospace">ejabberdctl</span> shows the <span style="font-family:monospace">ejabberdctl commands</span> described bellow
and all the <span style="font-family:monospace">ejabberd commands</span> available in that server (see <a href="#list-eja-commands">4.2.1</a>).</p><p>The <span style="font-family:monospace">ejabberdctl commands</span> are:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">help</span></span></dt><dd class="dd-description"> Get help about ejabberdctl or any available command. Try <span style="font-family:monospace">ejabberdctl help help</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">status</span></span></dt><dd class="dd-description"> Check the status of the <span style="font-family:monospace">ejabberd</span> server.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">stop</span></span></dt><dd class="dd-description"> Stop the <span style="font-family:monospace">ejabberd</span> server.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">restart</span></span></dt><dd class="dd-description"> Restart the <span style="font-family:monospace">ejabberd</span> server.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">mnesia</span></span></dt><dd class="dd-description"> Get information about the Mnesia database.
</dd></dl><p>The <span style="font-family:monospace">ejabberdctl</span> script can be restricted to require authentication
and execute some <span style="font-family:monospace">ejabberd commands</span>; see <a href="#accesscommands">4.2.2</a>.
Add the option to the file <span style="font-family:monospace">ejabberd.yml</span>.
In this example there is no restriction:
</p><pre class="verbatim">ejabberdctl_access_commands: []
</pre><p>If account <span style="font-family:monospace">robot1@example.org</span> is registered in <span style="font-family:monospace">ejabberd</span> with password <span style="font-family:monospace">abcdef</span>
(which MD5 is E8B501798950FC58AAD83C8C14978E),
and <span style="font-family:monospace">ejabberd.yml</span> contains this setting:
</p><pre class="verbatim">{hosts, ["example.org"]}.
{acl, bots, {user, "robot1", "example.org"}}.
{access, ctlaccess, [{allow, bots}]}.
{ejabberdctl_access_commands, [ {ctlaccess, [registered_users, register], []} ]}.
</pre><p>then you can do this in the shell:
</p><pre class="verbatim">$ ejabberdctl registered_users example.org
Error: no_auth_provided
$ ejabberdctl --auth robot1 example.org abcdef registered_users example.org
robot1
testuser1
testuser2
</pre><p> <a id="erlangconfiguration"></a> </p>
<!--TOC subsection id="sec105" Erlang Runtime System-->
<h3 id="sec105" class="subsection">4.1.2&#XA0;&#XA0;<a href="#erlangconfiguration">Erlang Runtime System</a></h3><!--SEC END --><p> <a id="erlangconfiguration"></a> </p><p><span style="font-family:monospace">ejabberd</span> is an Erlang/OTP application that runs inside an Erlang runtime system.
This system is configured using environment variables and command line parameters.
The <span style="font-family:monospace">ejabberdctl</span> administration script uses many of those possibilities.
You can configure some of them with the file <span style="font-family:monospace">ejabberdctl.cfg</span>,
which includes detailed description about them.
This section describes for reference purposes
all the environment variables and command line parameters.</p><p>The environment variables:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">EJABBERD_CONFIG_PATH</span></span></dt><dd class="dd-description">
	Path to the ejabberd configuration file.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">EJABBERD_MSGS_PATH</span></span></dt><dd class="dd-description">
	Path to the directory with translated strings.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">EJABBERD_LOG_PATH</span></span></dt><dd class="dd-description">
	Path to the ejabberd service log file.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">EJABBERD_SO_PATH</span></span></dt><dd class="dd-description">
	Path to the directory with binary system libraries.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">EJABBERD_DOC_PATH</span></span></dt><dd class="dd-description">
	Path to the directory with ejabberd documentation.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">EJABBERD_PID_PATH</span></span></dt><dd class="dd-description">
	Path to the PID file that ejabberd can create when started.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">HOME</span></span></dt><dd class="dd-description">
	Path to the directory that is considered <span style="font-family:monospace">ejabberd</span>&#X2019;s home.
	This path is used to read the file <span style="font-family:monospace">.erlang.cookie</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ERL_CRASH_DUMP</span></span></dt><dd class="dd-description">
	Path to the file where crash reports will be dumped.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ERL_EPMD_ADDRESS</span></span></dt><dd class="dd-description">
	IP address where epmd listens for connections (see section <a href="#epmd">5.2</a>).
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ERL_INETRC</span></span></dt><dd class="dd-description">
	Indicates which IP name resolution to use.
	If using <span style="font-family:monospace">-sname</span>, specify either this option or <span style="font-family:monospace">-kernel inetrc filepath</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ERL_MAX_PORTS</span></span></dt><dd class="dd-description">
	Maximum number of simultaneously open Erlang ports.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ERL_MAX_ETS_TABLES</span></span></dt><dd class="dd-description">
	Maximum number of ETS and Mnesia tables.
</dd></dl><p>The command line parameters:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">-sname ejabberd</span></span></dt><dd class="dd-description">
	The Erlang node will be identified using only the first part
	of the host name, i.&#XA0;e. other Erlang nodes outside this domain cannot contact
	this node. This is the preferable option in most cases.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">-name ejabberd</span></span></dt><dd class="dd-description">
	The Erlang node will be fully identified.
This is only useful if you plan to setup an <span style="font-family:monospace">ejabberd</span> cluster with nodes in different networks.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">-kernel inetrc &#X2019;"/etc/ejabberd/inetrc"&#X2019;</span></span></dt><dd class="dd-description">
	Indicates which IP name resolution to use.
	If using <span style="font-family:monospace">-sname</span>, specify either this option or <span style="font-family:monospace">ERL_INETRC</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">-kernel inet_dist_listen_min 4200 inet_dist_listen_min 4210</span></span></dt><dd class="dd-description">
	Define the first and last ports that <span style="font-family:monospace">epmd</span> (section <a href="#epmd">5.2</a>) can listen to.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">-kernel inet_dist_use_interface "{ 127,0,0,1 }"</span></span></dt><dd class="dd-description">
	Define the IP address where this Erlang node listens for other nodes
connections (see section <a href="#epmd">5.2</a>).
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">-detached</span></span></dt><dd class="dd-description">
Starts the Erlang system detached from the system console.
	Useful for running daemons and background processes.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">-noinput</span></span></dt><dd class="dd-description">
	Ensures that the Erlang system never tries to read any input.
	Useful for running daemons and background processes.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">-pa /var/lib/ejabberd/ebin</span></span></dt><dd class="dd-description">
	Specify the directory where Erlang binary files (*.beam) are located.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">-s ejabberd</span></span></dt><dd class="dd-description">
	Tell Erlang runtime system to start the <span style="font-family:monospace">ejabberd</span> application.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">-mnesia dir &#X2019;"/var/lib/ejabberd/"&#X2019;</span></span></dt><dd class="dd-description">
	Specify the Mnesia database directory.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">-sasl sasl_error_logger {file, "/var/log/ejabberd/erlang.log"}</span></span></dt><dd class="dd-description">
	Path to the Erlang/OTP system log file.
SASL here means &#X201C;System Architecture Support Libraries&#X201D;
not &#X201C;Simple Authentication and Security Layer&#X201D;.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">+K [true|false]</span></span></dt><dd class="dd-description">
	Kernel polling.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">-smp [auto|enable|disable]</span></span></dt><dd class="dd-description">
	SMP support.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">+P 250000</span></span></dt><dd class="dd-description">
	Maximum number of Erlang processes.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">-remsh ejabberd@localhost</span></span></dt><dd class="dd-description">
	Open an Erlang shell in a remote Erlang node.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">-hidden</span></span></dt><dd class="dd-description">
	The connections to other nodes are hidden (not published).
	The result is that this node is not considered part of the cluster.
	This is important when starting a temporary <span style="font-family:monospace">ctl</span> or <span style="font-family:monospace">debug</span> node.
</dd></dl><p>
Note that some characters need to be escaped when used in shell scripts, for instance <code>"</code> and <code>{}</code>.
You can find other options in the Erlang manual page (<span style="font-family:monospace">erl -man erl</span>).</p><p> <a id="eja-commands"></a> </p>
<!--TOC section id="sec106" <span style="font-family:monospace">ejabberd</span> Commands-->
<h2 id="sec106" class="section">4.2&#XA0;&#XA0;<a href="#eja-commands"><span style="font-family:monospace">ejabberd</span> Commands</a></h2><!--SEC END --><p> <a id="eja-commands"></a> </p><p>An <span style="font-family:monospace">ejabberd command</span> is an abstract function identified by a name,
with a defined number and type of calling arguments and type of result
that is registered in the <span style="font-family:monospace">ejabberd_commands</span> service.
Those commands can be defined in any Erlang module and executed using any valid frontend.</p><p><span style="font-family:monospace">ejabberd</span> includes two frontends to execute <span style="font-family:monospace">ejabberd commands</span>: the script <span style="font-family:monospace">ejabberdctl</span> (<a href="#ejabberdctl">4.1</a>)
and the <span style="font-family:monospace">ejabberd_xmlrpc</span> listener (<a href="#listened-module">3.1.4</a>).
Other known frontends that can be installed to execute ejabberd commands in different ways are:
<span style="font-family:monospace">mod_rest</span> (HTTP POST service),
<span style="font-family:monospace">mod_shcommands</span> (ejabberd WebAdmin page).</p><p> <a id="list-eja-commands"></a> </p>
<!--TOC subsection id="sec107" List of ejabberd Commands-->
<h3 id="sec107" class="subsection">4.2.1&#XA0;&#XA0;<a href="#list-eja-commands">List of ejabberd Commands</a></h3><!--SEC END --><p> <a id="list-eja-commands"></a> </p><p><span style="font-family:monospace">ejabberd</span> includes a few ejabberd Commands by default.
When more modules are installed, new commands may be available in the frontends.</p><p>The easiest way to get a list of the available commands, and get help for them is to use
the ejabberdctl script:
</p><pre class="verbatim">$ ejabberdctl help
Usage: ejabberdctl [--node nodename] [--auth user host password] command [options]

Available commands in this ejabberd node:
  backup file                  Store the database to backup file
  connected_users              List all established sessions
  connected_users_number       Get the number of established sessions
  ...
</pre><p>The most interesting ones are:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">reopen_log</span></span></dt><dd class="dd-description"> Reopen the log files after they were renamed.
If the old files were not renamed before calling this command,
they are automatically renamed to <span style="font-family:monospace">"*-old.log"</span>. See section <a href="#logfiles">7.1</a>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">convert_to_yaml /etc/ejabberd/ejabberd.cfg /etc/ejabberd/ejabberd-converted.yml</span></span></dt><dd class="dd-description">
Convert an old ejabberd.cfg file to the YAML syntax in a new file.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">backup ejabberd.backup</span></span></dt><dd class="dd-description">
Store internal Mnesia database to a binary backup file.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">restore ejabberd.backup</span></span></dt><dd class="dd-description">
Restore immediately from a binary backup file the internal Mnesia database.
This will consume a lot of memory if you have a large database,
so better use <span style="font-family:monospace">install_fallback</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">install_fallback ejabberd.backup</span></span></dt><dd class="dd-description">
The binary backup file is installed as fallback:
it will be used to restore the database at the next ejabberd start.
This means that, after running this command, you have to restart ejabberd.
This command requires less memory than <span style="font-family:monospace">restore</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">dump ejabberd.dump</span></span></dt><dd class="dd-description">
Dump internal Mnesia database to a text file dump.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">load ejabberd.dump</span></span></dt><dd class="dd-description">
Restore immediately from a text file dump.
This is not recommended for big databases, as it will consume much time,
memory and processor. In that case it&#X2019;s preferable to use <span style="font-family:monospace">backup</span> and <span style="font-family:monospace">install_fallback</span>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">import_piefxis, export_piefxis, export_piefxis_host</span></span></dt><dd class="dd-description"> 
These options can be used to migrate accounts
using <a href="http://xmpp.org/extensions/xep-0227.html">XEP-0227</a> formatted XML files
from/to other Jabber/XMPP servers
or move users of a vhost to another ejabberd installation.
See also <a href="https://support.process-one.net/doc/display/MESSENGER/ejabberd+migration+kit">ejabberd migration kit</a>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">import_file, import_dir</span></span></dt><dd class="dd-description"> 
These options can be used to migrate accounts
using jabberd1.4 formatted XML files.
from other Jabber/XMPP servers
There exist tutorials to
<a href="http://www.ejabberd.im/migrate-to-ejabberd">migrate from other software to ejabberd</a>.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">export2odbc virtualhost directory</span></span></dt><dd class="dd-description"> 
Export virtual host information from Mnesia tables to SQL files.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">delete_expired_messages</span></span></dt><dd class="dd-description"> This option can be used to delete old messages
in offline storage. This might be useful when the number of offline messages
is very high.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">delete_old_messages days</span></span></dt><dd class="dd-description"> Delete offline messages older than the given days.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">register user host password</span></span></dt><dd class="dd-description"> Register an account in that domain with the given password.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">unregister user host</span></span></dt><dd class="dd-description"> Unregister the given account.
</dd></dl><p> <a id="accesscommands"></a> </p>
<!--TOC subsection id="sec108" Restrict Execution with AccessCommands-->
<h3 id="sec108" class="subsection">4.2.2&#XA0;&#XA0;<a href="#accesscommands">Restrict Execution with AccessCommands</a></h3><!--SEC END --><p> <a id="accesscommands"></a> </p><p>The frontends can be configured to restrict access to certain commands.
In that case, authentication information must be provided.
In each frontend the <span style="font-family:monospace">AccessCommands</span> option is defined
in a different place. But in all cases the option syntax is the same:
</p><pre class="verbatim">AccessCommands = [ {Access, CommandNames, Arguments}, ...]
Access = atom()
CommandNames = all | [CommandName]
CommandName = atom()
Arguments = [ {ArgumentName, ArgumentValue}, ...]
ArgumentName = atom()
ArgumentValue = any()
</pre><p>The default value is to not define any restriction: <span style="font-family:monospace">[]</span>.
The authentication information is provided when executing a command,
and is Username, Hostname and Password of a local XMPP account
that has permission to execute the corresponding command.
This means that the account must be registered in the local ejabberd,
because the information will be verified.</p><p>When one or several access restrictions are defined and the
authentication information is provided,
each restriction is verified until one matches completely:
the account matches the Access rule,
the command name is listed in CommandNames,
and the provided arguments do not contradict Arguments.</p><p>As an example to understand the syntax, let&#X2019;s suppose those options:
</p><pre class="verbatim">{hosts, ["example.org"]}.
{acl, bots, {user, "robot1", "example.org"}}.
{access, commaccess, [{allow, bots}]}.
</pre><p>This list of access restrictions allows only <span style="font-family:monospace">robot1@example.org</span> to execute all commands:
</p><pre class="verbatim">[{commaccess, all, []}]
</pre><p>See another list of restrictions (the corresponding ACL and ACCESS are not shown):
</p><pre class="verbatim">[
 %% This bot can execute all commands:
 {bot, all, []},
 %% This bot can only execute the command 'dump'. No argument restriction:
 {bot_backups, [dump], []}
 %% This bot can execute all commands,
 %% but if a 'host' argument is provided, it must be "example.org":
 {bot_all_example, all, [{host, "example.org"}]},
 %% This bot can only execute the command 'register',
 %% and if argument 'host' is provided, it must be "example.org":
 {bot_reg_example, [register], [{host, "example.org"}]},
 %% This bot can execute the commands 'register' and 'unregister',
 %% if argument host is provided, it must be "test.org":
 {_bot_reg_test, [register, unregister], [{host, "test.org"}]}
]
</pre><p> <a id="webadmin"></a> </p>
<!--TOC section id="sec109" Web Admin-->
<h2 id="sec109" class="section">4.3&#XA0;&#XA0;<a href="#webadmin">Web Admin</a></h2><!--SEC END --><p> <a id="webadmin"></a> 
</p><p>The <span style="font-family:monospace">ejabberd</span> Web Admin allows to administer most of <span style="font-family:monospace">ejabberd</span> using a web browser.</p><p>This feature is enabled by default:
a <span style="font-family:monospace">ejabberd_http</span> listener with the option <span style="font-family:monospace">web_admin</span> (see
section&#XA0;<a href="#listened">3.1.4</a>) is included in the listening ports. Then you can open
<code>http://server:port/admin/</code> in your favourite web browser. You
will be asked to enter the username (the <em>full</em> Jabber ID) and password
of an <span style="font-family:monospace">ejabberd</span> user with administrator rights. After authentication
you will see a page similar to figure&#XA0;<a href="#fig%3Awebadmmain">4.1</a>.</p><blockquote class="figure"><div class="center"><div class="center"><hr style="width:80%;height:2"></div>

<img src="webadmmain.png" alt="webadmmain.png">


<div class="caption"><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="vertical-align:top;text-align:left;" >Figure 4.1: Top page from the Web Admin</td></tr>
</table></div>
<a id="fig:webadmmain"></a>
<div class="center"><hr style="width:80%;height:2"></div></div></blockquote><p>
Here you can edit access restrictions, manage users, create backups,
manage the database, enable/disable ports listened for, view server
statistics,&#X2026;</p><p>The access rule <span style="font-family:monospace">configure</span> determines what accounts can access the Web Admin and modify it.
The access rule <span style="font-family:monospace">webadmin_view</span> is to grant only view access: those accounts can browse the Web Admin with read-only access.</p><p>Example configurations:
</p><ul class="itemize"><li class="li-itemize">
You can serve the Web Admin on the same port as the
HTTP Polling interface. In this example
you should point your web browser to <code>http://example.org:5280/admin/</code> to
administer all virtual hosts or to
<code>http://example.org:5280/admin/server/example.com/</code> to administer only
the virtual host <span style="font-family:monospace">example.com</span>. Before you get access to the Web Admin
you need to enter as username, the JID and password from a registered user
that is allowed to configure <span style="font-family:monospace">ejabberd</span>. In this example you can enter as
username &#X2018;<span style="font-family:monospace">admin@example.net</span>&#X2019; to administer all virtual hosts (first
URL). If you log in with &#X2018;<span style="font-family:monospace">admin@example.com</span>&#X2019; on <br>
 <code>http://example.org:5280/admin/server/example.com/</code> you can only
administer the virtual host <span style="font-family:monospace">example.com</span>.
The account &#X2018;<span style="font-family:monospace">reviewer@example.com</span>&#X2019; can browse that vhost in read-only mode.
<pre class="verbatim">acl: 
  admin: 
    user: 
      - "admin": "example.net"

host_config: 
  "example.com": 
    acl: 
      admin: 
        user: 
          - "admin": "example.com"
      viewers: 
        user: 
          - "reviewer": "example.com"

access: 
  configure: 
    admin: allow
  webadmin_view: 
    viewers: allow

hosts: 
  - "example.org"

listen: 
  ...
  - 
    port: 5280
    module: ejabberd_http
    web_admin: true
    http_poll: true
  ...
</pre></li><li class="li-itemize">For security reasons, you can serve the Web Admin on a secured
connection, on a port differing from the HTTP Polling interface, and bind it
to the internal LAN IP. The Web Admin will be accessible by pointing your
web browser to <code>https://192.168.1.1:5282/admin/</code>:
<pre class="verbatim">hosts: 
  - "example.org"
listen: 
  ...
  - 
    port: 5280
    module: ejabberd_http
    http_poll: true
  - 
    ip: "192.168.1.1"
    port: 5282
    module: ejabberd_http
    certfile: "/usr/local/etc/server.pem"
    tls: true
    web_admin: true
  ...
</pre></li></ul><p>Certain pages in the ejabberd Web Admin contain a link to a related
section in the ejabberd Installation and Operation Guide.
In order to view such links, a copy in HTML format of the Guide must
be installed in the system.
The file is searched by default in
<span style="font-family:monospace">"/share/doc/ejabberd/guide.html"</span>.
The directory of the documentation can be specified in
the environment variable <span style="font-family:monospace">EJABBERD_DOC_PATH</span>.
See section <a href="#erlangconfiguration">4.1.2</a>.</p><p> <a id="adhoccommands"></a> </p>
<!--TOC section id="sec110" Ad-hoc Commands-->
<h2 id="sec110" class="section">4.4&#XA0;&#XA0;<a href="#adhoccommands">Ad-hoc Commands</a></h2><!--SEC END --><p> <a id="adhoccommands"></a> </p><p>If you enable <span style="font-family:monospace">mod_configure</span> and <span style="font-family:monospace">mod_adhoc</span>,
you can perform several administrative tasks in <span style="font-family:monospace">ejabberd</span>
with an XMPP client.
The client must support Ad-Hoc Commands (<a href="http://xmpp.org/extensions/xep-0050.html">XEP-0050</a>),
and you must login in the XMPP server with
an account with proper privileges.</p><p> <a id="changeerlangnodename"></a> </p>
<!--TOC section id="sec111" Change Computer Hostname-->
<h2 id="sec111" class="section">4.5&#XA0;&#XA0;<a href="#changeerlangnodename">Change Computer Hostname</a></h2><!--SEC END --><p> <a id="changeerlangnodename"></a> </p><p><span style="font-family:monospace">ejabberd</span> uses the distributed Mnesia database.
Being distributed, Mnesia enforces consistency of its file,
so it stores the name of the Erlang node in it (see section <a href="#nodename">5.4</a>).
The name of an Erlang node includes the hostname of the computer.
So, the name of the Erlang node changes
if you change the name of the machine in which <span style="font-family:monospace">ejabberd</span> runs,
or when you move <span style="font-family:monospace">ejabberd</span> to a different machine.</p><p>You have two ways to use the old Mnesia database in an ejabberd with new node name:
put the old node name in <span style="font-family:monospace">ejabberdctl.cfg</span>,
or convert the database to the new node name.</p><p>Those example steps will backup, convert and load the Mnesia database.
You need to have either the old Mnesia spool dir or a backup of Mnesia.
If you already have a backup file of the old database, you can go directly to step 5.
You also need to know the old node name and the new node name.
If you don&#X2019;t know them, look for them by executing <span style="font-family:monospace">ejabberdctl</span>
or in the ejabberd log files.</p><p>Before starting, setup some variables:
</p><pre class="verbatim">OLDNODE=ejabberd@oldmachine
NEWNODE=ejabberd@newmachine
OLDFILE=/tmp/old.backup
NEWFILE=/tmp/new.backup
</pre><ol class="enumerate" type=1><li class="li-enumerate">
Start ejabberd enforcing the old node name:
<pre class="verbatim">ejabberdctl --node $OLDNODE start
</pre></li><li class="li-enumerate">Generate a backup file:
<pre class="verbatim">ejabberdctl --node $OLDNODE backup $OLDFILE
</pre></li><li class="li-enumerate">Stop the old node:
<pre class="verbatim">ejabberdctl --node $OLDNODE stop
</pre></li><li class="li-enumerate">Make sure there aren&#X2019;t files in the Mnesia spool dir. For example:
<pre class="verbatim">mkdir /var/lib/ejabberd/oldfiles
mv /var/lib/ejabberd/*.* /var/lib/ejabberd/oldfiles/
</pre></li><li class="li-enumerate">Start ejabberd. There isn&#X2019;t any need to specify the node name anymore:
<pre class="verbatim">ejabberdctl start
</pre></li><li class="li-enumerate">Convert the backup to new node name:
<pre class="verbatim">ejabberdctl mnesia_change_nodename $OLDNODE $NEWNODE $OLDFILE $NEWFILE
</pre></li><li class="li-enumerate">Install the backup file as a fallback:
<pre class="verbatim">ejabberdctl install_fallback $NEWFILE
</pre></li><li class="li-enumerate">Stop ejabberd:
<pre class="verbatim">ejabberdctl stop
</pre>You may see an error message in the log files, it&#X2019;s normal, so don&#X2019;t worry:
<pre class="verbatim">Mnesia(ejabberd@newmachine):
** ERROR ** (ignoring core)
** FATAL ** A fallback is installed and Mnesia must be restarted.
  Forcing shutdown after mnesia_down from ejabberd@newmachine...
</pre></li><li class="li-enumerate">Now you can finally start ejabberd:
<pre class="verbatim">ejabberdctl start
</pre></li><li class="li-enumerate">Check that the information of the old database is available: accounts, rosters...
After you finish, remember to delete the temporary backup files from public directories.
</li></ol><p> <a id="secure"></a> </p>
<!--TOC chapter id="sec112" Securing <span style="font-family:monospace">ejabberd</span>-->
<h1 id="sec112" class="chapter">Chapter&#XA0;5&#XA0;&#XA0;<a href="#secure">Securing <span style="font-family:monospace">ejabberd</span></a></h1><!--SEC END --><p> <a id="secure"></a> </p><p> <a id="firewall"></a> </p>
<!--TOC section id="sec113" Firewall Settings-->
<h2 id="sec113" class="section">5.1&#XA0;&#XA0;<a href="#firewall">Firewall Settings</a></h2><!--SEC END --><p> <a id="firewall"></a> 
</p><p>You need to take the following TCP ports in mind when configuring your firewall:
</p><blockquote class="table"><div class="center"><div class="center"><hr style="width:80%;height:2"></div>
<table border=1  style="border-spacing:0;" class="cellpadding1"><tr><td style="text-align:left;border:solid 1px;white-space:nowrap" ><span style="font-weight:bold">Port</span></td><td style="text-align:left;border:solid 1px;white-space:nowrap" ><span style="font-weight:bold">Description</span> </td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" >5222</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Standard port for Jabber/XMPP client connections, plain or STARTTLS.</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" >5223</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Standard port for Jabber client connections using the old SSL method.</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" >5269</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Standard port for Jabber/XMPP server connections.</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" >4369</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >EPMD (section <a href="#epmd">5.2</a>) listens for Erlang node name requests.</td></tr>
<tr><td style="text-align:left;border:solid 1px;white-space:nowrap" >port range</td><td style="text-align:left;border:solid 1px;white-space:nowrap" >Used for connections between Erlang nodes. This range is configurable (see section <a href="#epmd">5.2</a>).</td></tr>
</table>
<div class="center"><hr style="width:80%;height:2"></div></div></blockquote><p> <a id="epmd"></a> </p>
<!--TOC section id="sec114" epmd-->
<h2 id="sec114" class="section">5.2&#XA0;&#XA0;<a href="#epmd">epmd</a></h2><!--SEC END --><p> <a id="epmd"></a> </p><p><a href="http://www.erlang.org/doc/man/epmd.html">epmd (Erlang Port Mapper Daemon)</a>
is a small name server included in Erlang/OTP
and used by Erlang programs when establishing distributed Erlang communications.
<span style="font-family:monospace">ejabberd</span> needs <span style="font-family:monospace">epmd</span> to use <span style="font-family:monospace">ejabberdctl</span> and also when clustering <span style="font-family:monospace">ejabberd</span> nodes.
This small program is automatically started by Erlang, and is never stopped.
If <span style="font-family:monospace">ejabberd</span> is stopped, and there aren&#X2019;t any other Erlang programs
running in the system, you can safely stop <span style="font-family:monospace">epmd</span> if you want.</p><p><span style="font-family:monospace">ejabberd</span> runs inside an Erlang node.
To communicate with <span style="font-family:monospace">ejabberd</span>, the script <span style="font-family:monospace">ejabberdctl</span> starts a new Erlang node
and connects to the Erlang node that holds <span style="font-family:monospace">ejabberd</span>.
In order for this communication to work,
<span style="font-family:monospace">epmd</span> must be running and listening for name requests in the port 4369.
You should block the port 4369 in the firewall in such a way that
only the programs in your machine can access it.
or configure the option <span style="font-family:monospace">ERL_EPMD_ADDRESS</span> in the file <span style="font-family:monospace">ejabberdctl.cfg</span>.</p><p>If you build a cluster of several <span style="font-family:monospace">ejabberd</span> instances,
each <span style="font-family:monospace">ejabberd</span> instance is called an <span style="font-family:monospace">ejabberd</span> node.
Those <span style="font-family:monospace">ejabberd</span> nodes use a special Erlang communication method to
build the cluster, and EPMD is again needed listening in the port 4369.
So, if you plan to build a cluster of <span style="font-family:monospace">ejabberd</span> nodes
you must open the port 4369 for the machines involved in the cluster.
Remember to block the port so Internet doesn&#X2019;t have access to it.</p><p>Once an Erlang node solved the node name of another Erlang node using EPMD and port 4369,
the nodes communicate directly.
The ports used in this case by default are random,
but can be configured in the file <span style="font-family:monospace">ejabberdctl.cfg</span>.
The Erlang command-line parameter used internally is, for example:
</p><pre class="verbatim">erl ... -kernel inet_dist_listen_min 4370 inet_dist_listen_max 4375
</pre><p>It is also possible to configure in <span style="font-family:monospace">ejabberdctl.cfg</span>
the network interface where the Erlang node will listen and accept connections.
The Erlang command-line parameter used internally is, for example:
</p><pre class="verbatim">erl ... -kernel inet_dist_use_interface "{127,0,0,1}"
</pre><p> <a id="cookie"></a> </p>
<!--TOC section id="sec115" Erlang Cookie-->
<h2 id="sec115" class="section">5.3&#XA0;&#XA0;<a href="#cookie">Erlang Cookie</a></h2><!--SEC END --><p> <a id="cookie"></a> </p><p>The Erlang cookie is a string with numbers and letters.
An Erlang node reads the cookie at startup from the command-line parameter <span style="font-family:monospace">-setcookie</span>.
If not indicated, the cookie is read from the cookie file <span style="font-family:monospace">$HOME/.erlang.cookie</span>.
If this file does not exist, it is created immediately with a random cookie.
Two Erlang nodes communicate only if they have the same cookie.
Setting a cookie on the Erlang node allows you to structure your Erlang network
and define which nodes are allowed to connect to which.</p><p>Thanks to Erlang cookies, you can prevent access to the Erlang node by mistake,
for example when there are several Erlang nodes running different programs in the same machine.</p><p>Setting a secret cookie is a simple method
to difficult unauthorized access to your Erlang node.
However, the cookie system is not ultimately effective
to prevent unauthorized access or intrusion to an Erlang node.
The communication between Erlang nodes are not encrypted,
so the cookie could be read sniffing the traffic on the network.
The recommended way to secure the Erlang node is to block the port 4369.</p><p> <a id="nodename"></a> </p>
<!--TOC section id="sec116" Erlang Node Name-->
<h2 id="sec116" class="section">5.4&#XA0;&#XA0;<a href="#nodename">Erlang Node Name</a></h2><!--SEC END --><p> <a id="nodename"></a> </p><p>An Erlang node may have a node name.
The name can be short (if indicated with the command-line parameter <span style="font-family:monospace">-sname</span>)
or long (if indicated with the parameter <span style="font-family:monospace">-name</span>).
Starting an Erlang node with -sname limits the communication between Erlang nodes to the LAN.</p><p>Using the option <span style="font-family:monospace">-sname</span> instead of <span style="font-family:monospace">-name</span> is a simple method
to difficult unauthorized access to your Erlang node.
However, it is not ultimately effective to prevent access to the Erlang node,
because it may be possible to fake the fact that you are on another network
using a modified version of Erlang <span style="font-family:monospace">epmd</span>.
The recommended way to secure the Erlang node is to block the port 4369.</p><p> <a id="secure-files"></a> </p>
<!--TOC section id="sec117" Securing Sensitive Files-->
<h2 id="sec117" class="section">5.5&#XA0;&#XA0;<a href="#secure-files">Securing Sensitive Files</a></h2><!--SEC END --><p> <a id="secure-files"></a> </p><p><span style="font-family:monospace">ejabberd</span> stores sensitive data in the file system either in plain text or binary files.
The file system permissions should be set to only allow the proper user to read,
write and execute those files and directories.</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">ejabberd configuration file: /etc/ejabberd/ejabberd.yml</span></span></dt><dd class="dd-description">
Contains the JID of administrators
and passwords of external components.
The backup files probably contain also this information,
so it is preferable to secure the whole <span style="font-family:monospace">/etc/ejabberd/</span> directory.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">ejabberd service log: /var/log/ejabberd/ejabberd.log</span></span></dt><dd class="dd-description">
Contains IP addresses of clients.
If the loglevel is set to 5, it contains whole conversations and passwords.
If a logrotate system is used, there may be several log files with similar information,
so it is preferable to secure the whole <span style="font-family:monospace">/var/log/ejabberd/</span> directory.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">Mnesia database spool files in /var/lib/ejabberd/</span></span></dt><dd class="dd-description">
The files store binary data, but some parts are still readable.
The files are generated by Mnesia and their permissions cannot be set directly,
so it is preferable to secure the whole <span style="font-family:monospace">/var/lib/ejabberd/</span> directory.
</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">Erlang cookie file: /var/lib/ejabberd/.erlang.cookie</span></span></dt><dd class="dd-description">
See section <a href="#cookie">5.3</a>.
</dd></dl><p> <a id="clustering"></a> </p>
<!--TOC chapter id="sec118" Clustering-->
<h1 id="sec118" class="chapter">Chapter&#XA0;6&#XA0;&#XA0;<a href="#clustering">Clustering</a></h1><!--SEC END --><p> <a id="clustering"></a> 
</p><p> <a id="howitworks"></a> </p>
<!--TOC section id="sec119" How it Works-->
<h2 id="sec119" class="section">6.1&#XA0;&#XA0;<a href="#howitworks">How it Works</a></h2><!--SEC END --><p> <a id="howitworks"></a> 
</p><p>A XMPP domain is served by one or more <span style="font-family:monospace">ejabberd</span> nodes. These nodes can
be run on different machines that are connected via a network. They all
must have the ability to connect to port 4369 of all another nodes, and must
have the same magic cookie (see Erlang/OTP documentation, in other words the
file <span style="font-family:monospace">~ejabberd/.erlang.cookie</span> must be the same on all nodes). This is
needed because all nodes exchange information about connected users, s2s
connections, registered services, etc&#X2026;</p><p>Each <span style="font-family:monospace">ejabberd</span> node has the following modules:
</p><ul class="itemize"><li class="li-itemize">
router,
</li><li class="li-itemize">local router,
</li><li class="li-itemize">session manager,
</li><li class="li-itemize">s2s manager.
</li></ul><p> <a id="router"></a> </p>
<!--TOC subsection id="sec120" Router-->
<h3 id="sec120" class="subsection">6.1.1&#XA0;&#XA0;<a href="#router">Router</a></h3><!--SEC END --><p> <a id="router"></a> 
</p><p>This module is the main router of XMPP packets on each node. It
routes them based on their destination&#X2019;s domains. It uses a global
routing table. The domain of the packet&#X2019;s destination is searched in the
routing table, and if it is found, the packet is routed to the
appropriate process. If not, it is sent to the s2s manager.</p><p> <a id="localrouter"></a> </p>
<!--TOC subsection id="sec121" Local Router-->
<h3 id="sec121" class="subsection">6.1.2&#XA0;&#XA0;<a href="#localrouter">Local Router</a></h3><!--SEC END --><p> <a id="localrouter"></a> 
</p><p>This module routes packets which have a destination domain equal to
one of this server&#X2019;s host names. If the destination JID has a non-empty user
part, it is routed to the session manager, otherwise it is processed depending
on its content.</p><p> <a id="sessionmanager"></a> </p>
<!--TOC subsection id="sec122" Session Manager-->
<h3 id="sec122" class="subsection">6.1.3&#XA0;&#XA0;<a href="#sessionmanager">Session Manager</a></h3><!--SEC END --><p> <a id="sessionmanager"></a> 
</p><p>This module routes packets to local users. It looks up to which user
resource a packet must be sent via a presence table. Then the packet is
either routed to the appropriate c2s process, or stored in offline
storage, or bounced back.</p><p> <a id="s2smanager"></a> </p>
<!--TOC subsection id="sec123" s2s Manager-->
<h3 id="sec123" class="subsection">6.1.4&#XA0;&#XA0;<a href="#s2smanager">s2s Manager</a></h3><!--SEC END --><p> <a id="s2smanager"></a> 
</p><p>This module routes packets to other XMPP servers. First, it
checks if an opened s2s connection from the domain of the packet&#X2019;s
source to the domain of the packet&#X2019;s destination exists. If that is the case,
the s2s manager routes the packet to the process
serving this connection, otherwise a new connection is opened.</p><p> <a id="cluster"></a> </p>
<!--TOC section id="sec124" Clustering Setup-->
<h2 id="sec124" class="section">6.2&#XA0;&#XA0;<a href="#cluster">Clustering Setup</a></h2><!--SEC END --><p> <a id="cluster"></a> 
</p><p>Suppose you already configured <span style="font-family:monospace">ejabberd</span> on one machine named (<span style="font-family:monospace">first</span>),
and you need to setup another one to make an <span style="font-family:monospace">ejabberd</span> cluster. Then do
following steps:</p><ol class="enumerate" type=1><li class="li-enumerate">
Copy <code>~ejabberd/.erlang.cookie</code> file from <span style="font-family:monospace">first</span> to
<span style="font-family:monospace">second</span>.<p>(alt) You can also add &#X2018;<code>-setcookie content_of_.erlang.cookie</code>&#X2019;
option to all &#X2018;<span style="font-family:monospace">erl</span>&#X2019; commands below.</p></li><li class="li-enumerate">On <span style="font-family:monospace">second</span> run the following command as the <span style="font-family:monospace">ejabberd</span> daemon user,
in the working directory of <span style="font-family:monospace">ejabberd</span>:<pre class="verbatim">erl -sname ejabberd \
    -mnesia dir '"/var/lib/ejabberd/"' \
    -mnesia extra_db_nodes "['ejabberd@first']" \
    -s mnesia
</pre><p>This will start Mnesia serving the same database as <span style="font-family:monospace">ejabberd@first</span>.
You can check this by running the command &#X2018;<code>mnesia:info().</code>&#X2019;. You
should see a lot of remote tables and a line like the following:</p><p>Note: the Mnesia directory may be different in your system.
To know where does ejabberd expect Mnesia to be installed by default,
call <a href="#ejabberdctl">4.1</a> without options and it will show some help,
including the Mnesia database spool dir.</p><pre class="verbatim">running db nodes   = [ejabberd@first, ejabberd@second]
</pre></li><li class="li-enumerate">Now run the following in the same &#X2018;<span style="font-family:monospace">erl</span>&#X2019; session:<pre class="verbatim">mnesia:change_table_copy_type(schema, node(), disc_copies).
</pre><p>This will create local disc storage for the database.</p><p>(alt) Change storage type of the <span style="font-family:monospace">scheme</span> table to &#X2018;RAM and disc
copy&#X2019; on the second node via the Web Admin.</p></li><li class="li-enumerate">Now you can add replicas of various tables to this node with
&#X2018;<code>mnesia:add_table_copy</code>&#X2019; or
&#X2018;<code>mnesia:change_table_copy_type</code>&#X2019; as above (just replace
&#X2018;<code>schema</code>&#X2019; with another table name and &#X2018;<code>disc_copies</code>&#X2019;
can be replaced with &#X2018;<code>ram_copies</code>&#X2019; or
&#X2018;<code>disc_only_copies</code>&#X2019;).<p>Which tables to replicate is very dependant on your needs, you can get
some hints from the command &#X2018;<code>mnesia:info().</code>&#X2019;, by looking at the
size of tables and the default storage type for each table on &#X2019;first&#X2019;.</p><p>Replicating a table makes lookups in this table faster on this node.
Writing, on the other hand, will be slower. And of course if machine with one
of the replicas is down, other replicas will be used.</p><p>Also <a href="http://www.erlang.org/doc/apps/mnesia/Mnesia_chap5.html#5.3">section 5.3 (Table Fragmentation) of Mnesia User&#X2019;s Guide</a> can be helpful.
</p><p>(alt) Same as in previous item, but for other tables.</p></li><li class="li-enumerate">Run &#X2018;<code>init:stop().</code>&#X2019; or just &#X2018;<code>q().</code>&#X2019; to exit from
the Erlang shell. This probably can take some time if Mnesia has not yet
transfered and processed all data it needed from <span style="font-family:monospace">first</span>.</li><li class="li-enumerate">Now run <span style="font-family:monospace">ejabberd</span> on <span style="font-family:monospace">second</span> with a configuration similar as
on <span style="font-family:monospace">first</span>: you probably do not need to duplicate &#X2018;<code>acl</code>&#X2019;
and &#X2018;<code>access</code>&#X2019; options because they will be taken from
<span style="font-family:monospace">first</span>; and <code>mod_irc</code> should be
enabled only on one machine in the cluster.
</li></ol><p>You can repeat these steps for other machines supposed to serve this
domain.</p><p> <a id="servicelb"></a> </p>
<!--TOC section id="sec125" Service Load-Balancing-->
<h2 id="sec125" class="section">6.3&#XA0;&#XA0;<a href="#servicelb">Service Load-Balancing</a></h2><!--SEC END --><p> <a id="servicelb"></a> 
</p><p> <a id="domainlb"></a> </p>
<!--TOC subsection id="sec126" Domain Load-Balancing Algorithm-->
<h3 id="sec126" class="subsection">6.3.1&#XA0;&#XA0;<a href="#domainlb">Domain Load-Balancing Algorithm</a></h3><!--SEC END --><p> <a id="domainlb"></a> 
</p><p><span style="font-family:monospace">ejabberd</span> includes an algorithm to load balance the components that are plugged on an <span style="font-family:monospace">ejabberd</span> cluster. It means that you can plug one or several instances of the same component on each <span style="font-family:monospace">ejabberd</span> cluster and that the traffic will be automatically distributed.</p><p>The default distribution algorithm try to deliver to a local instance of a component. If several local instances are available, one instance is chosen randomly. If no instance is available locally, one instance is chosen randomly among the remote component instances.</p><p>If you need a different behaviour, you can change the load balancing behaviour with the option <span style="font-family:monospace">domain_balancing</span>. The syntax of the option is the following:
</p><dl class="description"><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">domain_balancing: BalancingCriteria</span></span></dt></dl><p>Several balancing criteria are available:
</p><ul class="itemize"><li class="li-itemize">
<span style="font-family:monospace">destination</span>: the full JID of the packet <span style="font-family:monospace">to</span> attribute is used.
</li><li class="li-itemize"><span style="font-family:monospace">source</span>: the full JID of the packet <span style="font-family:monospace">from</span> attribute is used.
</li><li class="li-itemize"><span style="font-family:monospace">bare_destination</span>: the bare JID (without resource) of the packet <span style="font-family:monospace">to</span> attribute is used.
</li><li class="li-itemize"><span style="font-family:monospace">bare_source</span>: the bare JID (without resource) of the packet <span style="font-family:monospace">from</span> attribute is used.
</li></ul><p>If the value corresponding to the criteria is the same, the same component instance in the cluster will be used.</p><p> <a id="lbbuckets"></a> </p>
<!--TOC subsection id="sec127" Load-Balancing Buckets-->
<h3 id="sec127" class="subsection">6.3.2&#XA0;&#XA0;<a href="#lbbuckets">Load-Balancing Buckets</a></h3><!--SEC END --><p> <a id="lbbuckets"></a> 
</p><p>When there is a risk of failure for a given component, domain balancing can cause service trouble. If one component is failing the service will not work correctly unless the sessions are rebalanced.</p><p>In this case, it is best to limit the problem to the sessions handled by the failing component. This is what the <span style="font-family:monospace">domain_balancing_component_number</span> option does, making the load balancing algorithm not dynamic, but sticky on a fix number of component instances.</p><p>The syntax is:
</p><dl class="description"><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">domain_balancing_component_number: Number</span></span></dt></dl><p> <a id="debugging"></a> </p>
<!--TOC chapter id="sec128" Debugging-->
<h1 id="sec128" class="chapter">Chapter&#XA0;7&#XA0;&#XA0;<a href="#debugging">Debugging</a></h1><!--SEC END --><p> <a id="debugging"></a> 
</p><p> <a id="logfiles"></a> </p>
<!--TOC section id="sec129" Log Files-->
<h2 id="sec129" class="section">7.1&#XA0;&#XA0;<a href="#logfiles">Log Files</a></h2><!--SEC END --><p> <a id="logfiles"></a> </p><p>An <span style="font-family:monospace">ejabberd</span> node writes two log files:
</p><dl class="description"><dt class="dt-description">
	<span style="font-weight:bold"><span style="font-family:monospace">ejabberd.log</span></span></dt><dd class="dd-description"> is the ejabberd service log, with the messages reported by <span style="font-family:monospace">ejabberd</span> code
	</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">erlang.log</span></span></dt><dd class="dd-description"> is the Erlang/OTP system log, with the messages reported by Erlang/OTP using SASL (System Architecture Support Libraries)
</dd></dl><p>The option <span style="font-family:monospace">loglevel</span> modifies the verbosity of the file ejabberd.log. The syntax:
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold"><span style="font-family:monospace">loglevel: Level</span></span></dt><dd class="dd-description"> The standard form to set a global log level.
</dd></dl><p>The possible <span style="font-family:monospace">Level</span> are:
</p><dl class="description"><dt class="dt-description">
	<span style="font-weight:bold"><span style="font-family:monospace">0</span></span></dt><dd class="dd-description"> No ejabberd log at all (not recommended)
	</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">1</span></span></dt><dd class="dd-description"> Critical
	</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">2</span></span></dt><dd class="dd-description"> Error
	</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">3</span></span></dt><dd class="dd-description"> Warning
	</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">4</span></span></dt><dd class="dd-description"> Info
	</dd><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">5</span></span></dt><dd class="dd-description"> Debug
</dd></dl><p>
For example, the default configuration is:
</p><pre class="verbatim">loglevel: 4
</pre><p>The log files grow continually, so it is recommended to rotate them periodically.
To rotate the log files, rename the files and then reopen them.
The ejabberdctl command <span style="font-family:monospace">reopen-log</span> 
(please refer to section <a href="#ectl-commands">4.1.1</a>)
reopens the log files,
and also renames the old ones if you didn&#X2019;t rename them.</p><p> <a id="debugconsole"></a> </p>
<!--TOC section id="sec130" Debug Console-->
<h2 id="sec130" class="section">7.2&#XA0;&#XA0;<a href="#debugconsole">Debug Console</a></h2><!--SEC END --><p> <a id="debugconsole"></a> </p><p>The Debug Console is an Erlang shell attached to an already running <span style="font-family:monospace">ejabberd</span> server.
With this Erlang shell, an experienced administrator can perform complex tasks.</p><p>This shell gives complete control over the <span style="font-family:monospace">ejabberd</span> server,
so it is important to use it with extremely care.
There are some simple and safe examples in the article
<a href="http://www.ejabberd.im/interconnect-erl-nodes">Interconnecting Erlang Nodes</a></p><p>To exit the shell, close the window or press the keys: control+c control+c.</p><p> <a id="watchdog"></a> </p>
<!--TOC section id="sec131" Watchdog Alerts-->
<h2 id="sec131" class="section">7.3&#XA0;&#XA0;<a href="#watchdog">Watchdog Alerts</a></h2><!--SEC END --><p> <a id="watchdog"></a> 
</p><p><span style="font-family:monospace">ejabberd</span> includes a watchdog mechanism that may be useful to developers
when troubleshooting a problem related to memory usage.
If a process in the <span style="font-family:monospace">ejabberd</span> server consumes more memory than the configured threshold,
a message is sent to the XMPP accounts defined with the option
<span style="font-family:monospace">watchdog_admins</span>
 in the <span style="font-family:monospace">ejabberd</span> configuration file.</p><p>The syntax is:
</p><dl class="description"><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">watchdog_admins: [JID, ...]</span></span></dt></dl><p>The memory consumed is measured in <span style="font-family:monospace">words</span>:
a word on 32-bit architecture is 4 bytes,
and a word on 64-bit architecture is 8 bytes.
The threshold by default is 1000000 words.
This value can be configured with the option <span style="font-family:monospace">watchdog_large_heap</span>,
or in a conversation with the watchdog alert bot.</p><p>The syntax is:
</p><dl class="description"><dt class="dt-description"><span style="font-weight:bold"><span style="font-family:monospace">watchdog_large_heap: Number</span></span></dt></dl><p>Example configuration:
</p><pre class="verbatim">watchdog_admins:
  - "admin2@localhost"
  - "admin2@example.org"
watchdog_large_heap: 30000000
</pre><p>To remove watchdog admins, remove them in the option.
To remove all watchdog admins, set the option with an empty list:
</p><pre class="verbatim">watchdog_admins: []
</pre><p> <a id="i18ni10n"></a> </p>
<!--TOC chapter id="sec132" Internationalization and Localization-->
<h1 id="sec132" class="chapter">Appendix&#XA0;A&#XA0;&#XA0;<a href="#i18ni10n">Internationalization and Localization</a></h1><!--SEC END --><p> <a id="i18ni10n"></a> 
</p><p>The source code of <span style="font-family:monospace">ejabberd</span> supports localization.
The translators can edit the
<a href="http://www.gnu.org/software/gettext/">gettext</a> .po files
using any capable program (KBabel, Lokalize, Poedit...) or a simple text editor.</p><p>Then gettext
is used to extract, update and export those .po files to the .msg format read by <span style="font-family:monospace">ejabberd</span>.
To perform those management tasks, in the <span style="font-family:monospace">src/</span> directory execute <span style="font-family:monospace">make translations</span>.
The translatable strings are extracted from source code to generate the file <span style="font-family:monospace">ejabberd.pot</span>.
This file is merged with each .po file to produce updated .po files.
Finally those .po files are exported to .msg files, that have a format easily readable by <span style="font-family:monospace">ejabberd</span>.</p><p>All built-in modules support the <span style="font-family:monospace">xml:lang</span> attribute inside IQ queries.
Figure&#XA0;<a href="#fig%3Adiscorus">A.1</a>, for example, shows the reply to the following query:
</p><pre class="verbatim">&lt;iq id='5'
    to='example.org'
    type='get'
    xml:lang='ru'&gt;
  &lt;query xmlns='http://jabber.org/protocol/disco#items'/&gt;
&lt;/iq&gt;
</pre><blockquote class="figure"><div class="center"><div class="center"><hr style="width:80%;height:2"></div>

<img src="discorus.png" alt="discorus.png">


<div class="caption"><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="vertical-align:top;text-align:left;" >Figure A.1: Service Discovery when <span style="font-family:monospace">xml:lang=&#X2019;ru&#X2019;</span></td></tr>
</table></div>
<a id="fig:discorus"></a>
<div class="center"><hr style="width:80%;height:2"></div></div></blockquote><p>The Web Admin also supports the <code>Accept-Language</code> HTTP header.</p><blockquote class="figure"><div class="center"><div class="center"><hr style="width:80%;height:2"></div>

<img src="webadmmainru.png" alt="webadmmainru.png">


<div class="caption"><table style="border-spacing:6px;border-collapse:separate;" class="cellpading0"><tr><td style="vertical-align:top;text-align:left;" >Figure A.2: Web Admin showing a virtual host when the web browser provides the
HTTP header &#X2018;Accept-Language: ru&#X2019;</td></tr>
</table></div>
<a id="fig:webadmmainru"></a>
<div class="center"><hr style="width:80%;height:2"></div></div></blockquote><p> <a id="releasenotes"></a> </p>
<!--TOC chapter id="sec133" Release Notes-->
<h1 id="sec133" class="chapter">Appendix&#XA0;B&#XA0;&#XA0;<a href="#releasenotes">Release Notes</a></h1><!--SEC END --><p> <a id="releasenotes"></a> 
</p><p>Release notes are available from <a href="http://www.process-one.net/en/ejabberd/release_notes/">ejabberd Home Page</a></p><p> <a id="acknowledgements"></a> </p>
<!--TOC chapter id="sec134" Acknowledgements-->
<h1 id="sec134" class="chapter">Appendix&#XA0;C&#XA0;&#XA0;<a href="#acknowledgements">Acknowledgements</a></h1><!--SEC END --><p> <a id="acknowledgements"></a> </p><p>Thanks to all people who contributed to this guide:
</p><ul class="itemize"><li class="li-itemize">
Alexey Shchepin (<a href="xmpp:aleksey@jabber.ru"><span style="font-family:monospace">xmpp:aleksey@jabber.ru</span></a>)
</li><li class="li-itemize">Badlop (<a href="xmpp:badlop@jabberes.org"><span style="font-family:monospace">xmpp:badlop@jabberes.org</span></a>)
</li><li class="li-itemize">Evgeniy Khramtsov (<a href="xmpp:xram@jabber.ru"><span style="font-family:monospace">xmpp:xram@jabber.ru</span></a>)
</li><li class="li-itemize">Florian Zumbiehl (<a href="xmpp:florz@florz.de"><span style="font-family:monospace">xmpp:florz@florz.de</span></a>)
</li><li class="li-itemize">Ludovic Bocquet (<a href="xmpp:lbocquet@jabber.org"><span style="font-family:monospace">xmpp:lbocquet@jabber.org</span></a>)
</li><li class="li-itemize">Marcin Owsiany (<a href="xmpp:marcin.owsiany@gmail.com"><span style="font-family:monospace">xmpp:marcin.owsiany@gmail.com</span></a>)
</li><li class="li-itemize">Michael Grigutsch (<a href="xmpp:migri@jabber.i-pobox.net"><span style="font-family:monospace">xmpp:migri@jabber.i-pobox.net</span></a>)
</li><li class="li-itemize">Mickael Remond (<a href="xmpp:mremond@process-one.net"><span style="font-family:monospace">xmpp:mremond@process-one.net</span></a>)
</li><li class="li-itemize">Sander Devrieze (<a href="xmpp:s.devrieze@gmail.com"><span style="font-family:monospace">xmpp:s.devrieze@gmail.com</span></a>)
</li><li class="li-itemize">Sergei Golovan (<a href="xmpp:sgolovan@nes.ru"><span style="font-family:monospace">xmpp:sgolovan@nes.ru</span></a>)
</li><li class="li-itemize">Vsevolod Pelipas (<a href="xmpp:vsevoload@jabber.ru"><span style="font-family:monospace">xmpp:vsevoload@jabber.ru</span></a>)
</li></ul><p> <a id="copyright"></a> </p>
<!--TOC chapter id="sec135" Copyright Information-->
<h1 id="sec135" class="chapter">Appendix&#XA0;D&#XA0;&#XA0;<a href="#copyright">Copyright Information</a></h1><!--SEC END --><p> <a id="copyright"></a> </p><p>Ejabberd Installation and Operation Guide.<br>
Copyright &#XA9; 2003 &#X2014; 2014 ProcessOne</p><p>This document is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.</p><p>This document is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.</p><p>You should have received a copy of the GNU General Public License along with
this document; if not, write to the Free Software Foundation, Inc., 51 Franklin
Street, Fifth Floor, Boston, MA 02110-1301, USA.</p><!--CUT END -->
<!--HTMLFOOT-->
<!--ENDHTML-->
<!--FOOTER-->
<hr style="height:2"><blockquote class="quote"><em>This document was translated from L<sup>A</sup>T<sub>E</sub>X by
</em><a href="http://hevea.inria.fr/index.html"><em>H</em><em><span style="font-size:small"><sup>E</sup></span></em><em>V</em><em><span style="font-size:small"><sup>E</sup></span></em><em>A</em></a><em>.</em></blockquote></body>
</html>
